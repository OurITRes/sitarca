<?xml version="1.0" encoding="UTF-8" ?>
<ArrayOfExportedRule xmlns:xsd="http://www.w3.org/2001/XMLSchema"
                     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>One or more Organizational Units (OUs) in your Active Directory domain have delegations granting non-privileged users or groups the ability to create or control msDS-DelegatedManagedServiceAccount objects</Description>
        <Documentation>&lt;a href="https://www.akamai.com/blog/security-research/abusing-dmsa-for-privilege-escalation-in-active-directory#badsuccessor"&gt;https://www.akamai.com/blog/security-research/abusing-dmsa-for-privilege-escalation-in-active-directory#badsuccessor&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.6.2.1"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R37 [paragraph.3.6.2.1]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_bad_successor_delegation_detected"&gt;[FR]ANSSI - One or more Organizational Units (OUs) in your Active Directory domain have delegations granting non-privileged users or groups the ability to create or control msDS-DelegatedManagedServiceAccount objects (vuln1_bad_successor_delegation_detected)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1098"&gt;[MITRE]T1098 Account Manipulation&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>ObjectConfig</Model>
        <RiskId>A-BadSuccessor</RiskId>
        <Solution>Review the affected OUs and restrict delegations that grant non-privileged users or groups permissions such as Create All Child Objects, WriteDACL, WriteOwner, or FullControl over msDS-DelegatedManagedServiceAccount objects. Only highly trusted administrators should have these rights.</Solution>
        <TechnicalExplanation>This rule detects when non-privileged users or groups are granted dangerous permissions over msDS-DelegatedManagedServiceAccount (dMSA) objects in OUs, specifically in environments with Windows Server 2025 Domain Controllers. Such delegations enable attackers to exploit the "BadSuccessor" vulnerability through two primary attack vectors: membership hijacking and cryptographic key extraction.____In membership hijacking attacks, attackers can forge the msDS-ManagedAccountPrecededByLink attribute to migrate group memberships and permissions from any target account to an attacker-controlled dMSA. Additionally, attackers can extract password hashes from the dMSA Key Package's "Previous Key" field, which contains the superseded account's password hash and enables Kerberos ticket decryption.____The detection triggers when specific high-risk permissions are assigned to OUs with inheritance set to "All Descendant Objects" or targeting the dMSA object type. These monitored permissions include Create All Child Objects, Write DACL (Permissions), Write Owner, and Full Control. Each of these permissions can facilitate different aspects of dMSA abuse, from creating malicious service accounts to modifying existing ones or taking over their ownership.</TechnicalExplanation>
        <Title>BadSuccessor Delegation Detected</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>This rule verifies the recommended configuration for Terminal Services.</Description>
        <Documentation>&lt;a href="https://woshub.com/remote-desktop-session-time-limit/"&gt;https://woshub.com/remote-desktop-session-time-limit/&lt;/a&gt;&lt;br&gt;__&lt;a href="    https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-tsts/ce70794f-2138-43e8-bf6c-2c147887d6a2"&gt;    https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-tsts/ce70794f-2138-43e8-bf6c-2c147887d6a2&lt;/a&gt;&lt;br&gt;__&lt;a href="  https://community.spiceworks.com/t/are-redirected-printers-a-security-risk/826344/27"&gt;  https://community.spiceworks.com/t/are-redirected-printers-a-security-risk/826344/27&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation />
        <RiskId>S-TerminalServicesGPO</RiskId>
        <Solution>The Terminal Services configuration can be found in Policies / Administrative Templates / Windows Components / Remote Desktop Services / Remote Desktop Session Host__    The details of this rule is located in Printer Redirection and Session Time Limits.__    __      PingCastle recommends to set the following Policy:__Set time limit for disconnected sessions: 2h (aka MaxDisconnectionTime)__Set time limit for active but idle Remote Desktop Services sessions: 8h (aka MaxIdleTime)__Do not allow client printer redirection: Enabled (aka fDisableCpm)____This rule is active if nothing is set or if the time limit is set to NEVER.__    </Solution>
        <TechnicalExplanation>It is a common practice for hackers to look for open sessions on remote servers.__    This can be done by attempting to open the user registry and checking if there is an access denied error or if the registry hive is not available at all. __    If found, the hacker can exploit this information by targeting this computer, or if the session is still active, hijack it and impact the client computer.__    Indeed, you can access the local drive by default and push a malicious file such as a login script in the start menu of the remote user. __    Another alternative is if the session is not secure, to capture the credentials in memory.__    __    The printer redirection has no known attack pattern. __    However due to past vulnerabilites with the Printer spooler, the complexity of the underlying protocol, the relative absence of need to this feature, we recommend to block it.__    It can also be a bypass for copy / paste restriction and it is recommended to deny it in most admin bastion.__    </TechnicalExplanation>
        <Title>Verify Terminal Services configuration best practices in GPO</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>This rule verifies whether programs, such as script engines, are allowed to connect to the internet by default.</Description>
        <Documentation>&lt;a href="https://medium.com/@cryps1s/endpoint-isolation-with-the-windows-firewall-462a795f4cfb"&gt;https://medium.com/@cryps1s/endpoint-isolation-with-the-windows-firewall-462a795f4cfb&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>5</MaturityLevel>
        <Model>NetworkTopography</Model>
        <ReportLocation>The detail can be found in &lt;a href="#gpofirewall"&gt;Firewall configuration&lt;/a&gt;</ReportLocation>
        <RiskId>S-FirewallScript</RiskId>
        <Solution>1) Create Firewall Rules via GPO__    __Configure the firewall rules under Computer Configuration / Policies / Windows Settings / Security Settings / Windows Defender Firewall with Advanced Security.__Ensure the rules are applied on the Outbound side.__Activate the rules.____2) Network Restrictions:__We recommend setting the rules as active for the following IP address ranges to allow local network access:__0.0.0.0 to 9.255.255.255__11.0.0.0 to 126.255.255.255__128.0.0.1 to 172.15.255.255__172.32.0.0 to 192.167.255.255__192.169.0.0 to 255.255.255.255____Alternatively, you can choose to apply the rules to ALL IP addresses or add your internal proxy IP.____    </Solution>
        <TechnicalExplanation>Malicious scripts, often distributed via phishing emails, frequently attempt to connect to the internet to propagate their infection.__    To mitigate this risk, we recommend implementing a set of firewall rules through Group Policy Objects (GPOs).__    These rules will prohibit direct internet connections for specific programs.__    __    The current list of programs to restrict includes: wscript.exe, mshta.exe, cscript.exe, conhost.exe, and runScriptHelper.exe.__    </TechnicalExplanation>
        <Title>Verify if there are restrictions for internet connectivity of script engines</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>This rule confirms the activation of Defender ASR (Attack Surface Reduction) mitigations within a Group Policy Object (GPO).</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/en-us/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#per-asr-rule-alert-and-notification-details"&gt;https://learn.microsoft.com/en-us/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#per-asr-rule-alert-and-notification-details&lt;/a&gt;&lt;br&gt;__&lt;a href="https://blog.palantir.com/microsoft-defender-attack-surface-reduction-recommendations-a5c7d41c3cf8"&gt;https://blog.palantir.com/microsoft-defender-attack-surface-reduction-recommendations-a5c7d41c3cf8&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>5</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>The detail can be found in &lt;a href="#gpodefenderASR"&gt;Defender ASR&lt;/a&gt;</ReportLocation>
        <RiskId>S-DefenderASR</RiskId>
        <Solution>To apply an ASR mitigation, navigate to the GPO setting "Configure Attack Surface Reduction rules" found under Computer Configuration &gt; Policies &gt; Administrative Templates &gt; Windows Components &gt; Windows Defender Antivirus &gt; Windows Defender Exploit Guard &gt; Attack Surface Reduction.__    Upon enabling this setting, select "Set the state for each ASR rule".__    Then, input the mitigation’s GUID as the Value name and assign 1 as the Value to enforce the rule in Block mode.__    Other configurable values include 2 for Audit mode and 6 for Warn mode.__    For instance, to block JavaScript or VBScript from executing downloaded executable content, use the GUID: d3e037e1-3eb8-44c8-a917-57927947596d.__    It is recommended to set Defender ASR rules as recommended in the article below._____    __    Prior to implementation, conduct an impact analysis to anticipate any potential disruptions, and utilize Audit mode to identify possible issues.__    </Solution>
        <TechnicalExplanation>Microsoft Defender, the default antivirus included with Windows, activates automatically on systems without a pre-installed alternative.__    Defender’s ASR features, designed to minimize vulnerability to attacks, are available even in the standard version.__    These protections have been part of Windows since the release of Windows 10 version 1710 and are also applicable to Windows Server 2012 R2._____  Note: Windows 11 may enable in some conditions those 3 ASR rules: Block abuse of exploited vulnerable signed drivers, Block credential stealing from the Windows local security authority subsystem (lsass.exe), Block persistence through WMI event subscription__    </TechnicalExplanation>
        <Title>Verify that Defender ASR mitigations are in place</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The objective is to ensure scripts do not automatically execute upon opening by default.</Description>
        <Documentation>&lt;a href="https://isc.sans.edu/diary/Controlling+JavaScript+Malware+Before+it+Runs/21171"&gt;https://isc.sans.edu/diary/Controlling+JavaScript+Malware+Before+it+Runs/21171&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>5</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>The detail can be found in &lt;a href="#gpofolderoptions"&gt;Folder Options&lt;/a&gt;</ReportLocation>
        <RiskId>S-FolderOptions</RiskId>
        <Solution>Navigate to Computer Configuration / Preferences / Windows Settings / Folders.__    Create a new File Type with the "Replace" action for the extension you wish to secure.__    In "Configure class settings", add a new "open" action with Notepad as the default application: C:\Windows\System32\notepad.exe.__    </Solution>
        <TechnicalExplanation>By default, PowerShell scripts (.ps1) open in Notepad, which blocks these extensions from being exploited in phishing attacks that evade email filters through multi-layered archives. __    However, several legacy script extensions (.js, .jse, .vbs, .vbe, .vb, .wsh, .wsf) still execute with their respective engines. __    While .js and .jse files are commonly associated with web content and handled by browsers, it’s crucial to recognize their potential for harm when executed directly in Windows.__    Redirecting these files to open in Notepad safeguards against inadvertent execution without affecting web browsing.__    The browser navigation is not impacted by this recommendation.__    Review is recommended for other script files before implementing this security measure.__    __    Note: Javascript execution can be mitigated by an "Attack surface reduction rule" named "Impede JavaScript and VBScript to launch executables" available since Windows 10, version 1709.__    But we still recommend to apply the folder options mitigation as it is more effective.__    </TechnicalExplanation>
        <Title>Verify the Default Application for Script File Execution</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that Anonymous Binding on RootDse is not enabled</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/3f0137a1-63df-400c-bf97-e1040f055a99"&gt;https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/3f0137a1-63df-400c-bf97-e1040f055a99&lt;/a&gt;&lt;br&gt;__&lt;a href="    https://blog.lithnet.io/2018/12/disabling-unauthenticated-binds-in.html"&gt;    https://blog.lithnet.io/2018/12/disabling-unauthenticated-binds-in.html&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1018"&gt;[MITRE]T1018 Remote System Discovery&lt;/a&gt;</Documentation>
        <MaturityLevel>5</MaturityLevel>
        <Model>Reconnaissance</Model>
        <RiskId>A-RootDseAnonBinding</RiskId>
        <Solution>Edit the attribute msDS-Other-Settings of the object CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration.__    Add a new line with the content: DenyUnauthenticatedBind=1__    </Solution>
        <TechnicalExplanation>The rootDse is a special object that enables clients to discover the functionalities of the server, such as LDAP version or support for special processing.__    On Windows, it can be accessed by default without binding, which allows everyone to access this data.__    There is no confidential data in this attribute, only the Operating System version and the name of the domain.__    Since Windows 2019, the rootDse access can be set to require authentication.__    You can test the anonymous access of the rootDse object by launching ldp.exe and selecting 'Connect' on the Connection menu.__    You should receive the error "The server has been configured to deny unauthenticated simple binds."__</TechnicalExplanation>
        <Title>Ensure that the rootDse Anonymous Binding is disabled</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to verify that AES is enabled for service accounts.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/archive/blogs/openspecification/msds-supportedencryptiontypes-episode-1-computer-accounts"&gt;https://docs.microsoft.com/en-us/archive/blogs/openspecification/msds-supportedencryptiontypes-episode-1-computer-accounts&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_kerberos_properties_encryption"&gt;[FR]ANSSI - Service accounts supported encryption algorithms (vuln3_kerberos_properties_encryption)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558/004"&gt;[MITRE]T1558.004 Steal or Forge Kerberos Tickets: AS-REP Roasting&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>OldAuthenticationProtocols</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-AesNotEnabled</RiskId>
        <Solution>It is recommended to enable AES as an encryption algorithm in the user configuration dialog or in the "msDSSupportedEncryptionTypes" attribute at LDAP level. __    It has to be enabled in the property of an account by checking all the boxes "This account supports Keberos AES XXX encryption".__  __    For GMSA account, you have to manually edit the property msDS-SupportedEncryptionTypes</Solution>
        <TechnicalExplanation>The default encryption algorithm used by Kerberos is RC4, which directly utilizes the NTLM hash of the user’s password.__    However, due to the rapid advancements in computing power, it’s recommended to transition from RC4 to the more secure AES algorithm.__    __ Before disabling RC4, the first step is to enable AES.__ It’s important to note that service accounts and user accounts with the ‘serviceprincipalname’ attribute (also known as SPN) need to be configured to support AES. __ Without this configuration, AES will not be fully operational.__ __ Accounts are listed if :__ 1) no password changed occured after the first DC Win 2008 install to initate AES secrets or __ 2) they have a SPN and the account is not flaged to use AES for encryption with msDS-SupportedEncryptionTypes__ __ Also be advised that other checks must be performed before disabling RC4 (such as trust accounts, ...). A dedicated section in this report explores AES compatibility.__    </TechnicalExplanation>
        <Title>Check the use of Kerberos on services accounts without AES support</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The objective is to assess if krbtgt accounts created for RODC are still associated to a RODC.</Description>
        <Documentation>&lt;a href="https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/mailbag-rodcs-krbtgt-orphans-and-load-balancing-rodc-connection/ba-p/256064"&gt;https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/mailbag-rodcs-krbtgt-orphans-and-load-balancing-rodc-connection/ba-p/256064&lt;/a&gt;&lt;br&gt;__&lt;a href="    https://specterops.io/blog/2023/01/25/at-the-edge-of-tier-zero-the-curious-case-of-the-rodc/"&gt;    https://specterops.io/blog/2023/01/25/at-the-edge-of-tier-zero-the-curious-case-of-the-rodc/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_rodc_orphan_krbtgt"&gt;[FR]ANSSI - Orphan RODC krbtgt accounts (vuln3_rodc_orphan_krbtgt)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>RODC</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>P-RODCKrbtgtOrphan</RiskId>
        <Solution>Firstly, identify the associated Read-Only Domain Controller (RODC) and ensure it has been decommissioned. __    Note that the user executing the scan might not have the necessary permissions to view the RODC.__    You can utilize the following command to list all RODCs:  &lt;i&gt;Get-ADDomainController -Filter {IsReadOnly -eq $true} &lt;/i&gt;__    __    Following this, proceed to delete the associated krbtgt account.__    Disabling the account will not suffice, as all krbtgt accounts are inherently disabled, serving solely as repositories for encryption material.__    Please be aware that once removed, this action cannot be undone.  __    __    </Solution>
        <TechnicalExplanation>Kerberos tickets are digitally signed data structures, authenticated by the hash of the well-known krbtgt password.__    To establish a lower trust level, Read-Only Domain Controllers (RODCs) utilize a unique krbtgt account.__    This account is identifiable by its name, which follows the format ‘krbtgt_XXXX’, where ‘XXXX’ represents a numeric sequence.__    Ideally, when an RODC is decommissioned, its corresponding krbtgt account should also be deleted.__    However, this does not always occur as expected.__    PingCastle is searching these accounts by looking at user objects, starting with krbtgt_ and whose attribute msDS-KrbTgtLinkBl is empty but whose attribute msDS-SecondaryKrbTgtNumber is not empty.__    Note: the special account krbtgt_AzureAD should not be returned by this search__  </TechnicalExplanation>
        <Title>Krbtgt accounts created for RODC not associated anymore to a RODC</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that automatic password rotation for smart card only accounts is in place</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/fr-fr/lifecycle/products/windows-server-2012-r2"&gt;https://learn.microsoft.com/fr-fr/lifecycle/products/windows-server-2012-r2&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-72821"&gt;[US]STIG V-72821 - All accounts, privileged and unprivileged, that require smart cards must have the underlying NT hash rotated at least every 60 days.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.6.2.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R38 [paragraph.3.6.2.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_smartcard_expire_passwords"&gt;[FR]ANSSI - Missing password expiration for smart card users (vuln4_smartcard_expire_passwords)&lt;/a&gt;&lt;span class="badge grade-4"&gt;4&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/002"&gt;[MITRE]T1110.002 Brute Force: Password Cracking&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>PassTheCredential</Model>
        <ReportLocation />
        <RiskId>A-SmartCardPwdRotation</RiskId>
        <Solution>Ensure your domain's functional level is at least Windows Server 2016 or higher.__    Set the msDS-ExpirePasswordsOnSmartCardOnlyAccounts attribute to TRUE at the domain root.__    This action will enable the automatic rotation of the password hash for smart card only accounts. </Solution>
        <TechnicalExplanation>With the introduction of a feature in Windows Server 2016, the password hash for accounts that require smart card authentication can be automatically rotated.__    This is important because when smart card authentication is used, the password itself is not utilized, leading to the password hash remaining unchanged.__    An unchanged password hash over an extended period increases the risk of being brute-forced.__    </TechnicalExplanation>
        <Title>Automatic password rotation for smart card is not in place</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The objective is to assess the vulnerability of the Domain Controller (DC) to Coerce attacks.</Description>
        <Documentation>&lt;a href="https://github.com/p0dalirius/Coercer"&gt;https://github.com/p0dalirius/Coercer&lt;/a&gt;&lt;br&gt;__&lt;a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-restrict-ntlm-outgoing-ntlm-traffic-to-remote-servers"&gt;https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-restrict-ntlm-outgoing-ntlm-traffic-to-remote-servers&lt;/a&gt;&lt;br&gt;__&lt;a href="https://blog.nviso.eu/2023/12/08/rpc-or-not-here-we-log-preventing-exploitation-and-abuse-with-rpc-firewall/"&gt;https://blog.nviso.eu/2023/12/08/rpc-or-not-here-we-log-preventing-exploitation-and-abuse-with-rpc-firewall/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1187"&gt;[MITRE]T1187 Forced Authentication&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>PassTheCredential</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>A-DC-Coerce</RiskId>
        <Solution>To effectively mitigate the vulnerability, consider one of the following approaches:____1. Apply Group Policy Object (GPO) - "Network security: Restrict NTLM: Outgoing NTLM traffic to remote servers":__Apply this GPO specifically to the Organizational Unit (OU) "Domain Controllers".__Caution: Enabling this GPO might impact services dependent on NTLM such as files copy Backups.__Consider setting the GPO in "Audit mode" initially to identify and assess the impact on affected services.____2. Enable RPC Filters in Windows Firewall:__Configure Windows Firewall to block specific Interface IDs associated with vulnerable RPC interfaces.__This is done using the netsh command. See the documentation links for more information.__Exercise caution: This method filters the entire interface, not specific Operation Numbers (OpNum).__Adjust exceptions for necessary services to ensure critical functionality.____3. Implement External Filters (e.g., EDR, Firewalls):__Leverage third-party solutions, such as Endpoint Detection and Response (EDR) tools or firewalls.__Notable project: rpcfirewall https://github.com/zeronetworks/rpcfirewall, offering logical filtering at the OpNum level.__Be cautious of potential impact and ensure compatibility with existing infrastructure.__    </Solution>
        <TechnicalExplanation>Coerce attacks are a category of attacks which aims to forcing domain controllers to authenticate to a device controlled by the attacker for the purpose to relay this authentication to gain privileges.__    This category of attacks is usually mitigated by  applying patch (PetitPotam), disabling services (Spooler), added RPC filter (EDR or firewall) or ensuring integrity (SMB integrity).__  Because each of these protections can be individually bypassed (NTLM integrity is disabled on LDAPS), the aim of this scan is to detect proactively if vulnerable RPC services are exposed.____    PingCastle estimates that Coerceable interfaces are protected if:__- the GPO "Network security: Restrict NTLM: Outgoing NTLM traffic to remote servers" is applied through a GPO to DC__- or if RPC interfaces are not reachable____Because these interfaces need to be tested from a computer controlled by the attacker, PingCastle cannot do this test with reliability.__Instead, it sends a malformed RPC packet to try to trigger an error such as "Permission denied" or "RPC interface unavailable".__If the error RPC_X_BAD_STUB_DATA (1783) is triggered, PingCastle considers that the interface is available.__A report that a vulnerable interface is online may not be accurate because its full exploitation is not tested.____Also to avoid EDR alerts or to not perform the scan, you can run PingCastle with the flag --skip-dc-rpc</TechnicalExplanation>
        <Title>RPC interfaces potentially vulnerable to Coerce attacks</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows Server 2012 for the workstations within the domain</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/fr-fr/lifecycle/products/windows-server-2012-r2"&gt;https://learn.microsoft.com/fr-fr/lifecycle/products/windows-server-2012-r2&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/information/CERTFR-2005-INF-003/#SECTION00032400000000000000"&gt;[FR]ANSSI CERTFR-2005-INF-003&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The detail can be found in &lt;a href="#operatingsystems"&gt;Operating Systems&lt;/a&gt;</ReportLocation>
        <RiskId>S-OS-2012</RiskId>
        <Solution>In order to solve this security issue, you should upgrade all the servers to a more recent version of Windows, starting from Windows Server 2012. __    &lt;i&gt;&lt;strong&gt;Use PingCastle.exe and select export on the main menu. Then choose to export computers. PingCastle will produce a list of all your computers with the OS version in a csv file. You can then use Excel to filter them.&lt;/strong&gt;&lt;/i&gt;__    Do note that you can get the full details regarding the OS used with the following PowerShell command: &lt;i&gt;Get-ADComputer -Filter {(Enabled -eq $true) -and (OperatingSystem -Like "*Server 2012*")} -Property Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion | format-table Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion -Wrap -Auto&lt;/i&gt;</Solution>
        <TechnicalExplanation>The Windows Server 2012 OS is no longer supported, as it is vulnerable to many publicly known exploits: Administrator's credentials can be captured, security protocols are weak, etc.</TechnicalExplanation>
        <Title>Obsolete OS (Windows Server 2012)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows Server 2012 as Domain Controller within the domain</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/fr-fr/lifecycle/products/windows-server-2012-r2"&gt;https://learn.microsoft.com/fr-fr/lifecycle/products/windows-server-2012-r2&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-8551"&gt;[US]STIG V-8551 - The domain functional level must be at a Windows Server version still supported by Microsoft.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsection.3.1"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R12 [subsection.3.1]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_warning_dc_obsolete"&gt;[FR]ANSSI - DC/RODC with an obsolete operating system (vuln1_warning_dc_obsolete)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The operating system of domain controllers can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>S-DC-2012</RiskId>
        <Solution>To resolve this security risk, the only way is to decommission DCs running Windows Server 2012 OS, in order to use new versions that are more secure and that are still being patched regarding new security threats</Solution>
        <TechnicalExplanation>The OS Windows Server 2012 is not supported anymore by Microsoft (except when migrated to Azure, until January 9, 2024) and any vulnerability found will not be patched.</TechnicalExplanation>
        <Title>Obsolete Domain Controller (Windows Server 2012)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that Organizational Units (OUs) and Containers in Active Directory are protected to prevent accidental deletion, which could lead to data loss and disruptions in the network infrastructure.</Description>
        <Documentation>&lt;a href="https://dirteam.com/sander/2011/07/13/preventing-ous-and-containers-from-accidental-deletion/"&gt;https://dirteam.com/sander/2011/07/13/preventing-ous-and-containers-from-accidental-deletion/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>IrreversibleChange</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admindelegation"&gt;Delegations&lt;/a&gt;</ReportLocation>
        <RiskId>P-UnprotectedOU</RiskId>
        <Solution>To safeguard against accidental deletions, it is essential to enable the "Protect object from accidental deletion" option for critical OUs and Containers.__    When this option is enabled, it adds an additional layer of security, preventing unintended deletions.__  To implement this protection:____* Open the Active Directory Users and Computers management console.__* Locate the OU or Container that requires protection.__* Right-click on the OU or Container, select "Properties."__* In the "Object" tab, check the "Protect object from accidental deletion" option.__* Click "Apply" and then "OK" to save the changes.__    __    You can list unprotected OU using the PowerShell command:__  &lt;i&gt;Get-ADOrganizationalUnit -filter {name -like "*"} -Properties ProtectedFromAccidentalDeletion | format-table Name,ProtectedFromAccidentalDeletion&lt;/i&gt;__  and protect them using the command:__  &lt;i&gt;Get-ADOrganizationalUnit -filter {name -like "*"} -Properties ProtectedFromAccidentalDeletion | where {$_.ProtectedFromAccidentalDeletion -eq $false} | Set-ADOrganizationalUnit -ProtectedFromAccidentalDeletion $true&lt;/i&gt;__  __      Note: only 10 will be listed below. Checkout the Delegations section for the complete list.__  </Solution>
        <TechnicalExplanation>In Active Directory, Organizational Units can be protected from accidental deletion (reads: using the del key in the wrong place at the wrong time).__    This way these objects cannot be deleted, unless the protection is removed. This Active Directory feature was first introduced in Windows Server 2008.__    __    This protection consists of a Deny ACE added to the NTSecurityDescriptor attribute applied to Everyone with the flag set to Delete and DeleteTree.__    </TechnicalExplanation>
        <Title>Check if OUs and Containers are protected from accidental deletion.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure proper isolation of administrative activities and to prevent any admin from having an email address configured in the domain.</Description>
        <Documentation>&lt;a href="https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/securing-privileged-access-for-the-ad-admin-part-1/ba-p/259166"&gt;https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/securing-privileged-access-for-the-ad-admin-part-1/ba-p/259166&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>ControlPath</Model>
        <ReportLocation />
        <RiskId>P-AdminEmailOn</RiskId>
        <Solution>Ensure that administrators do not use the privileged account for browsing the internet or receiving emails.__    We highly recommend that you implement this practice to lower the risk of an admin compromise.__    __      To remove this alert, you have to edit the properties of the user account and clear the email attribute.__      Keep in mind that this action will silence the alert, but the risk may still be present.__  </Solution>
        <TechnicalExplanation>The recommended approach for secure administration is to implement a Tier Zero model.__    In this model, low privileged actions cannot be made by highly privileged accounts such as admins.__    This means that, in practice, administrators should have two separate Windows accounts: one for regular activities and one for performing privileged actions.__    </TechnicalExplanation>
        <Title>Check if administrator accounts are email enabled.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that the default location of computers and user OU has not been changed.</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/5a00c890-6be5-4575-93c4-8bf8be0ca8d8"&gt;https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/5a00c890-6be5-4575-93c4-8bf8be0ca8d8&lt;/a&gt;&lt;br&gt;__&lt;a href="https://rickardnobel.se/verify-redirected-computers-container-in-active-directory/"&gt;https://rickardnobel.se/verify-redirected-computers-container-in-active-directory/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1018"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - User Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation />
        <RiskId>S-DefaultOUChanged</RiskId>
        <Solution>You have to use redircmp to set the value back to normal. See documentation for more details__  </Solution>
        <TechnicalExplanation>Default OU such as CN=Computers or CN=Users are stored within the wellKnownObjects attribute of the Domain object.__    There are 12 default locations officialy defined.__    They can be changed using the program redircmp.__    Changing these default can alter the behavior of programs (such as security audit programs) as they may not check the modified objects.__    </TechnicalExplanation>
        <Title>Check if default OU location has been changed within the domain.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that all DC are using the most advanced protocols when acting as server.</Description>
        <Documentation>&lt;a href="https://support.microsoft.com/en-us/topic/kb5017811-manage-transport-layer-security-tls-1-0-and-1-1-after-default-behavior-change-on-september-20-2022-e95b1b47-9c7c-4d64-9baf-610604a64c3e"&gt;https://support.microsoft.com/en-us/topic/kb5017811-manage-transport-layer-security-tls-1-0-and-1-1-after-default-behavior-change-on-september-20-2022-e95b1b47-9c7c-4d64-9baf-610604a64c3e&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.microsoft.com/en-us/help/187498/how-to-disable-pct-1-0-ssl-2-0-ssl-3-0-or-tls-1-0-in-internet-informat"&gt;https://support.microsoft.com/en-us/help/187498/how-to-disable-pct-1-0-ssl-2-0-ssl-3-0-or-tls-1-0-in-internet-informat&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>5</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>A-DCLdapsProtocolAdvanced</RiskId>
        <Solution>Apply Windows updates and registry tweaks described in the documentation section to use Tls 1.2 and later.__  </Solution>
        <TechnicalExplanation>TLS 1.0 and TLS 1.1 are no longer recommended to use, even if there is no pratical attack to could lead to an immediate compromise of the DC.__The SChannel component needs to be tuned in order to not propose these protocols. Many guidelines to handle this problem issued by Microsoft do not talk about SChannel but rather IIS. These guidlines are quoted in the documentation section below.____PingCastle is able to check the SSL version if LDAPS is exposed. LDAPS is automatically exposed once a certificate is available for the DC and the service restarted.__Please note that PingCastle is using the native .Net SSL stack to perform this test. .Net begins to ignore these weak protocols starting the version 4.7 of the framework and as a consequence, PingCasle may miss some weak protocol detection.____To test for these protocols, you can use a version of openssl with the deprecated protocols still compiled in, e.g. openssl-unsafe from Kali Linux, with the following commands:__openssl-unsafe s_client -connect dc.domain.local:636 -tls1 __openssl-unsafe s_client -connect dc.domain.local:636 -tls1_1__    </TechnicalExplanation>
        <Title>Check if LDAPS is using Tls 1.0 or Tls 1.1.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to check if NTLMv1 or LM can be used by DC</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/windows-security/audit-domain-controller-ntlmv1"&gt;https://learn.microsoft.com/en-us/troubleshoot/windows-server/windows-security/audit-domain-controller-ntlmv1&lt;/a&gt;&lt;br&gt;__&lt;a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-restrict-ntlm-ntlm-authentication-in-this-domain"&gt;https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-restrict-ntlm-ntlm-authentication-in-this-domain&lt;/a&gt;&lt;br&gt;__&lt;a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-lan-manager-authentication-level"&gt;https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-lan-manager-authentication-level&lt;/a&gt;&lt;br&gt;__&lt;a href="https://learn.microsoft.com/en-us/troubleshoot/windows-client/windows-security/enable-ntlm-2-authentication"&gt;https://learn.microsoft.com/en-us/troubleshoot/windows-client/windows-security/enable-ntlm-2-authentication&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557/001"&gt;[MITRE]T1557.001 Man-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.6.2.1"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R37 [paragraph.3.6.2.1]&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>OldAuthenticationProtocols</Model>
        <ReportLocation>The detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>S-OldNtlm</RiskId>
        <Solution>After an audit of NTLMv1 usage (see the links below), you need to raise the LAN Manager Authentication Level to "Send NTLMv2 response only. Refuse LM &amp; NTLM".__    This can be done by editing the policy "Network security: LAN Manager authentication level" which can be accessed in Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options__    The policy will be applied after a computer reboot.__    __    Beware that you may break software which is not compatible with Ntlmv2 such as very old Linux stacks or very old Windows before Windows Vista.__    But please note that Ntlmv2 can be activited on all Windows starting Windows 95 and other operating systems.__    </Solution>
        <TechnicalExplanation>NTLMv1 is an old protocol which is known to be vulnerable to cryptographic attacks.__    It is typically used when a hacker sniffs the network and tries to retrieve NTLM hashes which can then be used to impersonate users.__    __    This attack can be combined with coerced authentication attacks - a hacker forces the DC to connect to a controlled host.__    In this case, NTLMv1 can be specified so the hacker can retrieve the NTLM hash of the DC, impersonates it and then take control of the domain.__    This attack is still possible with NTLMv2 but this is more difficult.__    __    Windows has default security settings regarding LM/NTLM. Windows XP: Send LM &amp; NTLM responses, Windows Server 2003: Send NTLM response only, Vista/2008: Win7/2008 R2: Send NTLMv2 response only.__    __    However Domain Controllers have relaxed default settings to accept the connection of older operating systems.__    That means that by default, NTLMv1 is accepted on domain controllers.__    If no GPO defines the LAN Manager Authentication Level, the DC fall back to the non secure default.__    </TechnicalExplanation>
        <Title>Ensure that the NTLMv1 and old LM protocols are banned</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that the regular change of cluster account is active.</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/en-us/windows-server/failover-clustering/configure-ad-accounts"&gt;https://learn.microsoft.com/en-us/windows-server/failover-clustering/configure-ad-accounts&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_password_change_cluster_no_change_3years"&gt;[FR]ANSSI - Windows server cluster accounts with passwords unchanged for more than 3 years (vuln2_password_change_cluster_no_change_3years)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_10/2018-04-06/finding/V-63653"&gt;[US]STIG V-63653 - The computer account password must not be prevented from being reset.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_7/2012-08-22/finding/V-3373"&gt;[US]STIG V-3373 - The maximum age for machine account passwords is not set to requirements.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>InactiveUserOrComputer</Model>
        <ReportLocation />
        <RiskId>S-PwdLastSet-Cluster</RiskId>
        <Solution>__      Certain accounts on Windows server clusters have maintained static passwords for over three years, suggesting a lack of secret refreshes.__      __      To determine why the password hasn’t been updated, you must examine the cluster configuration and event logs.___  Please consult the cited reference document to carry out this process.__    </Solution>
        <TechnicalExplanation>The algorithm identifies clusters by checking three conditions:__1. The account is active, as indicated by the UserAccountControl flag not being set to 2.__2. The account was created at least three years ago but has been used within the last 45 days according to the attribute lastlogontimestamp.__3. The password was last set at least three years prior to the most recent login.__    </TechnicalExplanation>
        <Title>Check if all cluster are using regular password change practices.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is checking the functional level of the domain and the forest, and ensure it is set to the latest secure version</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/active-directory-functional-levels"&gt;https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/active-directory-functional-levels&lt;/a&gt;&lt;br&gt;__&lt;a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/identifying-your-functional-level-upgrade"&gt;https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/identifying-your-functional-level-upgrade&lt;/a&gt;&lt;br&gt;__&lt;a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/identity/raise-active-directory-domain-forest-functional-levels"&gt;https://learn.microsoft.com/en-us/troubleshoot/windows-server/identity/raise-active-directory-domain-forest-functional-levels&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_functional_level"&gt;[FR]ANSSI - Insufficient forest and domains functional levels (vuln3_functional_level)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The functional levels are indicated in &lt;a href="#domaininformation"&gt;Domain Information&lt;/a&gt;</ReportLocation>
        <RiskId>S-FunctionalLevel4</RiskId>
        <Solution>You have to raise the functional level of the domain or the forest (see the details to know if the domain and/or forest is concerned).__    The recommended level is the functional level 7 (Windows Server 2016 / 2019 / 2022)__    __    To upgrade the functional level, a requirement is that all domain controllers are running the right version.__    Also, functional level needs to be upgraded level by level.__    </Solution>
        <TechnicalExplanation>__Each functional level brings new security features:__*  functional level Windows Server 2003: brings forest trusts and read-only domain controller (RODC) support;__*  functional level Windows Server 2008: brings support for modern cryptographic algorithms such as AES and DFS for SYSVOL share replication;__*  functional level Windows Server 2008R2: brings support for Active Directory Recycle Bin (protects objects against accidental deletion);__*  functional level Windows Server 2012: brings advanced Kerberos features, such as compound authentication and claims support;__*  functional level Windows Server 2012R2: brings numerous new security features such as authentication policies, authentication policy silos and the Protected users group;__*  functional level Windows Server 2016 / 2019 / 2022: brings an upgraded smart card logon security and Privileged Identity Management (PIM) trust relationships between forests.__    </TechnicalExplanation>
        <Title>Ensure that the functional level of the domain and the forest are up to date to use the latest security features</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is checking the functional level of the domain and the forest, and ensure it is set to the latest secure version</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/active-directory-functional-levels"&gt;https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/active-directory-functional-levels&lt;/a&gt;&lt;br&gt;__&lt;a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/identifying-your-functional-level-upgrade"&gt;https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/identifying-your-functional-level-upgrade&lt;/a&gt;&lt;br&gt;__&lt;a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/identity/raise-active-directory-domain-forest-functional-levels"&gt;https://learn.microsoft.com/en-us/troubleshoot/windows-server/identity/raise-active-directory-domain-forest-functional-levels&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_functional_level"&gt;[FR]ANSSI - Insufficient forest and domains functional levels (vuln3_functional_level)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The functional levels are indicated in &lt;a href="#domaininformation"&gt;Domain Information&lt;/a&gt;</ReportLocation>
        <RiskId>S-FunctionalLevel3</RiskId>
        <Solution>You have to raise the functional level of the domain or the forest (see the details to know if the domain and/or forest is concerned).__    The recommended level is the functional level 7 (Windows Server 2016 / 2019 / 2022)__    __    To upgrade the functional level, a requirement is that all domain controllers are running the right version.__    Also, functional level needs to be upgraded level by level.__    </Solution>
        <TechnicalExplanation>__Each functional level brings new security features:__*  functional level Windows Server 2003: brings forest trusts and read-only domain controller (RODC) support;__*  functional level Windows Server 2008: brings support for modern cryptographic algorithms such as AES and DFS for SYSVOL share replication;__*  functional level Windows Server 2008R2: brings support for Active Directory Recycle Bin (protects objects against accidental deletion);__*  functional level Windows Server 2012: brings advanced Kerberos features, such as compound authentication and claims support;__*  functional level Windows Server 2012R2: brings numerous new security features such as authentication policies, authentication policy silos and the Protected users group;__*  functional level Windows Server 2016 / 2019 / 2022: brings an upgraded smart card logon security and Privileged Identity Management (PIM) trust relationships between forests.__    </TechnicalExplanation>
        <Title>Ensure that the functional level of the domain and the forest are up to date to use the latest security features</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is checking the functional level of the domain and the forest, and ensure it is set to the latest secure version</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/active-directory-functional-levels"&gt;https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/active-directory-functional-levels&lt;/a&gt;&lt;br&gt;__&lt;a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/identifying-your-functional-level-upgrade"&gt;https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/identifying-your-functional-level-upgrade&lt;/a&gt;&lt;br&gt;__&lt;a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/identity/raise-active-directory-domain-forest-functional-levels"&gt;https://learn.microsoft.com/en-us/troubleshoot/windows-server/identity/raise-active-directory-domain-forest-functional-levels&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_functional_level"&gt;[FR]ANSSI - Insufficient forest and domains functional levels (vuln1_functional_level)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The functional levels are indicated in &lt;a href="#domaininformation"&gt;Domain Information&lt;/a&gt;</ReportLocation>
        <RiskId>S-FunctionalLevel1</RiskId>
        <Solution>You have to raise the functional level of the domain or the forest (see the details to know if the domain and/or forest is concerned).__    The recommended level is the functional level 7 (Windows Server 2016 / 2019 / 2022)__    __    To upgrade the functional level, a requirement is that all domain controllers are running the right version.__    Also, functional level needs to be upgraded level by level.__    </Solution>
        <TechnicalExplanation>__Each functional level brings new security features:__*  functional level Windows Server 2003: brings forest trusts and read-only domain controller (RODC) support;__*  functional level Windows Server 2008: brings support for modern cryptographic algorithms such as AES and DFS for SYSVOL shared replication;__*  functional level Windows Server 2008R2: brings support for Active Directory Recycle Bin (protects objects against accidental deletion);__*  functional level Windows Server 2012: brings advanced Kerberos features, such as compound authentication and claims support;__*  functional level Windows Server 2012R2: brings numerous new security features such as authentication policies, authentication policy silos and the Protected users group;__*  functional level Windows Server 2016 / 2019 / 2022: brings an upgraded smart card logon security and Privileged Identity Management (PIM) trust relationships between forests.__    </TechnicalExplanation>
        <Title>Ensure that the functional level of the domain and the forest are up to date to use the latest security features</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that scripts used for the customization of admin UI are stored safely</Description>
        <Documentation>&lt;a href="https://www.semperis.com/blog/active-directory-security-abusing-display-specifiers/"&gt;https://www.semperis.com/blog/active-directory-security-abusing-display-specifiers/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://learn.microsoft.com/en-us/windows/win32/ad/display-specifiers"&gt;https://learn.microsoft.com/en-us/windows/win32/ad/display-specifiers&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_display_specifier"&gt;[FR]ANSSI - Dangerous Display Specifiers (vuln1_display_specifier)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1569"&gt;[MITRE]T1569 System Services&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>AccountTakeOver</Model>
        <ReportLocation />
        <RiskId>P-DisplaySpecifier</RiskId>
        <Solution>The scripts identified by this rule should be moved to the SYSVOL and properly secured.</Solution>
        <TechnicalExplanation>DisplaySpecifier are Active Directory objects stored in the DisplaySpecifier container of the Configuration naming context.__    They are used to customize the user interface.__    Specifically the attribute adminContextMenu is used to customize administration actions, where COM objects or scripts can be called.__    If the script is stored outside the SYSVOL directory, it can be used to execute custom actions and it is run under the administrator context.__    </TechnicalExplanation>
        <Title>Ensure that custom Display Specifiers are stored in SYSVOL</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that clients support Kerberos armoring when domain functional level is at least Windows Server 2012</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831747(v=ws.11)"&gt;https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831747(v=ws.11)&lt;/a&gt;&lt;br&gt;__&lt;a href="    https://pupuweb.com/solved-how-enable-kerberos-armoring-eap-fast-ad/"&gt;    https://pupuweb.com/solved-how-enable-kerberos-armoring-eap-fast-ad/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558"&gt;[MITRE]T1558 Steal or Forge Kerberos Tickets&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>If activated, the detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>S-KerberosArmoring</RiskId>
        <Solution>To enable Kerberos armoring for client, edit the GPO and go to Computer Configuration &gt; Administrative Templates &gt; System &gt; Kerberos__    then enable the policy "Kerberos client support for claims, compound authentication and Kerberos armoring".</Solution>
        <TechnicalExplanation>Kerberos Armoring is an optimization of the Kerberos protocol. It avoids the pre-authentication steps thus prohibiting pre-authentication attacks;__    It is supported only starting Windows Server 2012 DC and Windows 8 workstations.__    If Kerberos armoring is requested for other operating systems (such as Windows 7 or Linux), the Kerberos authentication protocol may refuse to work.__    </TechnicalExplanation>
        <Title>Ensure that clients support Kerberos armoring when the domain functional level is at least Windows Server 2012</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that DC supports Kerberos armoring when functional level is at least Windows Server 2012</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831747(v=ws.11)"&gt;https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831747(v=ws.11)&lt;/a&gt;&lt;br&gt;__&lt;a href="    https://pupuweb.com/solved-how-enable-kerberos-armoring-eap-fast-ad/"&gt;    https://pupuweb.com/solved-how-enable-kerberos-armoring-eap-fast-ad/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558"&gt;[MITRE]T1558 Steal or Forge Kerberos Tickets&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>If activated, the detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>S-KerberosArmoringDC</RiskId>
        <Solution>To enable Kerberos armoring for domain controllers, edit the GPO and go to Computer Configuration &gt; Administrative Templates &gt; System &gt; KDC__    then enable the policy "KDC support for claims, compound authentication and Kerberos armoring".__  The policy should be set to at least "Supported".__  __The safest settings is "Fail authentication requests when Kerberos armoring is not available" but it should be enabled only if the clients support Kerberos armoring.</Solution>
        <TechnicalExplanation>Kerberos Armoring is an optimization of the Kerberos protocol. It avoids the pre-authentication steps and thereby prevents pre-authentication attacks.__    It is supported only starting Windows Server 2012 DC and Windows 8 workstations.__    If Kerberos Armoring is requested for other operating systems (such as Windows 7 or Linux), the Kerberos authentication protocol may refuse to work.__    </TechnicalExplanation>
        <Title>Ensure that DC supports Kerberos armoring when functional level is at least Windows Server 2012</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that DC cannot connect with normal command line to a HTTP server</Description>
        <Documentation>&lt;a href="https://gist.github.com/gladiatx0r/1ffe59031d42c08603a3bde0ff678feb#rpc-to-rce-steps"&gt;https://gist.github.com/gladiatx0r/1ffe59031d42c08603a3bde0ff678feb#rpc-to-rce-steps&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1187"&gt;[MITRE]T1187 Forced Authentication&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>PassTheCredential</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>A-DC-WebClient</RiskId>
        <Solution>If the WebClient service is in official use (typically from backup applications), disable the service.</Solution>
        <TechnicalExplanation>By default, Windows computers supports only UNC paths (aka \\server\path).__    The WebDAV protocol, implemented with HTTP, enables files on webserver to be managed as on a classic file share.__    The role of the WebClient service is to provide as a native API call a service to manage files located on a WebDAV server (HTTP URLs).__    If the WebClient service is active, command line tools and services can access files on a webserver without any specifc action.__ __    When forced authentication attacks are being used (Print Spooler, PetitPotam, ...) and if this service is in use, the DC can connect to webservers.__    An attacker can abuse this service to bypass classic detection rules but this does not represent a vulnerability in itself.____    It is not expected that Domain Controllers access WebDAV services but please note that some backup software is known to use cloud connection and thus, requires it.__    This is why this rule is classify as informative.__    __    Also please note that WebClient can be remotely started using a 'Search Connector' file. See the details in the link below.__    </TechnicalExplanation>
        <Title>Ensure that the WebClient client cannot be abused to force a DC connection to a HTTP server</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose of this rule is to ensure that no certificate request templates allow users to control the subject</Description>
        <Documentation>&lt;a href="https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4"&gt;https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4&lt;/a&gt;&lt;br&gt;__&lt;a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-26931"&gt;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-26931&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_adcs_template_auth_enroll_with_name"&gt;[FR]ANSSI - Dangerous enrollment permission on authentication certificate templates (vuln1_adcs_template_auth_enroll_with_name)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558"&gt;[MITRE]T1558 Steal or Forge Kerberos Tickets&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificatetemplates"&gt;Certificate Templates&lt;/a&gt;</ReportLocation>
        <RiskId>A-CertTempNoSecurity</RiskId>
        <Solution>Edit the certificate template object and specifically the attribute msPKI-Enrollment-Flag.__     Unset the flag CT_FLAG_NO_SECURITY_EXTENSION (0x80000) aka substract the value 524288 from the attribute msPKI-Enrollment-Flag.__    </Solution>
        <TechnicalExplanation>Certificate requests are tracked by UPN and dnsHost name for computers.__    Usually, editing dnsHost change the value of the attribute servicePrincipalName and duplications are prohibited.__  But there is no constraint on the dnsHost attribute and a controlled change of this attribute (without changing the SPN) can lead to duplicates.__An attacker can then change the DNS of a compromise host to the DC DNS and request a certificate on behalf the DC, thus impersonating it and controlling the domain.</TechnicalExplanation>
        <Title>Check if authentication certificate templates disallow the tracking of the certificate requester</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Trusts</Category>
        <Description>The purpose is to check if AES can be used with Kerberos on trusts</Description>
        <Documentation>&lt;a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/tough-questions-answered-can-i-disable-rc4-etype-for-kerberos-on/ba-p/382718"&gt;https://techcommunity.microsoft.com/t5/itops-talk-blog/tough-questions-answered-can-i-disable-rc4-etype-for-kerberos-on/ba-p/382718&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/6cfc7b50-11ed-4b4d-846d-6f08f0812919"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/6cfc7b50-11ed-4b4d-846d-6f08f0812919&lt;/a&gt;&lt;br&gt;__&lt;a href="https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/decrypting-the-selection-of-supported-kerberos-encryption-types/ba-p/1628797"&gt;https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/decrypting-the-selection-of-supported-kerberos-encryption-types/ba-p/1628797&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>OldTrustProtocol</Model>
        <RiskId>T-AlgsAES</RiskId>
        <Solution>Enable AES on the domain.__    __    Beware: there is a checkbox in the trust properties named "The other domain supports Kerberos AES Encryption".__    If you enable this setting, AES will be enabled but RC4 will also be disabled.__    __    The recommended way is to enable both RC4 and AES as a transition. It can be done by running the command:__    &lt;i&gt;ksetup /setenctypeattr mytrust.com RC4-HMAC-MD5 AES128-CTS-HMAC-SHA1-96 AES256-CTS-HMAC-SHA1-96&lt;/i&gt;__    __      This way, the attribute msDS-SupportedEncryptionTypes of the trust will be modified to support both RC4 and AES.__  </Solution>
        <TechnicalExplanation>By default, RC4 is used as the signature algorithm on Kerberos tickets.__    If AES is enabled on a domain and AES is not enabled on trust, AES tickets will not be usable on the trust. The Kerberos tickets sent to the trust will fail or the trusted domain will fallback to NTLM.__    __    The encryption algorithms allowed for a trust are stored in an attribute named msDS-SupportedEncryptionTypes.__    If this attribute is not set (or has a value of zero), RC4 will be applied by default.__    Else, it defines the algorithm to use for Kerberos signature.__</TechnicalExplanation>
        <Title>Check if AES is enabled on trusts</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to check if the Extended protection for HTTPS access to the certificate enrollment interface is in place</Description>
        <Documentation>&lt;a href="https://support.microsoft.com/en-us/topic/kb5005413-mitigating-ntlm-relay-attacks-on-active-directory-certificate-services-ad-cs-3612b773-4043-4aa9-b23d-b87910cd3429"&gt;https://support.microsoft.com/en-us/topic/kb5005413-mitigating-ntlm-relay-attacks-on-active-directory-certificate-services-ad-cs-3612b773-4043-4aa9-b23d-b87910cd3429&lt;/a&gt;&lt;br&gt;__&lt;a href="https://dirkjanm.io/ntlm-relaying-to-ad-certificate-services/"&gt;https://dirkjanm.io/ntlm-relaying-to-ad-certificate-services/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.riskinsight-wavestone.com/en/2021/06/microsoft-adcs-abusing-pki-in-active-directory-environment/"&gt;https://www.riskinsight-wavestone.com/en/2021/06/microsoft-adcs-abusing-pki-in-active-directory-environment/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557"&gt;[MITRE]T1557 Man-in-the-Middle&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <RiskId>A-CertEnrollChannelBinding</RiskId>
        <Solution>The Extended Protection for Authentication (EPA, also called Channel Binding) should be activated on the enrollment server.__    __    This can be achieved by opening the IIS console on the enrollment server.__    In the Authentcation settings, open the Advanced Settings for the Windows Authentication.__    Set "Extended Protection" to "Required".__    __    Do this operation for the Certification Authority Web Enrollment (WebEnrollment) and Certificate Enrollment Web Service (CES).__    __    See the link to KB5005413 below for more information. This KB also suggest to restrict the authentication to Kerberos only.__  </Solution>
        <TechnicalExplanation>The Windows PKI, also named Active Directory Certificate Services (ADCS), can be used to request certificates.__Two services can be used: Certification Authority Web Enrollment (WebEnrollment) and Certificate Enrollment Web Service (CES).__The certificates provided by these services can be used with Kerberos to login.__    __ Because this service can deliver certificates for Domain Controller, it can be considered as part of Tier 0.__As a legacy service, the mechanisms to prohibit credential relay are not enforced by default.__If an attacker is able to relay privileged credentials (for example with the PetitPotam attack), it can be used to take control of the domain.__    __To avoid this attack with HTTPS, a feature named Channel Binding exists. It consists of passing to the authentication layer a property of the TLS channel (typically a hash of the server certificate) to bind the outer channel (TLS) and the inner channel (HTTP).__This protection is also called "Extended Protection". See rfc5929 for more details.__    __PingCastle is looking for enrollment servers registered in the Active Directory.__It then connect to the special page https://xxx/certsrv/certrqxt.asp and https://xxx/yyy_CES_Kerberos/service.svc__An authentication is attempted with and without Channel Binding.__    __False positives may exists if the PingCastle program is run on the server tested. That's why, if PingCastle is run on the server, the server will not be tested.__</TechnicalExplanation>
        <Title>Check if Extended Protection is in place for certificate requests</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to check if HTTP can be used to access the certificate enrollment interface</Description>
        <Documentation>&lt;a href="https://support.microsoft.com/en-us/topic/kb5005413-mitigating-ntlm-relay-attacks-on-active-directory-certificate-services-ad-cs-3612b773-4043-4aa9-b23d-b87910cd3429"&gt;https://support.microsoft.com/en-us/topic/kb5005413-mitigating-ntlm-relay-attacks-on-active-directory-certificate-services-ad-cs-3612b773-4043-4aa9-b23d-b87910cd3429&lt;/a&gt;&lt;br&gt;__&lt;a href="https://dirkjanm.io/ntlm-relaying-to-ad-certificate-services/"&gt;https://dirkjanm.io/ntlm-relaying-to-ad-certificate-services/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.riskinsight-wavestone.com/en/2021/06/microsoft-adcs-abusing-pki-in-active-directory-environment/"&gt;https://www.riskinsight-wavestone.com/en/2021/06/microsoft-adcs-abusing-pki-in-active-directory-environment/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.vkernel.ro/blog/installing-and-configuring-cep-and-ces-for-certificate-enrolling-on-non-domain-joined-computers"&gt;https://www.vkernel.ro/blog/installing-and-configuring-cep-and-ces-for-certificate-enrolling-on-non-domain-joined-computers&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557"&gt;[MITRE]T1557 Man-in-the-Middle&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <RiskId>A-CertEnrollHttp</RiskId>
        <Solution>The access to certificate enrollment with HTTP should be disabled.__    __This can be achieved by opening the IIS console on the enrollment server.__If the service quoted in detail is WebEnrollment, the url is certsrv, else it is ending by CES_Keberos.____In the Binding setting (link at the right), keep the HTTPS binding and remove the HTTP binding.__See the link to KB5005413 in references for more information.__    __Note: By default, the CES service is not accessible by HTTP.__  </Solution>
        <TechnicalExplanation>The Windows PKI, also named Active Directory Certificate Services (ADCS), can be used to request certificates.__Two services can be used: Certification Authority Web Enrollment (WebEnrollment) and Certificate Enrollment Web Service (CES).__The certificates provided by these services can be used with Kerberos to login.__    __Because this service can deliver certificates for Domain Controllers, it can be considered as part of Tier 0.__As a legacy service, the mechanisms to prohibit credential relay are not enforced by default.__If an attacker is able to relay privileged credentials (for example with the PetitPotam attack), it can be used to take control of the domain.__        __PingCastle is looking for enrollment servers registered in the Active Directory (pKIEnrollmentService objects).__It then connects to the special page http://xxx/certsrv/certrqxt.asp and http://xxx/yyy_CES_Kerberos/services.svc and tries to access the page with authentication.__    __If the authentication succeed and no error is returned,the program considers the interface accessible.__    __False positives may exists if the PingCastle program is run on the server tested. That's why, if PingCastle is run on the server, the server will not be tested.__</TechnicalExplanation>
        <Title>Check if certificate enrollment can be done with HTTP</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to check if signing is really required for LDAP</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-US/troubleshoot/windows-server/identity/enable-ldap-signing-in-windows-server"&gt;https://docs.microsoft.com/en-US/troubleshoot/windows-server/identity/enable-ldap-signing-in-windows-server&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.microsoft.com/en-us/topic/2020-2023-and-2024-ldap-channel-binding-and-ldap-signing-requirements-for-windows-kb4520412-ef185fb8-00f7-167d-744c-f299a66fc00a"&gt;https://support.microsoft.com/en-us/topic/2020-2023-and-2024-ldap-channel-binding-and-ldap-signing-requirements-for-windows-kb4520412-ef185fb8-00f7-167d-744c-f299a66fc00a&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/zyn3rgy/LdapRelayScan"&gt;https://github.com/zyn3rgy/LdapRelayScan&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557"&gt;[MITRE]T1557 Man-in-the-Middle&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>NetworkSniffing</Model>
        <RiskId>A-DCLdapSign</RiskId>
        <Solution>You have to make sure that ALL LDAP clients are compatible with LDAP signature.__All versions of Windows since XP support this and also most of the Unix clients.____You have to follow the Microsoft article quoted in reference to enable LDAP signing.__This includes auditing the clients which are not compatible and instructions on how to enforce this policy.</Solution>
        <TechnicalExplanation>If the the request for signing of each LDAP request is not enforced, a man in the middle can be performed on an LDAP connection.__For example to add a user to the admin group.__    __This test is made by ignoring the local computer security policies.__Signature enforcement is done by setting the flag ISC_REQ_INTEGRITY when initializig the Negotiate / NTLM / Kerberos authentication.__The opposite test is made with the flag ISC_REQ_NO_INTEGRITY set.__    __PingCastle is testing if this setting is in place by performing a LDAP authentication with and without signature enforcement.__False positives may exists if the PingCastle program is run on the server tested. That's why, if PingCastle is run on a DC, the DC will not be tested.__</TechnicalExplanation>
        <Title>Check if signing is really required for LDAP</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to check if the Channel Binding feature of LDAPS is enforced</Description>
        <Documentation>&lt;a href="https://support.microsoft.com/en-us/topic/use-the-ldapenforcechannelbinding-registry-entry-to-make-ldap-authentication-over-ssl-tls-more-secure-e9ecfa27-5e57-8519-6ba3-d2c06b21812e"&gt;https://support.microsoft.com/en-us/topic/use-the-ldapenforcechannelbinding-registry-entry-to-make-ldap-authentication-over-ssl-tls-more-secure-e9ecfa27-5e57-8519-6ba3-d2c06b21812e&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.microsoft.com/en-us/topic/2020-2023-and-2024-ldap-channel-binding-and-ldap-signing-requirements-for-windows-kb4520412-ef185fb8-00f7-167d-744c-f299a66fc00a"&gt;https://support.microsoft.com/en-us/topic/2020-2023-and-2024-ldap-channel-binding-and-ldap-signing-requirements-for-windows-kb4520412-ef185fb8-00f7-167d-744c-f299a66fc00a&lt;/a&gt;&lt;br&gt;__&lt;a href="https://oxfordcomputergroup.com/resources/ldap-channel-binding-signing-requirements/"&gt;https://oxfordcomputergroup.com/resources/ldap-channel-binding-signing-requirements/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/zyn3rgy/LdapRelayScan"&gt;https://github.com/zyn3rgy/LdapRelayScan&lt;/a&gt;&lt;br&gt;__&lt;a href="https://access.redhat.com/articles/4661861"&gt;https://access.redhat.com/articles/4661861&lt;/a&gt;&lt;br&gt;__&lt;a href="http://gary-nebbett.blogspot.com/2020/01/ldap-channel-binding.html"&gt;http://gary-nebbett.blogspot.com/2020/01/ldap-channel-binding.html&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557"&gt;[MITRE]T1557 Man-in-the-Middle&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>NetworkSniffing</Model>
        <RiskId>A-DCLdapsChannelBinding</RiskId>
        <Solution>You have to make sure that ALL LDAPS clients are compatible with Channel Binding.__All supported Windows have been updated since March 2020 to take this into account and also most of the Unix clients (see the RedHat bulletin link below).____You can start auditing via registry, on each domain controller__Reg Add HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Diagnostics /v "16 LDAP Interface Events" /t REG_DWORD /d 2__Then monitor the Windows event IDs 3039 and 3040.____Once it has been verified that all clients are compatible, Channel Binding can be enforced:__create the key LdapEnforceChannelBinding in HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters and set its value to 1 or 2__    </Solution>
        <TechnicalExplanation>LDAPS (opposed to LDAP) does not allow message signature because this protection is made by the TLS layer.__As a consequence, forged LDAP packets can be relayed in a TLS tunnel, thus becoming LDAPS and without any protection against relay.____To avoid this attack, a feature named Channel Binding exists. It consists of passing to the authentication layer a property of the TLS channel (typically a hash of the server certificate) to bind the outer channel (TLS) and the inner channel (LDAP).__This protection is also called "Extended Protection".____PingCastle is testing if this binding is in place by performing a LDAPS authentication with Channel Binding enabled and disabled.__False positives may exists if the PingCastle program is run on the server tested. That's why, if PingCastle is run on a DC, the DC will not be tested.__</TechnicalExplanation>
        <Title>Check if the Channel Binding is enabled for LDAPS</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to check if Authenticated Users has the right to create DNS records</Description>
        <Documentation>&lt;a href="https://www.ws-its.de/gegenmassnahme-zum-angriff-dns-wildcard/"&gt;https://www.ws-its.de/gegenmassnahme-zum-angriff-dns-wildcard/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.netspi.com/blog/technical/network-penetration-testing/exploiting-adidns/"&gt;https://www.netspi.com/blog/technical/network-penetration-testing/exploiting-adidns/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557"&gt;[MITRE]T1557 Man-in-the-Middle&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>NetworkSniffing</Model>
        <RiskId>A-DnsZoneAUCreateChild</RiskId>
        <Solution>As of today, this rule is considered "informative" because the default configuration where Authenticated Users can create DNS records is considered safe.__  The reason for this classification is that no exploitation of that vulnerability has been reported.__    __The proposed enhancement is to replace the identity who has been granted the right to create DNS Records (permission CreateChild) from Authenticated Users to Domain Computers.__To perform this change, you have to edit the permission of the DNSZone whose object is located in the container CN=MicrosoftDNS,DC=DomainDnsZones.____It should be noticed that if there is a privilege escalation on a computer, an attacker can impersonate the computer account and bypass this mitigation.____The best mitigation is to create the DNS records manually as part as the domain join process and to revoke the permission granted to Authenticated Users.__    </Solution>
        <TechnicalExplanation>When a computer is joined to a domain, a DNS record is created in the DnsZone to allow the computer to update its DNS settings.__    By design, Microsoft choose to grant to the group Authenticated Users (aka every computers and users) the right to create DNS records.__    Once created, only the owner keeps the right to edit the new object.__    __    The vulnerability is that specific DNS records can be created to perform man-in-the-middle attacks.__    One example is to create a wildcard record (a record with the name "*"), a failover DNS record or anticipating the creation of a DNS record with the right permissions.__</TechnicalExplanation>
        <Title>Check if Authenticated Users can create DNS records</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that the Guest account of the domain is not enabled</Description>
        <Documentation>&lt;a href="https://attack.mitre.org/techniques/T1078/003"&gt;[MITRE]T1078.003 Valid Accounts: Local Accounts&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>WeakPassword</Model>
        <ReportLocation />
        <RiskId>A-Guest</RiskId>
        <Solution>You have to find the Guest account and disable it.</Solution>
        <TechnicalExplanation>The Guest account is a special account whose SID is S-1-5-domain-501. It is used as a non-nominative account to allow anyone to connect to the Active Directory.__Unless there is a justification about its activation, this represents a security issue because anybody can use this account to connect to any computer without any trace.</TechnicalExplanation>
        <Title>Check if the guest account is enabled</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of non-supported version of Windows 10 or Windows 11 within the domain</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows/release-health/release-information"&gt;https://docs.microsoft.com/en-us/windows/release-health/release-information&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/information/CERTFR-2005-INF-003/#SECTION00032400000000000000"&gt;[FR]ANSSI CERTFR-2005-INF-003&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The detail can be found in &lt;a href="#operatingsystems"&gt;Operating Systems&lt;/a&gt;</ReportLocation>
        <RiskId>S-OS-W10</RiskId>
        <Solution>In order to solve this security issue, you should upgrade all the Windows 10 or Windows 11 to a more recent version.    __    &lt;i&gt;&lt;strong&gt;Use PingCastle.exe and select export on the main menu. Then choose to export computers. PingCastle will produce a list of all your computers with the OS version in a csv file. You can then use Excel to filter them.&lt;/strong&gt;&lt;/i&gt;    __    Do note that you can get the full details regarding the OS used with the following PowerShell command: &lt;i&gt;Get-ADComputer -Filter {(Enabled -eq $true) -and (OperatingSystem -Like "*Windows 10*")} -Property Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion | format-table Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion -Wrap -Auto&lt;/i&gt;</Solution>
        <TechnicalExplanation>Some versions of Windows 10 and Windows 11 OS are no longer supported, and may be vulnerable to exploits that are not patched anymore.</TechnicalExplanation>
        <Title>Obsolete OS (Windows 10 or Windows 11)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows 8 for the workstations within the domain</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/information/CERTFR-2005-INF-003/#SECTION00032400000000000000"&gt;[FR]ANSSI CERTFR-2005-INF-003&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The detail can be found in &lt;a href="#operatingsystems"&gt;Operating Systems&lt;/a&gt;</ReportLocation>
        <RiskId>S-OS-Win8</RiskId>
        <Solution>In order to solve this security issue, you should upgrade all the workstations to a more recent version of Windows, starting from Windows 10.     __    &lt;i&gt;&lt;strong&gt;Use PingCastle.exe and select export on the main menu. Then choose to export computers. PingCastle will produce a list of all your computers with the OS version in a csv file. You can then use Excel to filter them.&lt;/strong&gt;&lt;/i&gt;        __    Do note that you can get the full details regarding the OS used with the following PowerShell command: &lt;i&gt;Get-ADComputer -Filter {(Enabled -eq $true) -and (OperatingSystem -Like "*Windows 8*")} -Property Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion | format-table Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion -Wrap -Auto&lt;/i&gt;</Solution>
        <TechnicalExplanation>The Windows 8 OS is no longer supported, as it is vulnerable to many publicly known exploits: Administrator's credentials can be captured, security protocols are weak, etc.</TechnicalExplanation>
        <Title>Obsolete OS (Windows 8)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to identify domains having mitigation for CVE-2021-42291 not set to enabled</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/e5899be4-862e-496f-9a38-33950617d2c5"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/e5899be4-862e-496f-9a38-33950617d2c5&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.microsoft.com/en-au/topic/kb5008383-active-directory-permissions-updates-cve-2021-42291-536d5555-ffba-4248-a60e-d6cbc849cde1"&gt;https://support.microsoft.com/en-au/topic/kb5008383-active-directory-permissions-updates-cve-2021-42291-536d5555-ffba-4248-a60e-d6cbc849cde1&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_dsheuristics_bad"&gt;[FR]ANSSI - Dangerous dsHeuristics settings (vuln3_dsheuristics_bad)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1187"&gt;[MITRE]T1187 Forced Authentication&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>Reconnaissance</Model>
        <RiskId>A-DsHeuristicsLDAPSecurity</RiskId>
        <Solution>The easiest and fastest way to correct this issue is to &lt;b&gt;replace the 28th and 29th character of the DsHeuristics attribute&lt;/b&gt;.__    The value of LDAPAddAutZVerifications and LDAPOwnerModify should be set to 1.__    __    Open the procedure embedded into the KB5008383 to apply this mitigation and change the DsHeuristics value.__    __    Note: You have to pay attention that there are control characters at the 10th and 20th position to avoid undesired changes of the DsHeuristics attribute.__    Typically if the DsHeuristics is empty, the expected new value is 00000000010000000002000000011__    </Solution>
        <TechnicalExplanation>The way an Active Directory behaves can be controlled via the attribute &lt;i&gt;DsHeuristics&lt;/i&gt; of &lt;i&gt;CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration&lt;/i&gt;.__    A parameter stored in its attribute and whose value is &lt;i&gt;LDAPAddAutZVerifications&lt;/i&gt; and &lt;i&gt;LDAPOwnerModify&lt;/i&gt; can be set to modify the mitigatation of CVE-2021-42291.__The KB5008383 has introduced changes to default security descriptor of Computer containers to add audit and limit computer creation without being admin.__Indeed, it is recommended to not let anyone create computer accounts as they can be used to abuse Kerberos or to perform relay attacks.____Mitigations in CVE-2021-42291 consist of 3 choices to be set on 2 settings.__They are named LDAPAddAutZVerifications and LDAPOwnerModify and are respectively the 28th and 29th character of this string.__For the expected values:__- With the value 0 (the default), it enables an additional audit mechanism__- With the value 1 (recommended), it enforces new security permissions, especially to require an action of the domain admin when unusual actions are performed__- With the value 2 (not recommended), it disables the audit mechanism that has been added by default and do not enable the new security permissions__</TechnicalExplanation>
        <Title>Check if the mitigation for CVE-2021-42291 has been enabled</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to identify domains having the SPN and UPN uniqueness check disabled</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/e5899be4-862e-496f-9a38-33950617d2c5"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/e5899be4-862e-496f-9a38-33950617d2c5&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.microsoft.com/en-us/topic/kb5008382-verification-of-uniqueness-for-user-principal-name-service-principal-name-and-the-service-principal-name-alias-cve-2021-42282-4651b175-290c-4e59-8fcb-e4e5cd0cdb29"&gt;https://support.microsoft.com/en-us/topic/kb5008382-verification-of-uniqueness-for-user-principal-name-service-principal-name-and-the-service-principal-name-alias-cve-2021-42282-4651b175-290c-4e59-8fcb-e4e5cd0cdb29&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_dsheuristics_bad"&gt;[FR]ANSSI - Dangerous dsHeuristics settings (vuln2_dsheuristics_bad)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1187"&gt;[MITRE]T1187 Forced Authentication&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>Reconnaissance</Model>
        <RiskId>A-DsHeuristicsDoNotVerifyUniqueness</RiskId>
        <Solution>The easiest and fastest way to correct this issue is to &lt;b&gt;replace the 21th character of the DsHeuristics attribute&lt;/b&gt;. If it is not a 0, replace by 0 to fix the issue.</Solution>
        <TechnicalExplanation>The way an Active Directory behaves can be controlled via the attribute &lt;i&gt;DsHeuristics&lt;/i&gt; of &lt;i&gt;CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration&lt;/i&gt;. A parameter stored in its attribute and whose value is &lt;i&gt;DoNotVerifyUPNAndOrSPNUniqueness&lt;/i&gt; can be set to disable the UPN or SPN check.__This setting has been introduced to overwrite the mitigation of the vulnerability CVE-2021-42282 fixed by the KB5008382.</TechnicalExplanation>
        <Title>Check if the UPN and SPN uniqueness check has been disabled</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that all WSUS servers don't use weak SSL protocols.</Description>
        <Documentation>&lt;a href="https://social.technet.microsoft.com/wiki/contents/articles/2249.windows-server-20082008r2-how-to-disable-sslv2-on-domain-controller-dsforum2wiki.aspx"&gt;https://social.technet.microsoft.com/wiki/contents/articles/2249.windows-server-20082008r2-how-to-disable-sslv2-on-domain-controller-dsforum2wiki.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.microsoft.com/en-us/help/187498/how-to-disable-pct-1-0-ssl-2-0-ssl-3-0-or-tls-1-0-in-internet-informat"&gt;https://support.microsoft.com/en-us/help/187498/how-to-disable-pct-1-0-ssl-2-0-ssl-3-0-or-tls-1-0-in-internet-informat&lt;/a&gt;&lt;br&gt;__&lt;a href="https://adsecurity.org/?p=376"&gt;https://adsecurity.org/?p=376&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in the &lt;a href="#WSUSsettings"&gt;WSUS settings&lt;/a&gt; section.</ReportLocation>
        <RiskId>A-WSUS-SslProtocol</RiskId>
        <Solution>Apply Windows updates and registry tweaks described in the documentation section to disable the weak SSL protocols.__  </Solution>
        <TechnicalExplanation>SSL version 2 and SSL version 3 are considered weak and it is strongly advised to disable them.__    The SSL protocols in Windows is provided by the Schannel component.__The Schannel component needs to be tuned in order to not propose these weak protocols. Many guidelines to handle this problem issued by Microsoft do not talk about Schannel but rather IIS. These guidlines are quoted in the documentation section below.____PingCastle is able to check the SSL version if SSL is exposed.__Please note that PingCastle is using the native .Net SSL stack to perform this test. .Net begins to ignore these weak protocols starting the version 4.7 of the framework and as a consequence, PingCasle may miss some weak protocol detection.____To test for these protocols, you can use a version of openssl with the deprecated protocols still compiled in, e.g. openssl-unsafe from Kali Linux, with the following commands:__openssl-unsafe s_client -connect dc.domain.local:636 -ssl2__openssl-unsafe s_client -connect dc.domain.local:636 -ssl3__    </TechnicalExplanation>
        <Title>Check if WSUS is used with weak SSL protocol.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that there is no weakness related to hardened paths</Description>
        <Documentation>&lt;a href=""&gt;&lt;/a&gt;&lt;br&gt;__&lt;a href="https://labs.withsecure.com/publications/how-to-own-any-windows-network-with-group-policy-hijacking-attacks"&gt;https://labs.withsecure.com/publications/how-to-own-any-windows-network-with-group-policy-hijacking-attacks&lt;/a&gt;&lt;br&gt;__&lt;a href="https://talubu.wordpress.com/2018/02/28/configuring-unc-hardened-access-through-group-policy/"&gt;https://talubu.wordpress.com/2018/02/28/configuring-unc-hardened-access-through-group-policy/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://adsecurity.org/?p=1405"&gt;https://adsecurity.org/?p=1405&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.microsoft.com/en-us/topic/ms15-011-vulnerability-in-group-policy-could-allow-remote-code-execution-february-10-2015-91b4bda2-945d-455b-ebbb-01d1ec191328"&gt;https://support.microsoft.com/en-us/topic/ms15-011-vulnerability-in-group-policy-could-allow-remote-code-execution-february-10-2015-91b4bda2-945d-455b-ebbb-01d1ec191328&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_10/2018-04-06/finding/V-63577"&gt;[US]STIG V-63577 - Hardened UNC Paths must be defined to require mutual authentication and integrity for at least the \\*\SYSVOL and \\*\NETLOGON shares.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557/001"&gt;[MITRE]T1557.001 Man-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>NetworkSniffing</Model>
        <ReportLocation>The detail can be found in the &lt;a href="#HardenedPaths"&gt;Hardened Paths configuration&lt;/a&gt; section.</ReportLocation>
        <RiskId>A-HardenedPaths</RiskId>
        <Solution>You have to edit the Hardened Path section in the GPO.__    This section is located in Computer Configuration/Policies/Administrative Templates/Network/Network Provider.__  Check each value reported here and make sure that entries containing SYSVOL or NETLOGON have RequireIntegrity and RequireMutualAuthentication set to 1.__  In addition to that, check entries having the pattern \\DCName\* and apply the same solution.</Solution>
        <TechnicalExplanation>Two vulnerabilities have been reported in 2015 (MS15-011 and MS15-014) which allows a domain takeover via GPO modifications done with a man-in-the-middle attack.__    To mitigate these vulnerabilites, Microsoft has designed a workaround named "Hardened Paths". It forces connection settings to enforce Integrity, Mutual Authentication or Privacy.__    By default if this policy is empty, if will enforce Integrity and Mutual Authentication on the SYSVOL or NETLOGON shares.__    This rule checks if there have been any overwrite to disable this protection.__    </TechnicalExplanation>
        <Title>Hardened Paths weakness</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that no schema class can be used to create arbitrary objects</Description>
        <Documentation>&lt;a href=""&gt;&lt;/a&gt;&lt;br&gt;__&lt;a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2186"&gt;https://bugs.chromium.org/p/project-zero/issues/detail?id=2186&lt;/a&gt;&lt;br&gt;__&lt;a href="https://gist.github.com/IISResetMe/399a75cfccabc1a17d0cc3b5ae29f3aa#file-update-msexchstoragegroupschema-ps1"&gt;https://gist.github.com/IISResetMe/399a75cfccabc1a17d0cc3b5ae29f3aa#file-update-msexchstoragegroupschema-ps1&lt;/a&gt;&lt;br&gt;__&lt;a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34470"&gt;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34470&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_warning_schema_posssuperiors"&gt;[FR]ANSSI - Schema class allowing dangerous object creation (vuln2_warning_schema_posssuperiors)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1018"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - User Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>Provisioning</Model>
        <ReportLocation />
        <RiskId>S-ADRegistrationSchema</RiskId>
        <Solution>For PossSuperiorComputer:__    You have to edit the schema to change the value of the attribute possSuperior and remove the "computer" value.__  A PowerShell script in the documentation provides a fix.____For PossSuperiorUser:__    You have to edit the schema to change the value of the attribute possSuperior and remove the "user" value.__  A PowerShell script in the documentation provides a fix.__  __Also the class msExchStorageGroup is known to have this vulnerability via the CVE-2021-34470.__In this case, the vulnerability is exploitable even if Exchange has been uninstalled.</Solution>
        <TechnicalExplanation>The classes added to the schema provide additional object types. If misconfigured, a class can be used to bypass a security restriction.__    For the vulnerability PossSuperiorComputer:__    A class has the attribute possSuperiors containing the class "computer" and this class inherits from "container".__  That means that every computer can request this class to be added.__  Once this class has been added, it can be used as a container to create additional users or computers without restrictions.____    For the vulnerability PossSuperiorUser:__    It is the same vulnerability as PossSuperiorComputer but with the "user" class instead of the "computer" class.__    </TechnicalExplanation>
        <Title>Vulnerable Schema Class check</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that WSUS Certificate Pinning has not been disabled</Description>
        <Documentation>&lt;a href=""&gt;&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.gosecure.net/blog/2021/11/22/gosecure-investigates-abusing-windows-server-update-services-wsus-to-enable-ntlm-relaying-attacks/"&gt;https://www.gosecure.net/blog/2021/11/22/gosecure-investigates-abusing-windows-server-update-services-wsus-to-enable-ntlm-relaying-attacks/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/pimps/wsuxploit"&gt;https://github.com/pimps/wsuxploit&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/GoSecure/WSuspicious"&gt;https://github.com/GoSecure/WSuspicious&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/windows/client-management/mdm/policy-csp-update#update-donotenforceenterprisetlscertpinningforupdatedetection"&gt;https://docs.microsoft.com/en-us/windows/client-management/mdm/policy-csp-update#update-donotenforceenterprisetlscertpinningforupdatedetection&lt;/a&gt;&lt;br&gt;__&lt;a href="  "&gt;  &lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>VulnerabilityManagement</Model>
        <ReportLocation>The detail can be found in the &lt;a href="#WSUSsettings"&gt;WSUS settings&lt;/a&gt; section.</ReportLocation>
        <RiskId>S-WSUS-NoPinning</RiskId>
        <Solution>Remove the setting which disables the certificate pinning for WSUS.__    __    It is located in: Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Update\Specify intranet Microsoft update service location__  This is the setting "Allow user proxy to be used as a fallback if detection using system proxy fails".__  __  It refers to the registry key: HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate\DoNotEnforceEnterpriseTLSCertPinningForUpdateDetection__</Solution>
        <TechnicalExplanation>Even though HTTPS makes it harder for attackers to intercept WSUS responses, it it still possible with a specific configuration.__    HTTPS connections may be intercepted by a proxy that signs the response again with a self-signed certificate after receiving it from the WSUS server.__    The certificate can be installed in a user cert store so responses from the HTTPS proxy can still be validated.__In the cumulative update of January 2021, Microsoft implemented a certificate pinning mechanism where the certificate served by the WSUS' IIS server is installed in a system certificate store specifically for WSUS (WindowsServerUpdateServices) that an unauthenticated user cannot control.__Certificates in this store are enforced by default to mitigate HTTPS-intercepting proxy attacks but this pinning mechanism can also be disabled via GPO.____If the WSUS cert store does not contain any certificates, the pinning will not be enforced, too.____PingCastle cannot check if the certificate is present to enforce the certificate pinning, but it checks if a GPO disable this security.</TechnicalExplanation>
        <Title>Search for WSUS configuration where certificate pinning has been disabled</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no user proxy possibility for WSUS</Description>
        <Documentation>&lt;a href=""&gt;&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.gosecure.net/blog/2021/11/22/gosecure-investigates-abusing-windows-server-update-services-wsus-to-enable-ntlm-relaying-attacks/"&gt;https://www.gosecure.net/blog/2021/11/22/gosecure-investigates-abusing-windows-server-update-services-wsus-to-enable-ntlm-relaying-attacks/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/pimps/wsuxploit"&gt;https://github.com/pimps/wsuxploit&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/GoSecure/WSuspicious"&gt;https://github.com/GoSecure/WSuspicious&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/windows/client-management/mdm/policy-csp-update#update-setproxybehaviorforupdatedetection"&gt;https://docs.microsoft.com/en-us/windows/client-management/mdm/policy-csp-update#update-setproxybehaviorforupdatedetection&lt;/a&gt;&lt;br&gt;__&lt;a href="  "&gt;  &lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>VulnerabilityManagement</Model>
        <ReportLocation>The detail can be found in the &lt;a href="#WSUSsettings"&gt;WSUS settings&lt;/a&gt; section.</ReportLocation>
        <RiskId>S-WSUS-UserProxy</RiskId>
        <Solution>The use of a user proxy needs to be disabled.__    This program is looking at element named "Select the proxy behavior" defined in GPO Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Update\Specify intranet Microsoft update service location__(refers to registry key HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate\SetProxyBehaviorForUpdateDetection)____Or WSUS needs to be configured with HTTPS.__See this guide for more information:__https://docs.microsoft.com/en-us/windows-server/administration/windows-server-update-services/deploy/2-configure-wsus#23-secure-wsus-with-the-secure-sockets-layer-protocol__</Solution>
        <TechnicalExplanation>Unprivileged domain users may set a user proxy that is used for Windows Update if it is being allowed by a GPO.__    Since the cumulative updates from September 2020 and January 2021, WSUS clients do not use the user proxy to connect to the server by default.__    However, it is possible to configure a GPO setting that allows the connection via user proxy as a fallback to the system proxy.__  __    This program consider as an anomaly if the setting SetProxyBehaviorForUpdateDetection is set, combined with a HTTP WSUS server.</TechnicalExplanation>
        <Title>Search for WSUS configuration enabling the use of a user proxy</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no access of WSUS server via HTTP</Description>
        <Documentation>&lt;a href=""&gt;&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.gosecure.net/blog/2021/11/22/gosecure-investigates-abusing-windows-server-update-services-wsus-to-enable-ntlm-relaying-attacks/"&gt;https://www.gosecure.net/blog/2021/11/22/gosecure-investigates-abusing-windows-server-update-services-wsus-to-enable-ntlm-relaying-attacks/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/pimps/wsuxploit"&gt;https://github.com/pimps/wsuxploit&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/GoSecure/WSuspicious"&gt;https://github.com/GoSecure/WSuspicious&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/windows/deployment/update/waas-wu-settings"&gt;https://docs.microsoft.com/en-us/windows/deployment/update/waas-wu-settings&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>VulnerabilityManagement</Model>
        <ReportLocation>The detail can be found in the &lt;a href="#WSUSsettings"&gt;WSUS settings&lt;/a&gt; section.</ReportLocation>
        <RiskId>S-WSUS-HTTP</RiskId>
        <Solution>WSUS needs to be configured with HTTPS.__See this guide for more information:__https://docs.microsoft.com/en-us/windows-server/administration/windows-server-update-services/deploy/2-configure-wsus#23-secure-wsus-with-the-secure-sockets-layer-protocol__    __Then all GPO which reference the HTTP path should be changed to the HTTPS path.__This program is looking at the settings defined in "Set the intranet update service for detecting updates" and "Set the alternate download server" in GPO Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Update\Specify intranet Microsoft update service location__(refers to registry key HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate\WUServer and HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate\UpdateServiceUrlAlternate)__</Solution>
        <TechnicalExplanation>WSUS is the component used on the intranet to deliver Windows updates. The recommendation of Microsoft is to use HTTPS for transport but for convenience or tests, HTTP can be configured.__The HTTP protocol can be intercepted on the network with tools such as wsuxploit or WSuspicious (see below for links) and malicious updates can be delivered.__The attacker can then take control of many assets.</TechnicalExplanation>
        <Title>Search for WSUS configuration using HTTP instead of HTTPS</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is checking if the "Pre-Windows 2000 Compatible Access" group contains "Authenticated Users"</Description>
        <Documentation>&lt;a href="https://msdn.microsoft.com/en-us/library/cc223672.aspx"&gt;https://msdn.microsoft.com/en-us/library/cc223672.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.gradenegger.eu/?p=1132"&gt;https://www.gradenegger.eu/?p=1132&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1210"&gt;[MITRE]T1210 Exploitation of Remote Services&lt;/a&gt;</Documentation>
        <MaturityLevel>5</MaturityLevel>
        <Model>Reconnaissance</Model>
        <RiskId>A-PreWin2000AuthenticatedUsers</RiskId>
        <Solution>Remove "Authenticated Users" from the PreWin2000 group.</Solution>
        <TechnicalExplanation>The pre-Windows 2000 compatible access group grants access to some RPC calls.__    Its default and secure value is the "Authenticated Users" group which allows users to perform group look-up using legacy protocols.__    __  If this group contains "Authenticated Users", it increases the impact of the exploitation of vulnerabilities in legacy protocols such as the Print Spooler service.__    Indeed, in the #PrintNightmare attack, it enables a patch bypass on domain controllers because the property Elevated Token is on when establishing a session to the DC.__    Removing the group can have side impacts and as a consequence, this is reported here as a special hardening measure.__  </TechnicalExplanation>
        <Title>Check that the "Pre-Windows 2000 Compatible Access" group does not contain "Authenticated Users"</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose of this rule is to ensure that there is no certificate template that can be edited by anyone</Description>
        <Documentation>&lt;a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2"&gt;https://posts.specterops.io/certified-pre-owned-d95910965cd2&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.riskinsight-wavestone.com/en/2021/06/microsoft-adcs-abusing-pki-in-active-directory-environment/"&gt;https://www.riskinsight-wavestone.com/en/2021/06/microsoft-adcs-abusing-pki-in-active-directory-environment/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_adcs_template_auth_enroll_with_name"&gt;[FR]ANSSI - Dangerous enrollment permission on authentication certificate templates (vuln1_adcs_template_auth_enroll_with_name)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558"&gt;[MITRE]T1558 Steal or Forge Kerberos Tickets&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificatetemplates"&gt;Certificate Templates&lt;/a&gt;</ReportLocation>
        <RiskId>A-CertTempAnyone</RiskId>
        <Solution>Review the security permissions of this certificate template and remove the write access to everyone-like groups such as Domain Users, Domain Computers, Everyone, Authenticated Users, ...__    </Solution>
        <TechnicalExplanation>A certificate template is an object whose definition serves as a base to issue certificates.__    If a user has the right to edit it, it can manually change obscure attributes such as msPKI-Certificate-Name-Flag.__    Doing so will enable him to provide the subject of the certificate and thus having a certificate on behalf other users such as admins.__  It can be used to impersonate them and take control of the domain.__  __Note: the program regards the group "Domain Computers" like "Everyone" if ms-DS-MachineAccountQuota is non zero.</TechnicalExplanation>
        <Title>Check if certificate templates can be edited by everyone.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose of this rule is to ensure that there is no agent certificate that can be requested by anyone</Description>
        <Documentation>&lt;a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2"&gt;https://posts.specterops.io/certified-pre-owned-d95910965cd2&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.riskinsight-wavestone.com/en/2021/06/microsoft-adcs-abusing-pki-in-active-directory-environment/"&gt;https://www.riskinsight-wavestone.com/en/2021/06/microsoft-adcs-abusing-pki-in-active-directory-environment/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_adcs_template_auth_enroll_with_name"&gt;[FR]ANSSI - Dangerous enrollment permission on authentication certificate templates (vuln1_adcs_template_auth_enroll_with_name)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558"&gt;[MITRE]T1558 Steal or Forge Kerberos Tickets&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificatetemplates"&gt;Certificate Templates&lt;/a&gt;</ReportLocation>
        <RiskId>A-CertTempAgent</RiskId>
        <Solution>Review the permissions that allow a wide enrollment of this certificate template__    </Solution>
        <TechnicalExplanation>An Agent certificate is a special certificate used to request certificates on behalf of other users.__    A template has been detected with the agent EKU and that can be enrolled by a large number of users.</TechnicalExplanation>
        <Title>Check the permission of agent certificate templates</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose of this rule is to ensure that there is no certificate template with any purpose that can be requested by everyone</Description>
        <Documentation>&lt;a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2"&gt;https://posts.specterops.io/certified-pre-owned-d95910965cd2&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.riskinsight-wavestone.com/en/2021/06/microsoft-adcs-abusing-pki-in-active-directory-environment/"&gt;https://www.riskinsight-wavestone.com/en/2021/06/microsoft-adcs-abusing-pki-in-active-directory-environment/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_adcs_template_auth_enroll_with_name"&gt;[FR]ANSSI - Dangerous enrollment permission on authentication certificate templates (vuln1_adcs_template_auth_enroll_with_name)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558"&gt;[MITRE]T1558 Steal or Forge Kerberos Tickets&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificatetemplates"&gt;Certificate Templates&lt;/a&gt;</ReportLocation>
        <RiskId>A-CertTempAnyPurpose</RiskId>
        <Solution>Review the permissions that allow a wide enrollment of this certificate template automatically or specify a specific purpose (EKU)__    </Solution>
        <TechnicalExplanation>A certificate should define restrictions of its use. It is done via extensions known as EKU (extended key usage).__    Without a proper purpose or with the global purpose "Any Purpose" it can be used to enroll certificates on behalf of other users and impersonate them using it.</TechnicalExplanation>
        <Title>Check the purpose provided by certificate templates</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>This check verifies if certificate templates in Active Directory Certificate Services (AD CS) allow user-controlled subject information and meet other common criteria associated with the ESC1 vulnerability.</Description>
        <Documentation>&lt;a href="Certified-PreOwned https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified_Pre-Owned.pdf"&gt;Certified-PreOwned https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified_Pre-Owned.pdf&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_adcs_template_auth_enroll_with_name"&gt;[FR]ANSSI - Dangerous enrollment permission on authentication certificate templates (vuln1_adcs_template_auth_enroll_with_name)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558"&gt;[MITRE]T1558 Steal or Forge Kerberos Tickets&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificatetemplates"&gt;Certificate Templates&lt;/a&gt;</ReportLocation>
        <RiskId>A-CertTempCustomSubject</RiskId>
        <Solution>To mitigate ESC1, use one or more of the options below:____&lt;strong&gt;Option 1: Modify Certificate Template Settings in ADCS&lt;/strong&gt;__&lt;ul&gt;&lt;li&gt;Open Certificate Authority (certsrv.msc) on the CA server.&lt;/li&gt;&lt;li&gt;Right-click on Certificate Templates and select Manage.&lt;/li&gt;&lt;li&gt;Navigate to and right-click the vulnerable template and select Properties.&lt;/li&gt;&lt;li&gt;Go to the Subject Name tab:&lt;ul&gt;&lt;li&gt;Ensure "Supply in the request" is unchecked.&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Click OK to save changes.&lt;/li&gt;&lt;/ul&gt;__&lt;strong&gt;Option 2: Restrict Enrollment Permissions&lt;/strong&gt;__&lt;strong&gt;Note:&lt;/strong&gt; Restricting enrollment permissions mitigates some of the risk but all users with enrollment permissions can still impersonate any account. As such, accounts with enrollment permissions for these certificates should be closely monitored and not be on non-privileged accounts.____&lt;ul&gt;&lt;li&gt;Open Certificate Authority (certsrv.msc) on the CA server.&lt;/li&gt;&lt;li&gt;Right-click on Certificate Templates and select Manage.&lt;/li&gt;&lt;li&gt;Navigate to and right-click the vulnerable template and select Properties.&lt;/li&gt;&lt;li&gt;Go to the Security tab:&lt;ul&gt;&lt;li&gt;Remove well-known low-privileged groups such as Authenticated Users, Everyone from enrollment permissions.&lt;/li&gt;&lt;li&gt;Assign only the required accounts and groups permission to request these certificates.&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Click OK to save changes.&lt;/li&gt;&lt;/ul&gt;__&lt;strong&gt;Option 3: Remove the CA Certificate from NTAuthCertificates&lt;/strong&gt;__&lt;strong&gt;Note:&lt;/strong&gt; Only do this if you are sure you do not use and do not want to use certificate-based authentication.____NTAuthCertificates CaCertificate attribute stores the certificate authority certificates that are authorized to be used for authentication. Removing the Certificate Authorities certificate from here stops all authentication-based attacks.__If you're not using certificate-based authentication for this CA:__&lt;ul&gt;&lt;li&gt;Open Active Directory Sites and Services (dssite.msc).&lt;/li&gt;&lt;li&gt;From the top menu, click View and select Show Services Node.&lt;/li&gt;&lt;li&gt;Navigate to Services &gt; Public Key Services &gt; NTAuthCertificates.&lt;/li&gt;&lt;li&gt;Right-click the CACertificate attribute and select Properties.&lt;ul&gt;&lt;li&gt;Review the listed certificates.&lt;/li&gt;&lt;li&gt;Remove the entry for the affected CA by selecting it and clicking Remove.&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Click OK to apply the changes.&lt;/li&gt;&lt;/ul&gt;</Solution>
        <TechnicalExplanation>ESC1 is a vulnerability in Active Directory Certificate Services (AD CS) that occurs when certificate templates allow users to control the Subject Name as well as meet other criteria, such as:__&lt;ul&gt;&lt;li&gt;&lt;strong&gt;User-Controlled Subject Name:&lt;/strong&gt; Requesters can define the subject, enabling impersonation of any account in the domain.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Excessive Enrollment Permissions:&lt;/strong&gt; Large groups such as Domain Users and Authenticated Users have enrollment rights on vulnerable templates as well as the certificate authority.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Authentication-based:&lt;/strong&gt; Templates support Extended Key Usage (EKU) that allows the template to be used for Kerberos authentication.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;No Approval Requirements:&lt;/strong&gt; Certificates can be issued without requiring manager approval and no authorized signatures are required.&lt;/li&gt;&lt;/ul&gt;__This misconfiguration can enable attackers to forge certificates, escalate privileges, and compromise the Active Directory environment.</TechnicalExplanation>
        <Title>Check for ESC1: Vulnerable Subject Control in Certificate Templates</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose of this rule is to ensure that there is no LAPS permission problems with computers that have been added manually to the domain by a user</Description>
        <Documentation>&lt;a href="https://azurecloudai.blog/2019/10/01/laps-security-concern-computers-joiners-are-able-to-see-laps-password/"&gt;https://azurecloudai.blog/2019/10/01/laps-security-concern-computers-joiners-are-able-to-see-laps-password/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.securityinsider-wavestone.com/2020/01/taking-over-windows-workstations-pxe-laps.html"&gt;https://www.securityinsider-wavestone.com/2020/01/taking-over-windows-workstations-pxe-laps.html&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1555/005"&gt;[MITRE]T1555.005 Credentials from Password Stores: Password Managers&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>PassTheCredential</Model>
        <ReportLocation>The detail can be found in &lt;a href="#laps"&gt;LAPS&lt;/a&gt;</ReportLocation>
        <RiskId>A-LAPS-Joined-Computers</RiskId>
        <Solution>Review the security of the computer objects listed in the LAPS section below to change their ownership (you can give it to the domain admins group).__    Check if the creator has also write permissions to change the owner or the security descriptor and if he has the right "all extended rights" on this object.__    If it is the case, remove the permissions granted to this user.__    </Solution>
        <TechnicalExplanation>By default, every domain user can add up to 10 computers to the domain (see the rule S-ADRegistration for more information).__    When a computer is added to the domain, the owner of the computer object is the user who joined the computer.__    To trace this insertion, a special attribute mS-DS-CreatorSID is added, whose value is the SID of its creator.__    When LAPS is installed, the local admin account has its password stored in a special attribute named, by default, ms-mcs-AdmPwd. Its access is retricted.__    Because the user who created it is the owner of the underlying object, it can retrieve the LAPS attribute and get the local admin password.__    __    In addition to check if the owner of the computer object is the user which added it, this program checks also if this user have an explicit permission on this object to write the owner, write the security descriptor, or "all extended rights".__    Indeed, the right "all extended rights" allows to read the LAPS password and write access to these attributes can cancel the security hardening of changing the owner.__    </TechnicalExplanation>
        <Title>Check if LAPS passwords can be retrieved from computers that have been added manually by users.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that no DNS Zones are configured with Zone Transfers.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dnsp/f97756c9-3783-428b-9451-b376f877319a"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dnsp/f97756c9-3783-428b-9451-b376f877319a&lt;/a&gt;&lt;br&gt;__&lt;a href="    https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/dnscmd"&gt;    https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/dnscmd&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1018"&gt;[MITRE]T1018 Remote System Discovery&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>Reconnaissance</Model>
        <ReportLocation />
        <RiskId>A-DnsZoneTransfert</RiskId>
        <Solution>You have to disable Zone Transfers.__    Identify the faulty zone in the details below.__    Go to the DNS console and select a zone in the "Forward Lookup Zones".__    Right click on it and switch to the "Zone Transfers" tab.__    Then ensure "Allow zone transfers" is not enabled "To any server".__    You can also run: dnscmd /zoneresetsecondaries zone /noxfr__    </Solution>
        <TechnicalExplanation>When the Zone Transfers mechanism is enabled, an attacker can retrieve all DNS records anonymously.__    He can then use this feature to generate network noise to trigger a man in the middle attack and capture credentials.____    This setting is domain wide, meaning that all servers share the same setting.__    Please note that PingCastle does this check to only one DNS Server of the zone.____    To test if the Zone Transfers is enabled, issue the following command:__    on Linux: &lt;pre&gt;host -t axfr domain.name dns-server&lt;/pre&gt; or &lt;pre&gt;dig axfr @dns-server domain.name&lt;/pre&gt;__    on Windows: &lt;pre&gt;nslookup&lt;/pre&gt; then &lt;pre&gt;server dns-server&lt;/pre&gt; then &lt;pre&gt;set type=any&lt;/pre&gt; then &lt;pre&gt;ls -d domain.name&lt;/pre&gt;__    </TechnicalExplanation>
        <Title>Check if DNS Zones are configured with Zone Transfers.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows 7 for the workstations within the domain</Description>
        <Documentation>&lt;a href="https://techcommunity.microsoft.com/t5/windows-it-pro-blog/activate-windows-7-esus-on-multiple-devices-with-a-mak/ba-p/1167196"&gt;https://techcommunity.microsoft.com/t5/windows-it-pro-blog/activate-windows-7-esus-on-multiple-devices-with-a-mak/ba-p/1167196&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/information/CERTFR-2005-INF-003/#SECTION00032400000000000000"&gt;[FR]ANSSI CERTFR-2005-INF-003&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The detail can be found in &lt;a href="#operatingsystems"&gt;Operating Systems&lt;/a&gt;</ReportLocation>
        <RiskId>S-OS-Win7</RiskId>
        <Solution>In order to solve this security issue, you should upgrade all the workstations to a more recent version of Windows, starting from Windows 10. __    &lt;i&gt;&lt;strong&gt;Use PingCastle.exe and select export on the main menu. Then choose to export computers. PingCastle will produce a list of all your computers with the OS version in a csv file. You can then use Excel to filter them.&lt;/strong&gt;&lt;/i&gt;__    Do note that you can get the full details regarding the OS used with the following PowerShell command: &lt;i&gt;Get-ADComputer -Filter {(Enabled -eq $true) -and (OperatingSystem -Like "*Windows 7*")} -Property Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion | format-table Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion -Wrap -Auto&lt;/i&gt;</Solution>
        <TechnicalExplanation>The Windows 7 OS is no longer supported, as it is vulnerable to many publicly known exploits: Administrator's credentials can be captured, security protocols are weak, etc.__PingCastle is trying to guess if Extended Security Support (ESU) has been purchased from Microsoft. Based on the documentation referenced below, the program checks if the script Activate-ProductOnline.ps1 is present.__If the script is detected, Windows 7 is considered as supported and this rule is not triggered.</TechnicalExplanation>
        <Title>Obsolete OS (Windows 7)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no Java schema extension</Description>
        <Documentation>&lt;a href=""&gt;&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf"&gt;https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf&lt;/a&gt;&lt;br&gt;__&lt;a href="https://datatracker.ietf.org/doc/html/rfc2713"&gt;https://datatracker.ietf.org/doc/html/rfc2713&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.oracle.com/cd/E19424-01/820-4813/6ng8jv82s/index.html"&gt;https://docs.oracle.com/cd/E19424-01/820-4813/6ng8jv82s/index.html&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>The detail can be found in the &lt;a href="#javacoderefence"&gt;Java Code Reference&lt;/a&gt; section.</ReportLocation>
        <RiskId>S-JavaSchema</RiskId>
        <Solution>Unfortuntaly there can be legit cases to use these Java attributes, that's why this rule is set to "informative" only.__The recommended way to deal with this situation, is to either make sure that no objects are using these attributes, or to set the value com.sun.jndi.ldap.object.trustURLCodebase to "false" in ALL your Java code.__PingCastle is displaying the active users having these Java attributes set in the Detail section.____If you want to disable the Java extension you can proceed by setting each Java attributes to defunct.__See the following procedure on how to disable existing schema attributes: https://docs.microsoft.com/en-us/windows/win32/ad/disabling-existing-classes-and-attributes__</Solution>
        <TechnicalExplanation>The Log4shell vulnerability abused the fact that log4j could load objects via a special string containing JNDI load instructions.__This load instruction refers to many protocols such as CORBA, DNS, ... but also LDAP.__This rule checks if the RFC 2713 schema extension, which allows the representation of Java objects in the AD, has been applied.__More precisely it checks if the schema contains the Java attributes javacodebase, javafactory, javaclassname, javaremotelocation or javaserializeddata.____If the attributes have been found in the schema, the program reports if one of these attributes have been found on enabled user accounts.</TechnicalExplanation>
        <Title>Search for Java schema extension RFC 2713</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Trusts</Category>
        <Description>The purpose is to check that password rotation is in place with Azure AD SSO</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso-faq#how-can-i-roll-over-the-kerberos-decryption-key-of-the-azureadssoacc-computer-account"&gt;https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso-faq#how-can-i-roll-over-the-kerberos-decryption-key-of-the-azureadssoacc-computer-account&lt;/a&gt;&lt;br&gt;__&lt;a href="https://itpro-tips.com/wp-content/uploads/files/TechnetGallery/Azure-AD-SSO-Key-Rollover-d2f1604a.zip"&gt;https://itpro-tips.com/wp-content/uploads/files/TechnetGallery/Azure-AD-SSO-Key-Rollover-d2f1604a.zip&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.dsinternals.com/en/impersonating-office-365-users-mimikatz/"&gt;https://www.dsinternals.com/en/impersonating-office-365-users-mimikatz/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_trusts_accounts"&gt;[FR]ANSSI - Trust account passwords unchanged for more than a year (vuln2_trusts_accounts)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1003"&gt;[MITRE]T1003 OS Credential Dumping&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>TrustAzure</Model>
        <ReportLocation>The detail can be found in &lt;a href="#azure"&gt;Azure&lt;/a&gt;</ReportLocation>
        <RiskId>T-AzureADSSO</RiskId>
        <Solution>Run the script referenced in the documentation below to change the password of the account AZUREADSSOACC.</Solution>
        <TechnicalExplanation>AzureAD SSO is performed using a gateway. This gateway converts a Kerberos TGS ticket to a SAML ticket.__    In short, a connection is made to the computer account AZUREADSSOACC and the secret of this user account is used as a shared secret with AzureAD.__  Despite the fact that this computer account should have its password automatically changed every 30 days, it did not happen.__That means that an extraction of its password (using DCSync for example) can lead to an AzureAD compromise.</TechnicalExplanation>
        <Title>Check if password rotation is in place with AzureAD SSO</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to check if password information may be stored in AD attributes</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/f3adda9f-89e1-4340-a3f2-1f0a6249f1f8"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/f3adda9f-89e1-4340-a3f2-1f0a6249f1f8&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.blackhillsinfosec.com/domain-goodness-learned-love-ad-explorer/"&gt;https://www.blackhillsinfosec.com/domain-goodness-learned-love-ad-explorer/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_reversible_password"&gt;[FR]ANSSI - Accounts with passwords stored using reversible encryption (vuln3_reversible_password)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1552"&gt;[MITRE]T1552 Unsecured Credentials&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>PasswordRetrieval</Model>
        <ReportLocation>The detail can be found in &lt;a href="#unixpasswordsfound"&gt;Unix Passwords&lt;/a&gt;</ReportLocation>
        <RiskId>A-UnixPwd</RiskId>
        <Solution>The attributes unixUserPassword and userPassword from the mentioned user accounts should be cleared, unless the remote system is known to have a strong cryptographic protocol.</Solution>
        <TechnicalExplanation>To perform Single Sign On (SSO) systems need to share secrets with Active Directory.__    This is not the case for all systems such as Unix and Mainframe and designers have found a workaround by storing this secret into a user account attribute.__  However not all systems did implement a proper and cryptographically safe protocol and they are checking the password submitted in their system with an AD attribute.__At that time, it was not known that these attributes can be queried by everyone and as consequence, they did not enforce a robust protection.__Looking at the attribute unixUserPassword, the password can be retrieved either in clear text (encoded as ASCII) or with a weak algorithm such as ROT 13.____In addition to that, the way to change a password in LDAP system is to modify the value of the special attribute userPassword.__This attribute is not supposed to be visible. However Active Directory is using another attribute named unicodePwd (unless the heuristic fUserPwdSupport is set).__That means that the attribute userPassword is not special anymore and that a change of its value is displayed in clear text, considered as a normal attribute.__A misconfigured application can change the user password using this old mechanism, and as a consequence, set the user password in clear text.__</TechnicalExplanation>
        <Title>Check if attributes unixUserPassword and userPassword are set</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that mitigations are in place against the Bloodhound tool</Description>
        <Documentation>&lt;a href="https://github.com/p0w3rsh3ll/NetCease"&gt;https://github.com/p0w3rsh3ll/NetCease&lt;/a&gt;&lt;br&gt;__&lt;a href="https://adsecurity.org/?p=3299"&gt;https://adsecurity.org/?p=3299&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1087/001"&gt;[MITRE]T1087.001 Account Discovery: Local Account&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>Reconnaissance</Model>
        <ReportLocation>The detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>A-NoNetSessionHardening</RiskId>
        <Solution>If this mitigation is not part of the computer image, apply the following recommendations:__Run the NetCease PowerShell script (referenced below) on a reference workstation.__Open the Group Policy Management Console. Right-click the Group Policy object (GPO) that should contain the new preference item, and then click Edit .__In the console tree under Computer Configuration, expand the Preferences folder, and then expand the Windows Settings folder.__Right-click the Registry node, point to New, and select Registry Wizard.__Select the reference workstation on which the desired registry settings exist, then click Next .__Browse to HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\DefaultSecurity\__and select the check box for “SrvsvcSessionInfo” from which you want to create a Registry preference item. Select the check box for a key only if you want to create a Registry item for the key rather than for a value within the key.__Click Finish.__The settings that you selected appear as preference items in the Registry Wizard Values collection</Solution>
        <TechnicalExplanation>By default, Windows computers allow any authenticated user to enumerate network sessions to it.__This means an attacker could enumerate network sessions to a file share hosting home directories or a Domain Controller to see who's connected to SYSVOL (to apply Group Policy) and determine which workstations each user and admin account is logged into.__Bloodhound uses this capability extensively to map out credentials in the network.____Disabling Net Session Enumeration removes the capability for any user to enumerate net session info (Recon).</TechnicalExplanation>
        <Title>Check if NetCease has been put in place to mitigate Bloodhound</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that no RODC has write access to the SYSVOL</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-frs2/3588b343-4076-4776-b5c0-78e2b3d91ed3"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-frs2/3588b343-4076-4776-b5c0-78e2b3d91ed3&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1207"&gt;[MITRE]T1207 Rogue Domain Controller&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>RODC</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>P-RODCSYSVOLWrite</RiskId>
        <Solution>Locate the domain controller object related to the RODC in ADSIEdit.__    Then zoom on CN=DFSR-LocalSettings then CN=Domain System Volume.__    Edit the attribute msDFSR-ReadOnly and change it from false to true.__    </Solution>
        <TechnicalExplanation>The SYSVOL Volume is a special DFS volume used to store system files such as GPO.__    Read Only Domain Controllers (RODC) have read-only access to it.__  If it has write access, it can change the file locally and propagate them to all writable domain controllers.__And thus enable an attacker to take control of the domain by modifying a GPO applied to Domain Controllers.</TechnicalExplanation>
        <Title>Check if RODCs have write access to the SYSVOL volume</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to check if privileged users have already been revealed</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/8dfc81be-7461-48f2-8caf-07402bccb0ea"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/8dfc81be-7461-48f2-8caf-07402bccb0ea&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_rodc_priv_revealed"&gt;[FR]ANSSI - Privileged users revealed on RODC (vuln2_rodc_priv_revealed)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>RODC</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>P-RODCAdminRevealed</RiskId>
        <Solution>The admin account should have its secrets change (a password reset) and be sure that the account will not be revealed anymore.</Solution>
        <TechnicalExplanation>On Active Directory, all users revealed to a RODC are tracked by an attribute set on the computer object of the RODC named msDS-RevealedUsers.__    The program checks on the list of revealed users if one of them is known as a privileged user.__  Indeed, the RODC is caching the authentication secrets related of this user, which can then be used to impersonate it.__In addition to that, RODC are placed in general on more riskier environment.</TechnicalExplanation>
        <Title>Check if privileged users have been revealed on RODC</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that no privileged group can be revealed on RODC</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/8dfc81be-7461-48f2-8caf-07402bccb0ea"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/8dfc81be-7461-48f2-8caf-07402bccb0ea&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_rodc_reveal"&gt;[FR]ANSSI - Dangerous configuration of read-only domain controllers (RODC) (reveal) (vuln3_rodc_reveal)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>RODC</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>P-RODCRevealOnDemand</RiskId>
        <Solution>Edit the attribute msDS-RevealOnDemandGroup and remove the privileged user or group identified.__    __    This can be managed in the Password Replication Policy tab of the computer object in the Active Directory Users and Computers console.</Solution>
        <TechnicalExplanation>There is an attribute on each RODC which enumerates the groups that the RODC can retrieve.__    When the RODC retrieve the user account, all secrets are integrated into the data, meaning that the RODC can impersonate the user account.__  In this case, a user or a group has been identified that have a RID (the last part of the SID) lower than 1000.__All privileged groups have a RID lower than 1000, than means that the RODC can get access at any time to that privileged information.</TechnicalExplanation>
        <Title>Check if a privileged group can be revealed on a RODC</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that the protection against revealing privileged group is active</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/8dfc81be-7461-48f2-8caf-07402bccb0ea"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/8dfc81be-7461-48f2-8caf-07402bccb0ea&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_rodc_never_reveal"&gt;[FR]ANSSI - Dangerous configuration of read-only domain controllers (RODC) (neverReveal) (vuln3_rodc_never_reveal)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>RODC</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>P-RODCNeverReveal</RiskId>
        <Solution>Check the value of the attribute msDS-NeverRevealGroup and the presence of the following expected groups:__- Administrators;__- Server Operators;__- Account Operators;__- Backup Operators;__- Denied RODC Password Replication Group____    This can be managed in the Password Replication Policy tab of the computer object in the Active Directory Users and Computers console.</Solution>
        <TechnicalExplanation>In addition to the group Denied RODC Password Replication Group there is a custom setting set for RODC in an attribute named msDS-NeverRevealGroup.__    This rule checks the current value against the default one.</TechnicalExplanation>
        <Title>Check if the protection against revealing privileged group is active</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that the Dns Admins group is not used</Description>
        <Documentation>&lt;a href="https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83"&gt;https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dnsp/007efcd2-2955-46dd-a59e-f83ae88f4678"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dnsp/007efcd2-2955-46dd-a59e-f83ae88f4678&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_dnsadmins"&gt;[FR]ANSSI - DnsAdmins group members (vuln4_dnsadmins)&lt;/a&gt;&lt;span class="badge grade-4"&gt;4&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>ACLCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admingroups"&gt;Admin Groups&lt;/a&gt;</ReportLocation>
        <RiskId>P-DNSAdmin</RiskId>
        <Solution>Rule update:__The Patch Tuesday of October 2021 fixed this vulnerability and assigned it the identifier CVE-2021-40469.__If the patch has been applied, there is no additional mitigation to perform.____This rule is transformed into an informative rule in PingCastle 2.10.1 and will be removed in future versions of PingCastle.____You should remove the members of the Dns Admins group and do a proper delegation to the specific DNS Zones.____First, grant only "Read Property", "List", "List object" and "Read permssions" to CN=MicrosoftDNS,CN=System to enable access to the RPC service.____Then on each zone (the object in the tree below with the class dnsZone), grant "Read Property", "List", "List object", "Read permissions", "Create Child", "Delete Child", "Delete", "Delete Tree".      __    </Solution>
        <TechnicalExplanation>Administrators of the DNS Service have the possibility to inject a DLL in this service.__However this service is hosted most of the time in the domain controller and is running as SYSTEM.__That means that DNS admins are potentially domain admins.____The security descriptor used to grant admin rights is located on the nTSecurityDescriptor attribute of the object CN=MicrosoftDNS,CN=System.__The "Write All Prop" access right induces the vulnerability.____In this case, the DnsAdmins group is not empty and grant to its user the possibility to interact with the DNS Service.</TechnicalExplanation>
        <Title>Check if the Dns Admins group is not empty</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that all admin accounts require Kerberos pre-authentication</Description>
        <Documentation>&lt;a href="http://www.harmj0y.net/blog/activedirectory/roasting-as-reps/"&gt;http://www.harmj0y.net/blog/activedirectory/roasting-as-reps/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_kerberos_properties_preauth_priv"&gt;[FR]ANSSI - Kerberos pre-authentication disabled for privileged accounts (vuln1_kerberos_properties_preauth_priv)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558/004"&gt;[MITRE]T1558.004 Steal or Forge Kerberos Tickets: AS-REP Roasting&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-NoPreAuthAdmin</RiskId>
        <Solution>Edit the property of the involved accounts and select the Account tab. Uncheck "Do not require Kerberos preauthentication". For computers, which don't have the Account tab, you have to manually edit the attribute useraccountcontrol. Subtract 4194304 from the value of the attribute.</Solution>
        <TechnicalExplanation>Without Kerberos pre-authentication, an attacker can request Kerberos data from the domain controller and use this data to brute-force the account password. You can search accounts using the LDAP query &lt;i&gt;(userAccountControl:1.2.840.113556.1.4.803:=4194304)&lt;/i&gt;</TechnicalExplanation>
        <Title>Check if all admin accounts require Kerberos pre-authentication</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that all admins are changing their passwords at least every 3 years</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_password_change_priv"&gt;[FR]ANSSI - Privileged account passwords age too old (vuln1_password_change_priv)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>AccountTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admingroups"&gt;Admin Groups&lt;/a&gt;</ReportLocation>
        <RiskId>P-AdminPwdTooOld</RiskId>
        <Solution>We advised to read the ANSSI guidelines about this, which is quoted in the documentation section below.__    </Solution>
        <TechnicalExplanation>This rule ensure that passwords of administrator are well managed.</TechnicalExplanation>
        <Title>Check if all admin passwords are changed on the field.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that all computer accounts have their password changed in the last 3 months</Description>
        <Documentation>&lt;a href="https://support.microsoft.com/en-us/help/154501/how-to-disable-automatic-machine-account-password-changes"&gt;https://support.microsoft.com/en-us/help/154501/how-to-disable-automatic-machine-account-password-changes&lt;/a&gt;&lt;br&gt;__&lt;a href="https://access.redhat.com/discussions/1283873"&gt;https://access.redhat.com/discussions/1283873&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_password_change_server_no_change_90"&gt;[FR]ANSSI - Servers with passwords unchanged for more than 90 days (vuln2_password_change_server_no_change_90)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_10/2018-04-06/finding/V-63653"&gt;[US]STIG V-63653 - The computer account password must not be prevented from being reset.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_7/2012-08-22/finding/V-3373"&gt;[US]STIG V-3373 - The maximum age for machine account passwords is not set to requirements.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>InactiveUserOrComputer</Model>
        <ReportLocation>The detail can be found in &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-PwdLastSet-90</RiskId>
        <Solution>__      Some security agencies report the absence of password change as an indicator of compromise.__      __      If it is not the case, check the following registry keys:__* HKLM\System\CurrentControlSet\Services\Netlogon\Parameters\DisablePasswordChange: must be set to 0 or inexistent;__* HKLM\System\CurrentControlSet\Services\Netlogon\Parameters\MaximumPasswordAge: must be set to 30.____For Linux systems, the password change may not be enabled by default - solutions exist, see the link in documentation, like a daily cron job to run msktutil --auto-update.__    </Solution>
        <TechnicalExplanation>By default, all computers automatically change their AD password every 30 days.__    Changing regularly secrets like passwords ensures that they are not used in side channel attacks.__    Also with the default possibility to create up to 10 computers accounts, these accounts may be seen as a backdoor.__    __    This audit program considers this as an anomaly starting with 90 days.__    Also this rule is the companion for the rule S-PwdLastSet-45 which does the same between 45 and 90 days__    </TechnicalExplanation>
        <Title>Check if all computers have changed their passwords in the last 3 months.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that the regular change of computer account passwords is active</Description>
        <Documentation>&lt;a href="https://support.microsoft.com/en-us/help/154501/how-to-disable-automatic-machine-account-password-changes"&gt;https://support.microsoft.com/en-us/help/154501/how-to-disable-automatic-machine-account-password-changes&lt;/a&gt;&lt;br&gt;__&lt;a href="https://access.redhat.com/discussions/1283873"&gt;https://access.redhat.com/discussions/1283873&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_password_change_server_no_change_45"&gt;[FR]ANSSI - Servers with passwords unchanged for more than 45 days (vuln3_password_change_server_no_change_45)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_10/2018-04-06/finding/V-63653"&gt;[US]STIG V-63653 - The computer account password must not be prevented from being reset.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_7/2012-08-22/finding/V-3373"&gt;[US]STIG V-3373 - The maximum age for machine account passwords is not set to requirements.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>InactiveUserOrComputer</Model>
        <ReportLocation>The detail can be found in &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-PwdLastSet-45</RiskId>
        <Solution>__      Some security agencies report the absence of password change as an indicator of compromise.__      __      If it is not the case, check the following registry keys:__* HKLM\System\CurrentControlSet\Services\Netlogon\Parameters\DisablePasswordChange: must be set to 0 or inexistent;__* HKLM\System\CurrentControlSet\Services\Netlogon\Parameters\MaximumPasswordAge: must be set to 30.____For Linux systems, the password change may not be enabled by default - solutions exist, see the link in documentation, like a daily cron job to run msktutil --auto-update.__    </Solution>
        <TechnicalExplanation>By default, all computers automatically change their AD password every 30 days.__    Changing regularly secrets like passwords ensures that they are not used in side channel attacks.__    Also with the default possibility to create up to 10 computers accounts, these accounts may be seen as a backdoor.__    __    This audit program considers this as an anomaly between 45 days and 90 days.__    Also this rule is the companion for the rule S-PwdLastSet-90__    </TechnicalExplanation>
        <Title>Check if all computers are using regular password change practices.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that all privileged accounts are in the Protected User security group</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group"&gt;https://docs.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group&lt;/a&gt;&lt;br&gt;__&lt;a href="https://blog.netwrix.com/2015/02/20/add-sensitive-user-accounts-to-active-directory-protected-users-group/"&gt;https://blog.netwrix.com/2015/02/20/add-sensitive-user-accounts-to-active-directory-protected-users-group/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://dirteam.com/sander/2014/11/25/ten-things-you-need-to-be-aware-of-before-using-the-protected-users-group/"&gt;https://dirteam.com/sander/2014/11/25/ten-things-you-need-to-be-aware-of-before-using-the-protected-users-group/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://blog.andreas-schreiner.de/2018/09/07/active-directory-sicherheit-teil-1-privilegierte-benutzer/"&gt;https://blog.andreas-schreiner.de/2018/09/07/active-directory-sicherheit-teil-1-privilegierte-benutzer/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-78131"&gt;[US]STIG V-78131 - Accounts with domain level administrative privileges must be members of the Protected Users group in domains with a domain functional level of Windows 2012 R2 or higher.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/alerte/CERTFR-2017-ALE-012"&gt;[FR]ANSSI CERTFR-2017-ALE-012&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_protected_users"&gt;[FR]ANSSI - Privileged accounts outside of the Protected Users group (vuln3_protected_users)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1025"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Process Integrity&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>AccountTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admingroups"&gt;Admin Groups&lt;/a&gt;</ReportLocation>
        <RiskId>P-ProtectedUsers</RiskId>
        <Solution>After having reviewed the potential impact on adding users to this group, add the missing privileged accounts to this group.</Solution>
        <TechnicalExplanation>The Protected User group is a special security group which automatically applies protections to minimize credential exposure. Starting with Windows 8.1. Older Operating System must be updated to take this protection in account such as the Windows 7 KB2871997 patch.__    For admins, it:__- Disables NTLM authentication__- Reduces Kerberos ticket lifetime__- Mandates strong encryption algorithms, such as AES__- Prevents password caching on workstations__- Prevents any type of Kerberos delegation____Please also note that a few links (see below) recommends that at least one account is kept outside of the group Protected Users in case there is a permission problem.__That's why this rule is not triggered if only one account is not protected.</TechnicalExplanation>
        <Title>Check if all privileged accounts are in the special group Protected Users.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is checking that no additional account has been added to the "Pre-Windows 2000 Compatible Access" group</Description>
        <Documentation>&lt;a href="https://msdn.microsoft.com/en-us/library/cc223672.aspx"&gt;https://msdn.microsoft.com/en-us/library/cc223672.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_compatible_2000_not_default"&gt;[FR]ANSSI - Use of the "Pre-Windows 2000 Compatible Access" group (vuln3_compatible_2000_not_default)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/003"&gt;[MITRE]T1110.003 Brute Force: Password Spraying&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>Reconnaissance</Model>
        <RiskId>A-PreWin2000Other</RiskId>
        <Solution>Remove the members from the PreWin2000 group while making sure that the group "Authenticated Users" is present. Then reboot each DC.</Solution>
        <TechnicalExplanation>The pre-Windows 2000 compatible access group grants access to some RPC calls which should not be available to users or computers.</TechnicalExplanation>
        <Title>Check that the "Pre-Windows 2000 Compatible Access" group has not been modified from its default</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that no resource based constrained delegations are applied to DC</Description>
        <Documentation>&lt;a href="https://blog.stealthbits.com/resource-based-constrained-delegation-abuse/"&gt;https://blog.stealthbits.com/resource-based-constrained-delegation-abuse/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_delegation_sourcedeleg"&gt;[FR]ANSSI - Resource-based constrained delegation on domain controlers (vuln1_delegation_sourcedeleg)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1187"&gt;[MITRE]T1187 Forced Authentication&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>DelegationCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>P-DelegationDCsourcedeleg</RiskId>
        <Solution>You should edit the msDS-AllowedToDelegateToattribute attribute of the domain controllers and remove the account involved.__    You can do this with the PowerShell command:__    Set-ADComputer COMPUTER -PrincipalsAllowedToDelegateToAccount $Null__    </Solution>
        <TechnicalExplanation>Resource based constrained delegation are a new feature of Windows Server 2012 which tries to handle the limitation of Constrained delegations.__    This delegation is defined by setting the msDS-AllowedToDelegateToattribute attribute either using the GUI or a PowerShell command.__</TechnicalExplanation>
        <Title>Check if all DC have no resource based constrained delegation.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that no constrained delegations with protocol transition are applied to DC</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_delegation_t2a4d"&gt;[FR]ANSSI - Constrained delegation with protocol transition to a domain controller service (vuln1_delegation_t2a4d)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1187"&gt;[MITRE]T1187 Forced Authentication&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>DelegationCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>P-DelegationDCt2a4d</RiskId>
        <Solution>You should edit the msDS-AllowedToDelegateTo attribute of the accounts listed below to remove the SPN of the domain controllers involved.__    </Solution>
        <TechnicalExplanation>A constrained delegation with protocol transition is a delegation with some limitation.__    In this case, it is a limitation of the technical service a delegate can call (SPN).__    But in practice, the specific service name is not checked and the delegate can impersonate anyone on all services of a computer.__    For the case of a domain controller, that means that the delegate can take the control of the domain by impersonating a domain admin and doing modifications with the LDAP service.__    This delegation is set via the attribute msDS-AllowedToDelegateTo.__    The protocol transition is a special feature set in the userAccountControl which does not limit the delegation to the Kerberos protocol.__    Note: this rule is a companion of the rule P-DelegationDCa2d2__</TechnicalExplanation>
        <Title>Check if all DC have no constrained delegation with protocol transition.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that no constrained delegations are applied to DC</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_delegation_a2d2"&gt;[FR]ANSSI - Constrained authentication delegation to a domain controller service (vuln1_delegation_a2d2)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1187"&gt;[MITRE]T1187 Forced Authentication&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>DelegationCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>P-DelegationDCa2d2</RiskId>
        <Solution>You should edit the msDS-AllowedToDelegateTo attribute of the accounts listed below to remove the SPN of the domain controllers involved.__    </Solution>
        <TechnicalExplanation>A constrained delegation is a delegation with some limitation.__    In this case, it is a limitation of the technical service a delegate can call (SPN).__    But in practice, the specific service name is not checked and the delegate can impersonate anyone on all services of a computer.__    For the case of a domain controller, that means that the delegate can take the control of the domain by impersonating a domain admin and doing modifications with the LDAP service.__    This delegation is set via the attribute msDS-AllowedToDelegateTo and is limited to Kerberos__    Note: this rule is a companion of the rule P-DelegationDCt2a4d__</TechnicalExplanation>
        <Title>Check if all DC have no constrained delegation.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that DC are well registered.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/9164e4e8-f892-4ca2-8067-059f6f9387a4"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/9164e4e8-f892-4ca2-8067-059f6f9387a4&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/8ebf2419-1169-4413-88e2-12a5ad499cf5"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/8ebf2419-1169-4413-88e2-12a5ad499cf5&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_dc_inconsistent_uac"&gt;[FR]ANSSI - Domain controllers in inconsistent state (vuln1_dc_inconsistent_uac)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1207"&gt;[MITRE]T1207 Rogue Domain Controller&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>Provisioning</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>S-DCRegistration</RiskId>
        <Solution>This rule result is either the result of a manual or software based misconfiguration. It can also be the sign of a compromise.__      Depending on the anonamly reported, you have to perform the following actions:__      - for InvalidUserAccount:__      you have to check that the userAccountControl attribute of the AD object is either 0x00082000 for RW DC or 0x05001000 for RODC__      - for NoConfiguration:__      the DC registration in the Configuration partition is mising. The DC should not be active and need to be demoted.__      - for NoNTDS:__      the NTDS part of the DC Configuration is missing. Most probably the replication is not working. The DC should be demoted.__    </Solution>
        <TechnicalExplanation>To be registered as a domain controller, a computer must be a member of the domain controller group, but also has some specific settings.__The settings are a change of the userAccountControl attribute and a couple of objects in the configuration partition.__This rule is triggered when an inconsistency has been detected between the expected values and the real values.____The user account control value for Read/Write DC is:__SERVER_TRUST_ACCOUNT (0x00002000) | TRUSTED_FOR_DELEGATION (0x00080000) = 0x00082000__The user account control value for Read Only DC is:__PARTIAL_SECRETS_ACCOUNT (0x04000000) | TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION (0x01000000) | WORKSTATION_TRUST_ACCOUNT (0x00001000) = 0x05001000__</TechnicalExplanation>
        <Title>Check if all DC are well registered.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that the regular change of computer account is active on Domain Controllers.</Description>
        <Documentation>&lt;a href="https://support.microsoft.com/en-us/help/154501/how-to-disable-automatic-machine-account-password-changes"&gt;https://support.microsoft.com/en-us/help/154501/how-to-disable-automatic-machine-account-password-changes&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_password_change_dc_no_change"&gt;[FR]ANSSI - Domain controllers with passwords unchanged for more than 45 days (vuln1_password_change_dc_no_change)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_10/2018-04-06/finding/V-63653"&gt;[US]STIG V-63653 - The computer account password must not be prevented from being reset.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_7/2012-08-22/finding/V-3373"&gt;[US]STIG V-3373 - The maximum age for machine account passwords is not set to requirements.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>InactiveUserOrComputer</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>S-PwdLastSet-DC</RiskId>
        <Solution>__      Some security agencies report the absence of password change as an indicator of compromise.__      __      If it is not the case, check the following registry keys:__* HKLM\System\CurrentControlSet\Services\Netlogon\Parameters\DisablePasswordChange: must be set to 0 or inexistent;__* HKLM\System\CurrentControlSet\Services\Netlogon\Parameters\MaximumPasswordAge: must be set to 30.__    </Solution>
        <TechnicalExplanation>By default, each computers automatically change its password every 30 days. This is the same case for domain controllers.__    Changing regularly secrets like passwords ensures that they are not used in side channel attacks.__    For exemple, using DCSync to export the hash of a domain controller password, then reusing it in a silver attack to create Kerberos tickets.__    __    This audit program considers this as an anomaly after 45 days.__    </TechnicalExplanation>
        <Title>Check if all DC are using regular password change practices.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that every DC is active.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/deploy/demoting-domain-controllers-and-domains--level-200-"&gt;https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/deploy/demoting-domain-controllers-and-domains--level-200-&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.6.6.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R45 [paragraph.3.6.6.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_password_change_inactive_dc"&gt;[FR]ANSSI - Inactive domain controllers (vuln1_password_change_inactive_dc)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1018"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - User Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>InactiveUserOrComputer</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>S-DC-Inactive</RiskId>
        <Solution>You have to demote the DC object using the procedure referenced in the documentation section.__    </Solution>
        <TechnicalExplanation>Domain Controllers are user accounts with powerful privileges.__    While an active Domain Controller changes its password every 30 days, an inactive account can be involved in a domain compromise.__    Indeed, another account, which has rights over this object, may reset the password of this account without being noticed.__    </TechnicalExplanation>
        <Title>Check if all DC are active.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that the DNS Zones are configured to accept only secure update.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dnsp/f97756c9-3783-428b-9451-b376f877319a"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dnsp/f97756c9-3783-428b-9451-b376f877319a&lt;/a&gt;&lt;br&gt;__&lt;a href="    https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/dnscmd"&gt;    https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/dnscmd&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_dnszone_bad_prop"&gt;[FR]ANSSI - Misconfigured DNS zones (vuln3_dnszone_bad_prop)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557"&gt;[MITRE]T1557 Man-in-the-Middle&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>NetworkSniffing</Model>
        <ReportLocation />
        <RiskId>A-DnsZoneUpdate2</RiskId>
        <Solution>You have to enable secure updates. __    Identify the faulty zone in the details below.__    Go to the DNS console and select a zone in the "Forward Lookup Zones".__    Right click on it and switch to the "General" tab.__    Then change Dynamic updates from "Nonsecure and secure" to "Secure only".__    You can also run: dnscmd servername /Config zone /AllowUpdate 2__    </Solution>
        <TechnicalExplanation>When the insecure update mechanism is enabled, an attacker can update a DNS record anonymously.__    He can then use this feature to add new entries or perform a man in the middle attack to capture credentials.__  __    Please note that the rule A-DnsZoneUpdate1 is the companion of A-DnsZoneUpdate2 and it is used to report anomalies related to the local domain zone or the main _msdcs zone. A-DnsZoneUpdate2 reports all the other zones.__    </TechnicalExplanation>
        <Title>Check if DNS Zones are configured with insecure update.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that the DNS Zones are configured to accept only secure update.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dnsp/f97756c9-3783-428b-9451-b376f877319a"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dnsp/f97756c9-3783-428b-9451-b376f877319a&lt;/a&gt;&lt;br&gt;__&lt;a href="    https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/dnscmd"&gt;    https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/dnscmd&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_dnszone_bad_prop"&gt;[FR]ANSSI - Misconfigured DNS zones (vuln1_dnszone_bad_prop)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557"&gt;[MITRE]T1557 Man-in-the-Middle&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>NetworkSniffing</Model>
        <ReportLocation />
        <RiskId>A-DnsZoneUpdate1</RiskId>
        <Solution>You have to enable secure updates. __    Identify the faulty zone in the details below.__    Go to the DNS console and select a zone in the "Forward Lookup Zones".__    Right click on it and switch to the "General" tab.__    Then change Dynamic updates from "Nonsecure and secure" to "Secure only".__    You can also run: dnscmd servername /Config zone /AllowUpdate 2__    </Solution>
        <TechnicalExplanation>When the insecure update mechanism is enabled, an attacker can update a DNS record anonymously.__    He can then use this feature to add new entries or perform a man in the middle attack to capture credentials.__  __    Please note that the rule A-DnsZoneUpdate1 is the companion of A-DnsZoneUpdate2 and it is used to report anomalies related to the local domain zone or the main _msdcs zone. A-DnsZoneUpdate2 reports all the other zones.__    </TechnicalExplanation>
        <Title>Check if DNS Zones are configured with insecure update.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that the old NTFRS protocol is not used to replicate the SYSVOL share.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows-server/storage/dfs-replication/migrate-sysvol-to-dfsr"&gt;https://docs.microsoft.com/en-us/windows-server/storage/dfs-replication/migrate-sysvol-to-dfsr&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.microsoft.com/en-us/help/312862/recovering-missing-frs-objects-and-frs-attributes-in-active-directory"&gt;https://support.microsoft.com/en-us/help/312862/recovering-missing-frs-objects-and-frs-attributes-in-active-directory&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-frs1/d18cc589-677e-4133-97e5-113641792c5e"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-frs1/d18cc589-677e-4133-97e5-113641792c5e&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/sysvol-dfsr-migration-fails-after-in-place-upgrade"&gt;https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/sysvol-dfsr-migration-fails-after-in-place-upgrade&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_sysvol_ntfrs"&gt;[FR]ANSSI - SYSVOL replication through NTFRS (vuln2_sysvol_ntfrs)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1563"&gt;[MITRE]T1563 Remote Service Session Hijacking&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>NetworkSniffing</Model>
        <ReportLocation />
        <RiskId>A-NTFRSOnSysvol</RiskId>
        <Solution>You have to migrate from NTFRS to DFS replication. See the documentation below for more details.__    </Solution>
        <TechnicalExplanation>NTFRS is an old protocol and is considered insecure.__    The SYSVOL share is mainly hosted on domain controllers to host GPO files and login scripts.__  If the content can be modified, it can be used to grant to a hacker the control of the computers reading these configuration files.__To know if the setting is enabled, PingCastle read the following LDAP entry: CN=Domain System Volume (SYSVOL share),CN=File Replication Service,CN=System__If there is any entry found, the program consider that NTFRS is in use for SYSVOL replication.____Starting in Windows Server 2019, promoting new domain controllers requires the DFS Replication (DFSR) to replicate the contents in the SYSVOL share.__As a consequence this rule become informative if at least one Windows Server 2019 or more recent is installed as a Domain Controller.____Please note that at the time of writing, Microsoft supports it until Windows Server 2022 (see the Open Specification link in the documentation section below)__</TechnicalExplanation>
        <Title>Check if NTFRS is used to replicate SYSVOL</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that the Denied RODC Password Replication Group group has at least its default members.</Description>
        <Documentation>&lt;a href="https://learn.microsoft.com/en-us/services-hub/unified/health/remediation-steps-ad/review-the-removal-of-default-members-from-the-denied-rodc-password-replication-group"&gt;https://learn.microsoft.com/en-us/services-hub/unified/health/remediation-steps-ad/review-the-removal-of-default-members-from-the-denied-rodc-password-replication-group&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_rodc_denied_group"&gt;[FR]ANSSI - Dangerous configuration of replication groups for read-only domain controllers (RODCs) (denied) (vuln3_rodc_denied_group)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>RODC</Model>
        <ReportLocation />
        <RiskId>P-RODCDeniedGroup</RiskId>
        <Solution>Add the items which have been identified as missing to the Denied RODC Password Replication Group group.__    </Solution>
        <TechnicalExplanation>A set of critical objects are being forbidden to replicate in RODC for security reasons.__    This permission is set using the Denied RODC Password Replication Group group.__    Removing one of the default members of this group remove this protection, and thus, the isolation of RODC.</TechnicalExplanation>
        <Title>Check the Denied RODC Password Replication Group group</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that the Allowed RODC Password Replication Group group is empty.</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_rodc_allowed_group"&gt;[FR]ANSSI - Dangerous configuration of replication groups for read-only domain controllers (RODCs) (allow) (vuln3_rodc_allowed_group)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>RODC</Model>
        <ReportLocation />
        <RiskId>P-RODCAllowedGroup</RiskId>
        <Solution>This group should be emptied, and dedicated groups should only be added to the Password Replication Policy of each relevant RODC.</Solution>
        <TechnicalExplanation>Accounts belonging to the Allowed RODC Password Replication Group group have their password hashes revealed on all RODCs.</TechnicalExplanation>
        <Title>Check the Allowed RODC Password Replication Group group</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to identify domains having the NSPI protocol exposed without any required account</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/e5899be4-862e-496f-9a38-33950617d2c5"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/e5899be4-862e-496f-9a38-33950617d2c5&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-nspi/6dd0a3ea-b4d4-4a73-a857-add03a89a543"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-nspi/6dd0a3ea-b4d4-4a73-a857-add03a89a543&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_forest/2016-12-19/finding/V-8555"&gt;[US]STIG V-8555 - Anonymous Access to AD forest data above the rootDSE level must be disabled. &lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_dsheuristics_bad"&gt;[FR]ANSSI - Dangerous dsHeuristics settings (vuln1_dsheuristics_bad)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/003"&gt;[MITRE]T1110.003 Brute Force: Password Spraying&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>Reconnaissance</Model>
        <RiskId>A-DsHeuristicsAllowAnonNSPI</RiskId>
        <Solution>The easiest and fastest way to correct this issue is to &lt;b&gt;replace the eighth (8th) character of the DsHeuristics attribute&lt;/b&gt;. If it is not a 0, replace by 0 to fix the issue.</Solution>
        <TechnicalExplanation>The way an Active Directory behaves can be controlled via the attribute &lt;i&gt;DsHeuristics&lt;/i&gt; of &lt;i&gt;CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration&lt;/i&gt;. A parameter stored in its attribute and whose value is &lt;i&gt;fAllowAnonNSPI&lt;/i&gt; can be set to allow access to the NSPI protocol without any account.__The NSPI protocol is used internally by Exchange to resolve addresses, and thus can be used to dump all the users of the forest. It can be exposed to the internet via RPC over HTTP.</TechnicalExplanation>
        <Title>Check for access without any account to the Name Service Provider Interface (NSPI) protocol</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that there is no use of a certificate using a relatively weak RSA key</Description>
        <Documentation>&lt;a href="https://www.iad.gov/iad/library/ia-guidance/ia-solutions-for-classified/algorithm-guidance/commercial-national-security-algorithm-suite-factsheet.cfm"&gt;https://www.iad.gov/iad/library/ia-guidance/ia-solutions-for-classified/algorithm-guidance/commercial-national-security-algorithm-suite-factsheet.cfm&lt;/a&gt;&lt;br&gt;__&lt;a href="    https://www.ssi.gouv.fr/guide/cryptographie-les-regles-du-rgs/"&gt;    https://www.ssi.gouv.fr/guide/cryptographie-les-regles-du-rgs/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14820"&gt;[US]STIG V-14820 - PKI certificates (server and clients) must be issued by the DoD PKI or an approved External Certificate Authority (ECA).&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln3_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-WeakRSARootCert2</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.__    __    Please note that this rule is the companion of the rule A-WeakRSARootCert which checks for unsecured certificates (key lower than 1024 bits).</Solution>
        <TechnicalExplanation>A RSA key certificate with a modulus under 1024 bits is considered as not safe. This is checked by the rule A-WeakRSARootCert.__    This rule checks for certificates having a key under 2048 bits which is considered as having a lower level of security and under 3072 bits for certificates valid after 2030.</TechnicalExplanation>
        <Title>Check for Certificates using a relatively weak signing algorithm (RSA between 1024 bits and 2048 or expires after 2030)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that there is no use of a certificate with a weak RSA exponent</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln3_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-CertWeakRsaComponent</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>The RSA public key is composed of two parts: The modulus and the exponent. The exponent must be a prime number and its value is usually 65537.__    It is not recommended to have a exponent larger than 65537 for compatibility reasons as for example older Windows handle the exponent in 4 bytes.__  Having a lower exponent, such as 3, gives a significant performance boost (up to 8 times), but it is considered less secure.</TechnicalExplanation>
        <Title>Check for Certificates using a weak RSA exponent</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that there is no use of a certificate using a DSA key for signature</Description>
        <Documentation>&lt;a href="https://csrc.nist.gov/publications/detail/fips/186/5/draft"&gt;https://csrc.nist.gov/publications/detail/fips/186/5/draft&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln1_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-CertWeakDSA</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>Digital Signature Algorithm (DSA), is a NIST standard signature algorithm, part of the 1993 Digital Signature Standard(FIPS 186). The proposed FIPS 186-5 draft deprecates the use of DSA and will forbid its usage for digital signature purposes.__    The annex E of FIPS 186-5 specifies: DSA is no longer approved for digital signature generation. DSA may be used to verify signatures generated prior to the implementation date of this standard.</TechnicalExplanation>
        <Title>Check for Certificates using the DSA algorithm for signature</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that there is no private key that can be recovered from a certificate</Description>
        <Documentation>&lt;a href="https://crocs.fi.muni.cz/public/papers/rsa_ccs17"&gt;https://crocs.fi.muni.cz/public/papers/rsa_ccs17&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/crocs-muni/roca"&gt;https://github.com/crocs-muni/roca&lt;/a&gt;&lt;br&gt;__&lt;a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV190026"&gt;https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV190026&lt;/a&gt;&lt;br&gt;__&lt;a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV170012"&gt;https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV170012&lt;/a&gt;&lt;br&gt;__&lt;a href="https://keychest.net/roca"&gt;https://keychest.net/roca&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln1_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-CertROCA</RiskId>
        <Solution>If the certificates listed below are still valid, you have to revoke and re-issue them. If other certificates depend on them, they should be revoked and replaced too.__    If the certificates have been expired, they should be removed.</Solution>
        <TechnicalExplanation>"ROCA" is an acronym for "Return of Coppersmith's attack" which enables an attacker to retrieve the private key from a public key.__    It is due by a library named RSALib, provided by Infineon Technologies which is incorporated into many smart cards, Trusted Platform Module (TPM), and Hardware Security Modules (HSM) implementations, including YubiKey 4 tokens and used to generate public RSA keys.__  This library was generating data in a limited number space, which decreased the number of values that an attacker has to guess.</TechnicalExplanation>
        <Title>Check for the ROCA vulnerability in certificates</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows Server 2008 for the workstations within the domain</Description>
        <Documentation>&lt;a href="https://support.microsoft.com/en-us/help/4456235/end-of-support-for-windows-server-2008-and-windows-server-2008-r2"&gt;https://support.microsoft.com/en-us/help/4456235/end-of-support-for-windows-server-2008-and-windows-server-2008-r2&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/information/CERTFR-2005-INF-003/#SECTION00032400000000000000"&gt;[FR]ANSSI CERTFR-2005-INF-003&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The detail can be found in &lt;a href="#operatingsystems"&gt;Operating Systems&lt;/a&gt;</ReportLocation>
        <RiskId>S-OS-2008</RiskId>
        <Solution>In order to solve this security issue, you should upgrade all the servers to a more recent version of Windows, starting from Windows Server 2012. __    &lt;i&gt;&lt;strong&gt;Use PingCastle.exe and select export on the main menu. Then choose to export computers. PingCastle will produce a list of all your computers with the OS version in a csv file. You can then use Excel to filter them.&lt;/strong&gt;&lt;/i&gt;__    Do note that you can get the full details regarding the OS used with the following PowerShell command: &lt;i&gt;Get-ADComputer -Filter {(Enabled -eq $true) -and (OperatingSystem -Like "*Server 2008*")} -Property Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion | format-table Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion -Wrap -Auto&lt;/i&gt;</Solution>
        <TechnicalExplanation>The Windows Server 2008 OS is no longer supported, as it is vulnerable to many publicly known exploits: Administrator's credentials can be captured, security protocols are weak, etc.</TechnicalExplanation>
        <Title>Obsolete OS (Windows Server 2008)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows Server 2008 as Domain Controller within the domain</Description>
        <Documentation>&lt;a href="https://support.microsoft.com/en-us/help/4456235/end-of-support-for-windows-server-2008-and-windows-server-2008-r2"&gt;https://support.microsoft.com/en-us/help/4456235/end-of-support-for-windows-server-2008-and-windows-server-2008-r2&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-8551"&gt;[US]STIG V-8551 - The domain functional level must be at a Windows Server version still supported by Microsoft.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsection.3.1"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R12 [subsection.3.1]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_warning_dc_obsolete"&gt;[FR]ANSSI - DC/RODC with an obsolete operating system (vuln1_warning_dc_obsolete)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The operating system of domain controllers can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>S-DC-2008</RiskId>
        <Solution>To resolve this security risk, the only way is to decommission DCs running Windows Server 2008 OS, in order to use new versions that are more secure and that are still being patched regarding new security threats</Solution>
        <TechnicalExplanation>The OS Windows Server 2008 is not supported anymore by Microsoft (except when migrated to Azure, until January 9, 2024) and any vulnerability found will not be patched.</TechnicalExplanation>
        <Title>Obsolete Domain Controller (Windows Server 2008)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows Vista for the workstations within the domain</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/information/CERTFR-2005-INF-003/#SECTION00032400000000000000"&gt;[FR]ANSSI CERTFR-2005-INF-003&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The detail can be found in &lt;a href="#operatingsystems"&gt;Operating Systems&lt;/a&gt;</ReportLocation>
        <RiskId>S-OS-Vista</RiskId>
        <Solution>In order to solve this security issue, you should upgrade all the workstations to a more recent version of Windows, starting from Windows 10. __    &lt;i&gt;&lt;strong&gt;Use PingCastle.exe and select export on the main menu. Then choose to export computers. PingCastle will produce a list of all your computers with the OS version in a csv file. You can then use Excel to filter them.&lt;/strong&gt;&lt;/i&gt;__    Do note that you can get the full details regarding the OS used with the following PowerShell command: &lt;i&gt;Get-ADComputer -Filter {(Enabled -eq $true) -and (OperatingSystem -Like "*Windows Vista*")} -Property Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion | format-table Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion -Wrap -Auto&lt;/i&gt;</Solution>
        <TechnicalExplanation>The Windows Vista OS is no longer supported, as it is vulnerable to many publicly known exploits: Administrator's credentials can be captured, security protocols are weak, etc.</TechnicalExplanation>
        <Title>Obsolete OS (Windows Vista)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that PowerShell logging is enabled.</Description>
        <Documentation>&lt;a href="https://adsecurity.org/?p=2604"&gt;https://adsecurity.org/?p=2604&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/powershell/scripting/wmf/whats-new/script-logging?view=powershell-6"&gt;https://docs.microsoft.com/en-us/powershell/scripting/wmf/whats-new/script-logging?view=powershell-6&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_10/2018-04-06/finding/V-68819"&gt;[US]STIG V-68819 - PowerShell script block logging must be enabled&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1047"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Audit&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>Audit</Model>
        <ReportLocation>The detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>A-AuditPowershell</RiskId>
        <Solution>Go to Computer Configuration -&gt; Administrative Templates -&gt; Windows Components -&gt; Windows PowerShell__And enable "Turn on Module logging" and "Turn on PowerShell Script Block logging"__We recommend to set "*" as the module list.__  </Solution>
        <TechnicalExplanation>PowerShell is a powerful language, also used by hackers because of this quality. Hackers are able to run programs such as mimikatz in memory using obfuscated commands such as Invoke-Mimikatz.__    Because there is no artefact on the disk, the incident response task is difficult for the forensic analysts.__    For this reason, we recommend to enable PowerShell logging via a group policy, despite the fact that these security settings may be part of the workstation or server images.__    </TechnicalExplanation>
        <Title>Check if PowerShell logging is enabled.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that all DC don't use weak SSL protocols when acting as server.</Description>
        <Documentation>&lt;a href="https://social.technet.microsoft.com/wiki/contents/articles/2249.windows-server-20082008r2-how-to-disable-sslv2-on-domain-controller-dsforum2wiki.aspx"&gt;https://social.technet.microsoft.com/wiki/contents/articles/2249.windows-server-20082008r2-how-to-disable-sslv2-on-domain-controller-dsforum2wiki.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.microsoft.com/en-us/help/187498/how-to-disable-pct-1-0-ssl-2-0-ssl-3-0-or-tls-1-0-in-internet-informat"&gt;https://support.microsoft.com/en-us/help/187498/how-to-disable-pct-1-0-ssl-2-0-ssl-3-0-or-tls-1-0-in-internet-informat&lt;/a&gt;&lt;br&gt;__&lt;a href="https://adsecurity.org/?p=376"&gt;https://adsecurity.org/?p=376&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>A-DCLdapsProtocol</RiskId>
        <Solution>Apply Windows updates and registry tweaks described in the documentation section to disable the weak SSL protocols.__  </Solution>
        <TechnicalExplanation>SSL version 2 and SSL version 3 are considered broken and it is strongly advised to disable them.__    The SSL protocols in Windows is provided by the SChannel component.__The SChannel component needs to be tuned in order to not propose these weak protocols. Many guidelines to handle this problem issued by Microsoft do not talk about SChannel but rather IIS. These guidlines are quoted in the documentation section below.____PingCastle is able to check the SSL version if LDAPS is exposed. LDAPS is automatically exposed once a certificate is available for the DC and the service restarted.__Please note that PingCastle is using the native .Net SSL stack to perform this test. .Net begins to ignore these weak protocols starting the version 4.7 of the framework and as a consequence, PingCasle may miss some weak protocol detection.____To test for these protocols, you can use a version of openssl with the deprecated protocols still compiled in, e.g. openssl-unsafe from Kali Linux, with the following commands:__openssl-unsafe s_client -connect dc.domain.local:636 -ssl2__openssl-unsafe s_client -connect dc.domain.local:636 -ssl3__    </TechnicalExplanation>
        <Title>Check if LDAPS is used with weak SSL protocol.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that the audit policy on domain controllers collects the right set of events.</Description>
        <Documentation>&lt;a href="https://adsecurity.org/?p=3299"&gt;https://adsecurity.org/?p=3299&lt;/a&gt;&lt;br&gt;__&lt;a href="https://adsecurity.org/?p=3377"&gt;https://adsecurity.org/?p=3377&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1047"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Audit&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>Audit</Model>
        <ReportLocation>The detail can be found in &lt;a href="#auditsettings"&gt;Audit settings&lt;/a&gt;__    &lt;br&gt;__    The table below shows the settings that were not found as configured in a GPO for a given domain controller.</ReportLocation>
        <RiskId>A-AuditDC</RiskId>
        <Solution>Identify the Audit settings to apply and fix them.__    Be aware that there are two places for audit settings.__    For "Simple" audit configuration:__    in Computer Configuration -&gt; Policies -&gt; Windows Settings -&gt; Security Settings -&gt; Local Policies -&gt; Audit Policies__    For "Advanced" audit configuration:__    in Computer Configuration -&gt; Policies -&gt; Windows Settings -&gt; Security Settings -&gt; Advanced Audit Policy Configuration__    Also be sure that the audit GPO is applied to all domain controllers, as the underlying object may be in a OU where the GPO is not applied.__  </Solution>
        <TechnicalExplanation>To detect and mitigate an attack, the right set of events need to be collected.__      The audit policy is a compromise between too much and too few events to collect.__      To solve this problem, the suggested audit policy from adsecurity.org is checked against the audit policy in place.__    </TechnicalExplanation>
        <Title>Check if there is the expected audit policy on domain controllers.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to check if users can abuse their write access to obtain additional privileges.</Description>
        <Documentation>&lt;a href="https://github.com/BloodHoundAD/BloodHound"&gt;https://github.com/BloodHoundAD/BloodHound&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/ANSSI-FR/AD-control-paths"&gt;https://github.com/ANSSI-FR/AD-control-paths&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1069/002"&gt;[MITRE]T1069.002 Permission Groups Discovery: Domain Groups&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ControlPath</Model>
        <ReportLocation>The detail can be found in &lt;a href="#controlpath"&gt;Control Paths Analysis&lt;/a&gt;</ReportLocation>
        <RiskId>P-ControlPathIndirectMany</RiskId>
        <Solution>You should analyze the chart and determine which underlying object is involved and grants too much write permissions.__    Then edit the permissions and locate the write permission involved.__    Then delete it or replace it according to your delegation model.</Solution>
        <TechnicalExplanation>__      If you have access to a key server and the helpdesk can reset your password, then the helpdesk has access to the key server.__This is the kind of logic used by hackers to take control of the domain using key infrastructure objects (domain root, ...) or groups (domain administrators, ...).__Permissions are collected and analyzed to produce a control paths analysis.__Only write permissions (and specific ones) are used for this analysis.__Then the program identifies which users or computers, that are not members of known groups, can take control of this object.__To be fast, some tradeoffs have been selected. For example, logged on users on servers are ignored.__The program may also select paths which are not exploitable and ignore paths if it cannot read every permissions.__    </TechnicalExplanation>
        <Title>Check if there is a control path involving too many users or computers.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that there is no control path involving everyone.</Description>
        <Documentation>&lt;a href="https://github.com/BloodHoundAD/BloodHound"&gt;https://github.com/BloodHoundAD/BloodHound&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/ANSSI-FR/AD-control-paths"&gt;https://github.com/ANSSI-FR/AD-control-paths&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1069/002"&gt;[MITRE]T1069.002 Permission Groups Discovery: Domain Groups&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>ControlPath</Model>
        <ReportLocation>The detail can be found in &lt;a href="#controlpath"&gt;Control Paths Analysis&lt;/a&gt;</ReportLocation>
        <RiskId>P-ControlPathIndirectEveryone</RiskId>
        <Solution>You should analyze the chart and determine which underlying object is involved and grants write permissions to everyone.__    Then edit the permissions and locate the write permission involved.__    Then delete it or replace it according to your delegation model.</Solution>
        <TechnicalExplanation>__      If you have access to a key server and the helpdesk can reset your password, then the helpdesk has access to the key server.__This is the kind of logic used by hackers to take control of the domain using key infrastructure objects (domain root, ...) or groups (domain administrators, ...).__Permissions are collected and analyzed to produce a control paths analysis.__Only write permissions (and specific ones) are used for this analysis.__Then the program identifies which users or computers, that are not members of known groups, can take control of this object.__To be fast, some tradeoffs have been selected. For example, logged on users on servers are ignored.__The program may also select paths which are not exploitable and ignore paths if it cannot read every permissions.__[Everyone] includes the user groups Anonymous, Everyone, Authenticated Users, Domain Users, Domain Computers and Builtin.__    </TechnicalExplanation>
        <Title>Check if there is a control path involving everyone-like groups.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that there is a tier isolation.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-f--securing-domain-admins-groups-in-active-directory"&gt;https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-f--securing-domain-admins-groups-in-active-directory&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>AccountTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#gpologin"&gt;GPO Login&lt;/a&gt;</ReportLocation>
        <RiskId>P-LogonDenied</RiskId>
        <Solution>You should add a GPO to prohibit the logon of specific groups Domain Admins and Administrators.__    __The setting is located in Computer Policy -&gt; Computer Configuration -&gt; Windows Settings -&gt; Security Settings -&gt; Local Policies -&gt; User Rights Assignment.__Then "Deny" logon locally and "Deny" logon through Remote Desktop Services.</Solution>
        <TechnicalExplanation>A way to collect an administrator credential is to take control of a workstation or server in the unsecured tiers and expect that an administrator will connect to it.__    An attack such as credential theft or Kerberos delegation is then performed.__    To reduce the impact of such compromise, the best practice is to isolate components (such as admins, DC) in tiers.__    Typically, a domain admin should not be allowed to connect to any workstation or lower tier server but login only to perform highly privileged operations on tier 0 systems.__    __    To check for this policy, PingCastle looks at all GPOs and checks, if there is a GPO denying logon (SeDenyRemoteInteractiveLogonRight, SeDenyInteractiveLogonRight) of admins (Domain Admins or Administrators) to a specific scope.__    __    False positives can occurs for this rule:__    * if the expected GPO is hidden due to ACL checks__    * if the targeted group is not "checked" when saving the GPO. Indeed, the group will be saved as is without a conversion to its technical name and it will prohibit a match if there are groups internationalized, aka renamed given a specific language.__    __    As a consequence, only one deny policy on one group will fulfill this requirements. The program also does not check if the GPO is applied on an Organizational Unit or a Container.__    Also this rule is enforced only if there are more than 200 users and 200 computers.__    </TechnicalExplanation>
        <Title>Check if there is a policy preventing administrators to connect to lower tier systems.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that there is no assignment of the SeTrustedCredManAccessPrivilege privilege.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows/win32/secauthn/credentials-management"&gt;https://docs.microsoft.com/en-us/windows/win32/secauthn/credentials-management&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/daem0nc0re/PrivFu#privilegedoperations"&gt;https://github.com/daem0nc0re/PrivFu#privilegedoperations&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/daem0nc0re/PrivFu/blob/main/PrivilegedOperations/SeTrustedCredManAccessPrivilegePoC/SeTrustedCredManAccessPrivilegePoC.cs"&gt;https://github.com/daem0nc0re/PrivFu/blob/main/PrivilegedOperations/SeTrustedCredManAccessPrivilegePoC/SeTrustedCredManAccessPrivilegePoC.cs&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_10/2018-04-06/finding/V-63843"&gt;[US]STIG V-63843 - The Access Credential Manager as a trusted caller user right must not be assigned to any groups or accounts&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>PrivilegeControl</Model>
        <ReportLocation>The detail can be found in &lt;a href="#gpoprivileges"&gt;Privileges&lt;/a&gt;</ReportLocation>
        <RiskId>P-TrustedCredManAccessPrivilege</RiskId>
        <Solution>You should edit the GPO and remove the GPO right assignment.__    __The setting is located in Computer Policy -&gt; Computer Configuration -&gt; Windows Settings -&gt; Security Settings -&gt; Local Policies -&gt; User Rights Assignment.</Solution>
        <TechnicalExplanation>The Credential Manger is a vault where credentials are being stored.__This privilege can be used to retrieve the secret data.____A POC to exploit this privilege is available in the documents linked below.__    </TechnicalExplanation>
        <Title>Check if there is the privilege "Access Credential Manager" has been explicitly granted to a user other than the "Winlogon service".</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that no specific delegation has been setup to manage the Microsoft DNS.</Description>
        <Documentation>&lt;a href="https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83"&gt;https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dnsp/007efcd2-2955-46dd-a59e-f83ae88f4678"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dnsp/007efcd2-2955-46dd-a59e-f83ae88f4678&lt;/a&gt;&lt;br&gt;__&lt;a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-40469"&gt;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-40469&lt;/a&gt;&lt;br&gt;__&lt;a href="https://blog.0patch.com/2021/11/micropatch-for-remote-code-execution-by.html"&gt;https://blog.0patch.com/2021/11/micropatch-for-remote-code-execution-by.html&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>ACLCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admindelegation"&gt;Delegations&lt;/a&gt;</ReportLocation>
        <RiskId>P-DNSDelegation</RiskId>
        <Solution>Rule update:__The Patch Tuesday of October 2021 fixed this vulnerability and assigned it the identifier CVE-2021-40469.__If the patch has been applied, there is no additional mitigation to perform.____This rule is transformed into an informative rule in PingCastle 2.10.1 and will be removed in future versions of PingCastle.__      __      You should remove the explicit write delegation located in the CN=MicrosoftDNS,CN=System container and do a proper delegation.__    First, grant only "Read Property", "List", "List object" and "Read permssions" to CN=MicrosoftDNS,CN=System to enable access to the RPC service.__  Then on each zone (the object in the tree below with the class dnsZone), grant "Read Property", "List", "List object", "Read permissions", "Create Child", "Delete Child", "Delete", "Delete Tree".________After the Patch day the key does exist. __    </Solution>
        <TechnicalExplanation>Administrators of the DNS Service have the possibility to inject a DLL in this service.__However this service is hosted most of the time in the domain controller and is running as SYSTEM.__That means that DNS Admins are potentially domain admins.____The security descriptor used to grant admin rights is located on the nTSecurityDescriptor attribute of the object CN=MicrosoftDNS,CN=System.__The "Write All Prop" access right induces the vulnerability.____In this case, an explicit delegation has been setup and this delegation is not using the existing DnsAdmins group.</TechnicalExplanation>
        <Title>Check if there is an explicit delegation on DNS servers.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that the password of admin accounts cannot be retrieved using the Kerberoast attack.</Description>
        <Documentation>&lt;a href="https://adsecurity.org/?p=3466"&gt;https://adsecurity.org/?p=3466&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_spn_priv"&gt;[FR]ANSSI - Privileged accounts with SPN (vuln1_spn_priv)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558/003"&gt;[MITRE]T1558.003 Steal or Forge Kerberos Tickets: Kerberoasting&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>AccountTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admingroups"&gt;Admin Groups&lt;/a&gt;</ReportLocation>
        <RiskId>P-Kerberoasting</RiskId>
        <Solution>If the account is a service account, the service should be removed from the privileged group or have a process to change its password at a regular basis.__If the user is a person, the SPN attribute of the account should be removed.</Solution>
        <TechnicalExplanation>To access a service using Kerberos, a user requests a ticket (named TGS) to the DC specific to the service.__This ticket is encrypted using a derivative of the service password, but can be brute-forced to retrieve the original password.__Any account having the attribute SPN populated is considered as a service account.__Given that any user can request a ticket for a service account, these accounts can have their password retrieved.__In addition, services are known to have their password not changed at a regular basis and to use well-known words.____Please note that this program ignores service accounts that had their password changed in the last 40 days ago to support using password rotation as a mitigation.</TechnicalExplanation>
        <Title>Check if admin accounts are vulnerable to the Kerberoast attack.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that every account has a password which is compliant with password expiration policies</Description>
        <Documentation>&lt;a href="https://adsecurity.org/?p=4115"&gt;https://adsecurity.org/?p=4115&lt;/a&gt;&lt;br&gt;__&lt;a href="https://access.redhat.com/discussions/1283873"&gt;https://access.redhat.com/discussions/1283873&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_dont_expire"&gt;[FR]ANSSI - Accounts with never-expiring passwords (vuln2_dont_expire)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt;</ReportLocation>
        <RiskId>S-PwdNeverExpires</RiskId>
        <Solution>In order to make Active Directory enforce periodic password change, accounts must not have the "Password never expires" flag set in the "Account" tab of the user properties. Their passwords should then be rolled immediately.__For services accounts, Windows provide the "managed service accounts" and "group managed service accounts" features to facilite the automatic change of passwords.__Please note that there is a document in the section below which references solutions for service accounts of well known products.__Also Linux servers should be configured with automatic machine account change.</Solution>
        <TechnicalExplanation>Some accounts have passwords which never expire. Should an attacker compromise one of these accounts, he would be able to maintain long-term access to the Active Directory domain.__    __We have noted that some Linux servers, domain joined, are configured with a password which never expires.__This is a misconfiguration because a password change can be configured. It was however not the default on some plateform.__See one of the link below for more information.</TechnicalExplanation>
        <Title>Check that there is no account with never-expiring passwords</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Trusts</Category>
        <Description>The purpose is to ensure that the dangerous SID are not stored in the SIDHistory attribute.</Description>
        <Documentation>&lt;a href="https://support.microsoft.com/en-us/help/243330/well-known-security-identifiers-in-windows-operating-systems"&gt;https://support.microsoft.com/en-us/help/243330/well-known-security-identifiers-in-windows-operating-systems&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.3.1.5"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R15 [paragraph.3.3.1.5]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_sidhistory_dangerous"&gt;[FR]ANSSI - Accounts or groups with unexpected SID history (vuln2_sidhistory_dangerous)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1134/005"&gt;[MITRE]T1134.005 Access Token Manipulation: SID-History Injection&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>SIDHistory</Model>
        <ReportLocation>The SIDHistory detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt; and a quick summary in &lt;a href="#sidhistory"&gt;SID History&lt;/a&gt;</ReportLocation>
        <RiskId>T-SIDHistoryDangerous</RiskId>
        <Solution>__      Identify the account, computer or group having these dangerous SID set in SID History, then clean it up by editing directly the SIDHistory attribute of the underlying AD object.__      __To remove the SIDHistory from a user account, run:__&lt;i&gt;Get-ADUser USERNAME -properties sidhistory | foreach {Set-ADUser $_ -remove @{sidhistory=$_.sidhistory.value}}&lt;/i&gt;__For a group, run:__&lt;i&gt;Get-ADGroup GROUPNAME -properties sidhistory | foreach {Set-ADGroup $_ -remove @{sidhistory=$_.sidhistory.value}}&lt;/i&gt;__For all users in a OU:__&lt;i&gt;Get-ADUser -SearchBase "OU=Accounts,DC=mydomain,DC=com" -Filter {sidhistory -like '*'} -properties sidhistory | foreach {Set-ADUser $_ -remove @{sidhistory=$_.sidhistory.value}}&lt;/i&gt;__    </Solution>
        <TechnicalExplanation>SID History is an attribute used in migration to link with a former account.__    This rule checks for SID not coming from a former domain (such as SYSTEM) or from a former domain but having a RID (the last part of the SID) lower than 1000.__    Indeed, native privileged accounts have a SID lower than 1000.__    A list of Well Known SID is referenced in the documentation below.__    </TechnicalExplanation>
        <Title>Check if dangerous SID are stored in the SIDHistory attribute.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Trusts</Category>
        <Description>The purpose is to ensure that a forest cannot be used to compromise another forest using Kerberos delegation</Description>
        <Documentation>&lt;a href="http://www.harmj0y.net/blog/redteaming/not-a-security-boundary-breaking-forest-trusts/"&gt;http://www.harmj0y.net/blog/redteaming/not-a-security-boundary-breaking-forest-trusts/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://techcommunity.microsoft.com/t5/Premier-Field-Engineering/Changes-to-Ticket-Granting-Ticket-TGT-Delegation-Across-Trusts/ba-p/440283/tab/rich"&gt;https://techcommunity.microsoft.com/t5/Premier-Field-Engineering/Changes-to-Ticket-Granting-Ticket-TGT-Delegation-Across-Trusts/ba-p/440283/tab/rich&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.microsoft.com/en-us/help/4490425/updates-to-tgt-delegation-across-incoming-trusts-in-windows-server"&gt;https://support.microsoft.com/en-us/help/4490425/updates-to-tgt-delegation-across-incoming-trusts-in-windows-server&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_trusts_tgt_deleg"&gt;[FR]ANSSI - Inbound trust relationships with delegation (vuln3_trusts_tgt_deleg)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1187"&gt;[MITRE]T1187 Forced Authentication&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>TrustImpermeability</Model>
        <ReportLocation>The detail can be found in &lt;a href="#discovereddomains"&gt;Trusts section&lt;/a&gt;</ReportLocation>
        <RiskId>T-TGTDelegation</RiskId>
        <Solution>TGT Delegation on forest trusts should be disabled, except for migrations.__You can use netdom to turn the TGT delegation on forest trust OFF.__Example: netdom.exe trust fabrikam.com /domain:contoso.com /EnableTGTDelegation:No__As an alternative, you can locate the forest trust and change its LDAP trustattribute from the value 8 to the value 520.____The impact is to have non working services which relies on unconstrained delegation. Resource based delegation is not impacted.____See the official Microsoft recommendations and a script to find potentially impacted services in the links below.</Solution>
        <TechnicalExplanation>A Forest trust is a link between two forests. By default, this trust is secure and prohibits SID History attacks.__However, it allows Kerberos delegation by default.__By configuring an uncontrainst delegation on forest A, an attacker located in forest A can collect admin or domain controller credentials, the TGT of the session, of the forest B.__This collection can be forced by using services such as the Print Spooler, enabled by default on all domain controllers.__Having collected this TGT, the attacker can then request access to other systems in forest B, by asking for a TGS given the TGT, and then gain control of the whole forest.</TechnicalExplanation>
        <Title>Check if Kerberos delegation can be used to take control of the forest from a trusted forest</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that local name resolution protocol (LLMNR) cannot be used to collect credentials by performing a network attack</Description>
        <Documentation>&lt;a href="https://youtu.be/Fg2gvk0qgjM"&gt;https://youtu.be/Fg2gvk0qgjM&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557/001"&gt;[MITRE]T1557.001 Man-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>NetworkSniffing</Model>
        <ReportLocation>The detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>A-NoGPOLLMNR</RiskId>
        <Solution>Enable the GPO &lt;a href="https://docs.microsoft.com/en-us/windows/client-management/mdm/policy-csp-admx-dnsclient#admx-dnsclient-turn-off-multicast"&gt;Turn off multicast name resolution&lt;/a&gt; and check that no GPO overrides this setting.__    (if it is the case, the policy involved will be displayed below)</Solution>
        <TechnicalExplanation>LLMNR is a protocol which translates names such as foo.bar.com into an ip address. LLMNR has been designed to translate name locally in case the default protocol DNS is not available.__    Regarding Active Directory, DNS is mandatory which makes LLMNR useless.__  LLMNR exploits typo mistakes or faster response time to redirect users to a specially designed share, server or website.__  Being trusted, this service will trigger the single sign on procedure which can be abused to retrieve the user credentials.____    LLMNR is enabled by default on all OS except starting from Windows 10 v1903 and Windows Server v1903 where it is disabled.__    </TechnicalExplanation>
        <Title>Check if LLMNR can be used to steal credentials</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Trusts</Category>
        <Description>The purpose is to ensure that a compromised domain cannot use file deployed by GPO to compromise other domains</Description>
        <Documentation>&lt;a href="https://attack.mitre.org/techniques/T1210"&gt;[MITRE]T1210 Exploitation of Remote Services&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>TrustImpermeability</Model>
        <ReportLocation>The detail can be found in &lt;a href="#gpodeployedfiles"&gt;GPO Deployed Files&lt;/a&gt;</ReportLocation>
        <RiskId>T-FileDeployedOutOfDomain</RiskId>
        <Solution>Copy the file to a share located inside the domain and not in trusted domains.</Solution>
        <TechnicalExplanation>Files deployed (Applications as msi, file copied by GPO, ...) can be stored in any file share available in the network and that includes trusted domains shares. If such file is located in a compromised domain, it can be used to compromise other domains.</TechnicalExplanation>
        <Title>Check if files deployed may be located in a trusted domain</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that files deployed to computers cannot be changed by everyone.</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsubsection.3.3.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R18 [subsubsection.3.3.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-2370"&gt;[US]STIG V-2370 - The access control permissions for the directory service site group policy must be configured to use the required access permissions.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ACLCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#gpodeployedfiles"&gt;GPO Deployed Files&lt;/a&gt;</ReportLocation>
        <RiskId>P-DelegationFileDeployed</RiskId>
        <Solution>Locate the file mentioned by the GPO specified in Details and change its permissions.</Solution>
        <TechnicalExplanation>Applications and other files can be deployed by a GPO. If an attacker can modify one of these files, they may be able to compromise the user's account.</TechnicalExplanation>
        <Title>Ensure that files deployed by a GPO cannot be modified by everyone.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to check that the computer account password can be changed as usual.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/domain-controller-refuse-machine-account-password-changes"&gt;https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/domain-controller-refuse-machine-account-password-changes&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2008/2011-05-23/finding/V-4408"&gt;[US]STIG V-4408 - The domain controller must be configured to allow reset of machine account passwords.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>PassTheCredential</Model>
        <ReportLocation>The detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>A-DCRefuseComputerPwdChange</RiskId>
        <Solution>Locate the GPO specified in Details and change the setting in "Domain controller: Refuse machine account password changes".__    Disable this setting, or set it to "Disabled".__The setting is located in :__    Computer configuration -&gt; Policies -&gt; Windows Settings -&gt;Security Settings -&gt; Local Policies -&gt; Security Options.__As an alternative, the file GptTmpl.inf can be manually edited.</Solution>
        <TechnicalExplanation>For each computer, there is a hidden user account. This account is used to maintain the computer inside the Active Directory domain.__    The password of this account is changed every 30 days automatically except if the Domain Controller prohibits this.__  This is the case when this GPO setting is enabled.</TechnicalExplanation>
        <Title>Ensure that Domain Controllers don't deny the change of computer account passwords.</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to check that the integrity of the network protocol LDAP as not been endangered by explicitly disabling LDAP signing.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-ldap-client-signing-requirements"&gt;https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-ldap-client-signing-requirements&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557"&gt;[MITRE]T1557 Man-in-the-Middle&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>NetworkSniffing</Model>
        <ReportLocation>The detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>A-LDAPSigningDisabled</RiskId>
        <Solution>Locate the GPO specified in Details and change the setting in "Network security: LDAP client signing requirements".__    Disable this setting, or set it to "Negotiate signing" or "Require Signature".__The setting is located in :__    Computer configuration -&gt; Policies -&gt; Windows Settings -&gt;Security Settings -&gt; Local Policies -&gt; Security Options.__As an alternative, the file GptTmpl.inf can be manually edited.</Solution>
        <TechnicalExplanation>The LDAP signature feature enables the integrity of the network communication between the computer and the domain controller.__Hackers aim at intercepting the communication at the network layer and modify the network dialog to grant themselves admin privileges.__The goal of this feature is to defeat these attacks.__Unfortunately, not all devices support LDAP signature. That's why the best practice is to Require Signature if possible or to, at least, try to negotiate it.__In this case, the LDAP signature feature is configured to None (no negotiation), which can enable hackers to perform their attacks.</TechnicalExplanation>
        <Title>Ensure LDAP signing requirements is not set to None</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to check that it is not possible to go into recovery mode without the administrator password</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/recovery-console-allow-automatic-administrative-logon"&gt;https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/recovery-console-allow-automatic-administrative-logon&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_7/2012-08-22/finding/V-1159"&gt;[US]STIG V-1159 - The Recovery Console option is set to permit automatic logon to the system.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ACLCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>P-RecoveryModeUnprotected</RiskId>
        <Solution>Locate the GPO specified in Details and turn off the setting "Recovery console: Allow automatic administrative logon"__The setting is located in :__    Computer configuration -&gt; Policies -&gt; Windows Settings -&gt;Security Settings -&gt; Local Policies -&gt; Security Options.__As an alternative, the file GptTmpl.inf can be manually edited.</Solution>
        <TechnicalExplanation>The recovery mode is a special mode allowing an admin to fix an issue preventing the computer to boot. By pressing F8 in the short time span allowed, the computer boots with just a simple command line.__    Usually, the administrator password is requested to avoid that people having physical access get control of it. It can typically be done by creating a new user account and add this account as member of the administrators group. This rule checks if there are GPOs which disable this password prompt.</TechnicalExplanation>
        <Title>Ensure the "automatic administrative logon" feature of the recovery mode is not enabled</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to check if the DoListObject feature has been enabled</Description>
        <Documentation>&lt;a href="https://dirteam.com/sander/2008/12/09/active-directory-visibility-modes/"&gt;https://dirteam.com/sander/2008/12/09/active-directory-visibility-modes/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/e5899be4-862e-496f-9a38-33950617d2c5"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/e5899be4-862e-496f-9a38-33950617d2c5&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/990fb975-ab31-4bc1-8b75-5da132cd4584"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/990fb975-ab31-4bc1-8b75-5da132cd4584&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ACLCheck</Model>
        <RiskId>P-DsHeuristicsDoListObject</RiskId>
        <Solution>This is an informative rule.__If you want to reverse this behavior to its default value, find the dsHeuristics configuration which is located in CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration,DC=ad,DC=contoso,DC=com.__Then edit the 3rd character and set it to zero.</Solution>
        <TechnicalExplanation>The DoListObject is a feature to probihit account located in an OU to look at another OU. It proceeds by checking a special ACL named RIGHT_DS_LIST_OBJECT.__</TechnicalExplanation>
        <Title>Check if the behavior DoListObject has been enabled</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that the AdminSDHolder mechanism has not been altered</Description>
        <Documentation>&lt;a href="https://www.petri.com/active-directory-security-understanding-adminsdholder-object"&gt;https://www.petri.com/active-directory-security-understanding-adminsdholder-object&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/e5899be4-862e-496f-9a38-33950617d2c5"&gt;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/e5899be4-862e-496f-9a38-33950617d2c5&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_dsheuristics_bad"&gt;[FR]ANSSI - Dangerous dsHeuristics settings (vuln1_dsheuristics_bad)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>ACLCheck</Model>
        <RiskId>P-DsHeuristicsAdminSDExMask</RiskId>
        <Solution>Find the dsHeuristics configuration which is located in CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration,DC=ad,DC=contoso,DC=com.__    Then edit the 16th character and set it to zero.</Solution>
        <TechnicalExplanation>The AdminSDHolder service is a protection which prohibits an admin to lose control of the domain after a permission change or to introduce a weakness in the permissions.__It proceeds by rewriting every 60 minutes the security descriptor of critical objects.____By modifying the dsHeuristics attribute, this protection can be disabled for one or more critical group.__Each critical group is associated with a value:__Account Operators: 1,__Server Operators: 2,__Print Operators:4,__Backup Operators: 8.__The 16th character of dsHeuristics represents the sum of the values associated to the groups where the AdminSDHolder has been disabled.__To disable it for the 'Backup Operators' and the 'Server Operators', the value is 8 + 2 = 0x0A = 'a'.__</TechnicalExplanation>
        <Title>Ensure that the AdminSDHolder protection has not been disabled for some critical groups</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that the Recycle Bin feature is enabled</Description>
        <Documentation>&lt;a href="https://enterinit.com/powershell-enable-active-directory-recycle-bin"&gt;https://enterinit.com/powershell-enable-active-directory-recycle-bin&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1047"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Audit&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>IrreversibleChange</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaininformation"&gt;Domain Information&lt;/a&gt;</ReportLocation>
        <RiskId>P-RecycleBin</RiskId>
        <Solution>First, be sure that the forest level is at least Windows Server 2008 R2.__    You can check it with Get-ADForest or in the &lt;a href="#domaininformation"&gt;Domain Information&lt;/a&gt; section.__  Then you can enable it using the PowerShell command:__Enable-ADOptionalFeature -Identity 'Recycle Bin Feature' -Scope ForestOrConfigurationSet -Target 'test.mysmartlogon.com'</Solution>
        <TechnicalExplanation>The Recycle Bin avoids immediate deletion of objects (which can still be partially recovered by its tombstone). This lowers the administration work needed to restore. It also extends the period where traces are available when an investigation is needed.</TechnicalExplanation>
        <Title>Ensure that the Recycle Bin feature is enabled</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that standard users cannot login to domain controllers</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/allow-log-on-locally"&gt;https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/allow-log-on-locally&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/allow-log-on-through-remote-desktop-services"&gt;https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/allow-log-on-through-remote-desktop-services&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.hpe.com/hpsc/doc/public/display?docId=emr_na-c04197764-1"&gt;https://support.hpe.com/hpsc/doc/public/display?docId=emr_na-c04197764-1&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsubsection.3.3.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R18 [subsubsection.3.3.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>ACLCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#gpoprivileges"&gt;Privileges&lt;/a&gt;</ReportLocation>
        <RiskId>P-LoginDCEveryone</RiskId>
        <Solution>Locate the GPO specified in Details and remove the privilege "Allow log on locally" or "Allow log on through Remote Desktop Services" to "Everyone", "Authenticated Users", "Domain Users" or "Domain Computers".__The settings are located in :__    Computer configuration -&gt; Policies -&gt; Windows Settings -&gt;Security Settings -&gt; Local Policies -&gt; User Rights Assignment.__As an alternative, the file GptTmpl.inf can be manually edited.</Solution>
        <TechnicalExplanation>Domain Controllers are critical components of the Active Directory. If an attacker is able to open a session, he will be able to discover insecure backup media or perform a local privilege escalation to become the DC admin and thus the AD admin.__    Local logon requires usually physical interaction, which explains why network seggregation is a best practice, but this can be bypassed. Indeed, VNC or remote server management software is a way to perform local logon remotely.__    In addition, remote server management software have been the subject of many vulnerabilites, some of them can be exploited even if this software is disabled.</TechnicalExplanation>
        <Title>Ensure that the privilege to log on Domain Controllers are not granted to everyone by GPO</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that Exchange installation did not introduce privilege escalation vulnerabilities by modifying domain permissions</Description>
        <Documentation>&lt;a href="https://github.com/gdedrouas/Exchange-AD-Privesc/blob/master/DomainObject/Fix-DomainObjectDACL.ps1"&gt;https://github.com/gdedrouas/Exchange-AD-Privesc/blob/master/DomainObject/Fix-DomainObjectDACL.ps1&lt;/a&gt;&lt;br&gt;__&lt;a href="https://blogs.technet.microsoft.com/exchange/2019/02/12/released-february-2019-quarterly-exchange-updates/"&gt;https://blogs.technet.microsoft.com/exchange/2019/02/12/released-february-2019-quarterly-exchange-updates/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.microsoft.com/en-us/help/4490059/using-shared-permissions-model-to-run-exchange-server"&gt;https://support.microsoft.com/en-us/help/4490059/using-shared-permissions-model-to-run-exchange-server&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsubsection.3.3.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R18 [subsubsection.3.3.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ACLCheck</Model>
        <RiskId>P-ExchangePrivEsc</RiskId>
        <Solution>Edit the root domain security descriptor. Identify the ACE giving the right ModifyDACL to the principal Exchange Windows Permissions. Go to the advanced settings and set the inheritance to Inherit Only.__    __Or run the PowerShell script Fix-DomainObjectDACL.ps1 referenced below.</Solution>
        <TechnicalExplanation>When Exchange is installed, a set of permissions is modified to allow a deep Windows integration. A dependency analysis has shown that the permissions, that Exchange has set, introduced a possibility for privilege escalation.__    The most basic exploitation is that a member of the group Exchange Windows Permissions can modify the security permission of the domain, granting itself the right Ds-Replication-Get-Changes-All.__    This right allows the account to perform an attack named DCSync, which retrieves the hash of the krbtgt account. With this hash the attacker can then create a golden ticket and impersonate silently any user of the domain, including domain admins.__    </TechnicalExplanation>
        <Title>Ensure that Exchange did not introduce security vulnerabilities</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that standard users are not granted dangerous privileges</Description>
        <Documentation>&lt;a href="https://www.romhack.io/slides/RomHack%202018%20-%20Andrea%20Pierini%20-%20whoami%20priv%20-%20show%20me%20your%20Windows%20privileges%20and%20I%20will%20lead%20you%20to%20SYSTEM.pdf"&gt;https://www.romhack.io/slides/RomHack%202018%20-%20Andrea%20Pierini%20-%20whoami%20priv%20-%20show%20me%20your%20Windows%20privileges%20and%20I%20will%20lead%20you%20to%20SYSTEM.pdf&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.tarlogic.com/en/blog/abusing-seloaddriverprivilege-for-privilege-escalation/"&gt;https://www.tarlogic.com/en/blog/abusing-seloaddriverprivilege-for-privilege-escalation/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/decoder-it/psgetsystem"&gt;https://github.com/decoder-it/psgetsystem&lt;/a&gt;&lt;br&gt;__&lt;a href="https://twitter.com/0gtweet/status/1303427935647531018?s=20"&gt;https://twitter.com/0gtweet/status/1303427935647531018?s=20&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsubsection.3.3.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R18 [subsubsection.3.3.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>PrivilegeControl</Model>
        <ReportLocation>The detail can be found in &lt;a href="#gpoprivileges"&gt;Privileges&lt;/a&gt;</ReportLocation>
        <RiskId>P-PrivilegeEveryone</RiskId>
        <Solution>Locate the GPO specified in Details and remove the privilege.__Most of the settings are located in :__    Computer configuration -&gt; Policies -&gt; Windows Settings -&gt;Security Settings -&gt; Local Policies -&gt; User Rights Assignment.__As an alternative, the file GptTmpl.inf can be manually edited.</Solution>
        <TechnicalExplanation>To perform special operations, the operating system relies on privileges. They can be displayed by running the command: whoami /all.__SeLoadDriverPrivilege can be used to take control of the system by loading a specifically designed driver. This procedure can be performed by low privileged users as the driver can be defined in HKCU.__SeTcbPrivilege is the privilege used to "Act on behalf the operating system". This is the privilege reserved to the SYSTEM user. This procedure allows any user to act as SYSTEM.__SeDebugPrivilege is the privilege used to debug program and to access any program's memory. It can be used to create a new process and set the parent process to a privileged one.__SeRestorePrivilege can be used to modify a service running as local system and startable by all users to a chosen one.__SeBackupPrivilege can be used to backup Windows registry and use third party tools for extracting local NTLM hashes.__SeTakeOwnershipPrivilege can be used to take ownership of any secureable object in the system including a service registry key. Then to change its ACL to define its own service running as LocalSystem.__SeCreateTokenPrivilege can be used to create a custom token with all privileges and thus be abused like SeTcbPrivilege __SeImpersonatePrivilege and SeAssignPrimaryTokenPrivilege can be abused to impersonate privileged tokens. These tokens can be retrieved by establishing security context such as Local DCOM DCE/RPC reflection.__SeSecurityPrivilege can be used to clear the Windows Security Event Log and shrink it to make events flushed soon. Also read security log and view events where the user inverted the login and its password.__SeManageVolumePrivilege can be used to reset the security descriptor on the C volume and thus, change the inherited permissions to critical files</TechnicalExplanation>
        <Title>Ensure that dangerous privileges are not granted to everyone by GPO</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that standard users cannot modify GPO</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsubsection.3.3.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R18 [subsubsection.3.3.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-2370"&gt;[US]STIG V-2370 - The access control permissions for the directory service site group policy must be configured to use the required access permissions.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ACLCheck</Model>
        <RiskId>P-DelegationGPOData</RiskId>
        <Solution>Edit the Access Control List (ACL) of the GPO object or the directory where the items is located. Then remove any write permission given to the group.</Solution>
        <TechnicalExplanation>When the group Authenticated Users, Everyone or any similar groups have permission to modify a GPO, it can be abused to take control of the accounts where this GPO applies. It can potentially lead to the compromise of the domain</TechnicalExplanation>
        <Title>Ensure that GPO items cannot be modified by any user</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that the operator groups, which can have indirect control to the domain, are empty</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsection.3.5"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R27 [subsection.3.5]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>AdminControl</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admingroups"&gt;Admin Groups&lt;/a&gt;</ReportLocation>
        <RiskId>P-OperatorsEmpty</RiskId>
        <Solution>It is recommended to have these groups empty. Assign administrators into administrators group. Other accounts should have proper delegation rights in an OU or in the scope they are managing.</Solution>
        <TechnicalExplanation>Operator groups (Account Operators, Server Operators, ...) can take indirect control of the domain. Indeed, these groups have write access to critical resources of the domain.</TechnicalExplanation>
        <Title>Check that the operator groups are empty</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure the failure of one domain controller will not stop the domain.</Description>
        <Documentation>&lt;a href="https://social.technet.microsoft.com/wiki/contents/articles/14355.capacity-planning-for-active-directory-domain-services.aspx"&gt;https://social.technet.microsoft.com/wiki/contents/articles/14355.capacity-planning-for-active-directory-domain-services.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1053"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Data Backup&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>Backup</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>A-NotEnoughDC</RiskId>
        <Solution>Increase the number of domain controllers by installing new ones.</Solution>
        <TechnicalExplanation>A single domain controller failure can lead to a lack of availability of the domain if the number of servers is too low. To have a minimum redundancy, the number of DC should be at least 2. For Labs, this rule can be ignored, and you can add this rule into the exception list.</TechnicalExplanation>
        <Title>Ensure that there are enough DCs to provide basic redundancy</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that credentials cannot be extracted from the DC via its Print Spooler service</Description>
        <Documentation>&lt;a href="https://adsecurity.org/?p=4056"&gt;https://adsecurity.org/?p=4056&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.slideshare.net/harmj0y/derbycon-the-unintended-risks-of-trusting-active-directory"&gt;https://www.slideshare.net/harmj0y/derbycon-the-unintended-risks-of-trusting-active-directory&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1187"&gt;[MITRE]T1187 Forced Authentication&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>PassTheCredential</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>A-DC-Spooler</RiskId>
        <Solution>The Print Spooler service should be deactivated on domain controllers. Please note as a consequence that the Printer Pruning functionality (rarely used) will be unavailable.</Solution>
        <TechnicalExplanation>When there's an account with unconstrained delegation configured (which is fairly common) and the Print Spooler service running on a computer, you can get that computers credentials sent to the system with unconstrained delegation as a user. With a domain controller, the TGT of the DC can be extracted allowing an attacker to reuse it with a DCSync attack and obtain all user hashes and impersonate them.</TechnicalExplanation>
        <Title>Ensure that the Print Spooler service cannot be abused to get the DC credentials</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that no weaknesses have been introduced following a Windows Server 2016 installation.</Description>
        <Documentation>&lt;a href="https://itpro-tips.com/wp-content/uploads/files/TechnetGallery/Enterprise-Key-Admins-720eb270.zip"&gt;https://itpro-tips.com/wp-content/uploads/files/TechnetGallery/Enterprise-Key-Admins-720eb270.zip&lt;/a&gt;&lt;br&gt;__&lt;a href="https://secureidentity.se/adprep-bug-in-windows-server-2016/"&gt;https://secureidentity.se/adprep-bug-in-windows-server-2016/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsubsection.3.3.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R18 [subsubsection.3.3.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_adupdate_bad"&gt;[FR]ANSSI - Bad Active Directory versions (vuln2_adupdate_bad)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T111"&gt;[MITRE]T111 Two-Factor Authentication Interception&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ACLCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admindelegation"&gt;Delegations&lt;/a&gt;</ReportLocation>
        <RiskId>P-DelegationKeyAdmin</RiskId>
        <Solution>After having carefully studied the possible impact of the following change, apply the script made by MSRC and referenced in the documentation below to alter the permission.</Solution>
        <TechnicalExplanation>After performing adprep /domainprep from Windows Server 2016 sources there may be an unwanted AccessControlEntry (ACE) in the DiscretionaryACL (DACL) of the targeted domain-naming-context's SecurityDescriptor (SD) that grants FullControl permission to the Enterprise Key Admins group ( SID = ending with -527 ).__This is s a bug in ADPREP that was fixed in Windows Server 2016 RS3/1709. No official fix for those who used pre-1709.__Note: The SID will only be resolvable after the PDC emulator role is transferred to a Windows Server 2016 domain controller.__  </TechnicalExplanation>
        <Title>Ensure that bogus Windows Server 2016 AD prep did not introduce vulnerabilities</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that no weakness has been introduced at Exchange installation.</Description>
        <Documentation>&lt;a href="https://blogs.technet.microsoft.com/exchange/2009/09/23/exchange-2010-and-resolution-of-the-adminsdholder-elevation-issue/"&gt;https://blogs.technet.microsoft.com/exchange/2009/09/23/exchange-2010-and-resolution-of-the-adminsdholder-elevation-issue/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsubsection.3.3.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R18 [subsubsection.3.3.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ACLCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admindelegation"&gt;Delegations&lt;/a&gt;</ReportLocation>
        <RiskId>P-ExchangeAdminSDHolder</RiskId>
        <Solution>After having carefully studied the possible impact of the following change, alter the AdminSDHolder permissions to remove the Exchange objects.</Solution>
        <TechnicalExplanation>At install time, the Exchange Windows Permissions universal security group (USG) was granted the ability to modify the members attribute, the ability to change and reset passwords, and the ability to modify the permissions of any object protected by the AdminSDHolder role.__    This security group includes all the Exchange servers.__    As a consequence, a malicious administrator could elevate their privileges on one of the servers and thus gain control of the Active Directory forest.__    Newest versions of Exchange do not introduce this security vulnerability.</TechnicalExplanation>
        <Title>Ensure that Exchange did not modify the AdminSDHolder object to introduce vulnerabilities</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that no account can impersonate any account.</Description>
        <Documentation>&lt;a href="https://blogs.technet.microsoft.com/389thoughts/2017/04/18/get-rid-of-accounts-that-use-kerberos-unconstrained-delegation/"&gt;https://blogs.technet.microsoft.com/389thoughts/2017/04/18/get-rid-of-accounts-that-use-kerberos-unconstrained-delegation/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://adsecurity.org/?p=1667"&gt;https://adsecurity.org/?p=1667&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsubsection.3.3.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R18 [subsubsection.3.3.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_delegation_t4d"&gt;[FR]ANSSI - Unconstrained authentication delegation (vuln2_delegation_t4d)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1187"&gt;[MITRE]T1187 Forced Authentication&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>DelegationCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>P-UnconstrainedDelegation</RiskId>
        <Solution>Replace unconstrained delegation by constrained delegation. In practice, on the account object, tab "delegation", replace "trust this computer for delegation to any service" by "trust this computer for delegation to specified services only".</Solution>
        <TechnicalExplanation>When an unconstrained delegation is configured, the Kerberos ticket TGT can be captured. This TGT grant then access to any service the user has access. If the user is an administrator or a domain controller (a connection can be forced using the spooler service), the domain can be compromised.</TechnicalExplanation>
        <Title>Ensure that no accounts are subject to unconstrained delegation</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that standard users cannot modify login scripts</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsubsection.3.3.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R18 [subsubsection.3.3.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-2370"&gt;[US]STIG V-2370 - The access control permissions for the directory service site group policy must be configured to use the required access permissions.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ACLCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#gpologin"&gt;GPO Login script&lt;/a&gt;</ReportLocation>
        <RiskId>P-DelegationLoginScript</RiskId>
        <Solution>Edit the Access Control List (ACL) of the script object or the directory where the file is located. Then remove any write permission given to the group.</Solution>
        <TechnicalExplanation>When the group Authenticated Users, Everyone or any similar groups have permission to modify a login script, it can be abused to take control of the accounts using this script. It can potentially lead to the compromise of the domain</TechnicalExplanation>
        <Title>Ensure that all login scripts cannot be modified by any user</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that the SMB version 2 protocol has signing enabled when communicating with domain controllers</Description>
        <Documentation>&lt;a href="https://www.sentinelone.com/labs/relaying-potatoes-another-unexpected-privilege-escalation-vulnerability-in-windows-rpc-protocol/"&gt;https://www.sentinelone.com/labs/relaying-potatoes-another-unexpected-privilege-escalation-vulnerability-in-windows-rpc-protocol/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://trustedsec.com/blog/a-comprehensive-guide-on-relaying-anno-2022"&gt;https://trustedsec.com/blog/a-comprehensive-guide-on-relaying-anno-2022&lt;/a&gt;&lt;br&gt;__&lt;a href="https://msdn.microsoft.com/en-us/library/cc246675.aspx"&gt;https://msdn.microsoft.com/en-us/library/cc246675.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/actualite/CERTFR-2015-ACT-021/#SECTION00010000000000000000"&gt;[FR]ANSSI CERTFR-2015-ACT-021&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557"&gt;[MITRE]T1557 Man-in-the-Middle&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>NetworkSniffing</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>A-SMB2SignatureNotEnabled</RiskId>
        <Solution>Enable the group policy "Digitally sign communications (if client agrees)" or check for any policy, which may alter the server settings. See the &lt;a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/smbv1-microsoft-network-server-digitally-sign-communications-if-client-agrees"&gt;official documentation&lt;/a&gt; for more information.</Solution>
        <TechnicalExplanation>If SMB signing is not required on domain controllers, it can lead to several security risks and potential problems like Man-in-the-Middle (MitM) or relaying attacks like e.g. the so called RemotePotato0. An often used attack tool is Python Responder, which can be used to compromise a domain by listening for SMB connections, injecting rogue data into the communications and relaying it to a different system.__SMB v1 does not provide a mechanism to enforce integrity and thus is compromised easily. SMB v2 (and subsequent version SMB v3) provides a way to guarantee the integrity of the network communication via a signature of each packet. By establishing a SMB v2 dialog with domain controllers, PingCastle checks the signature capability by looking at the SMB options provided by the server.</TechnicalExplanation>
        <Title>Check if the file share protocol can sign its network dialog</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that the SMB version 2 protocol has signing enforced when communicating with domain controllers</Description>
        <Documentation>&lt;a href="https://www.sentinelone.com/labs/relaying-potatoes-another-unexpected-privilege-escalation-vulnerability-in-windows-rpc-protocol/"&gt;https://www.sentinelone.com/labs/relaying-potatoes-another-unexpected-privilege-escalation-vulnerability-in-windows-rpc-protocol/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://trustedsec.com/blog/a-comprehensive-guide-on-relaying-anno-2022"&gt;https://trustedsec.com/blog/a-comprehensive-guide-on-relaying-anno-2022&lt;/a&gt;&lt;br&gt;__&lt;a href="https://msdn.microsoft.com/en-us/library/cc246675.aspx"&gt;https://msdn.microsoft.com/en-us/library/cc246675.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/actualite/CERTFR-2015-ACT-021/#SECTION00010000000000000000"&gt;[FR]ANSSI CERTFR-2015-ACT-021&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557"&gt;[MITRE]T1557 Man-in-the-Middle&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>NetworkSniffing</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>A-SMB2SignatureNotRequired</RiskId>
        <Solution>Enable the group policy "Digitally sign communications (always)" or check for any policy which may alter the server settings. See the &lt;a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/microsoft-network-server-digitally-sign-communications-always"&gt;official documentation&lt;/a&gt; for more information.</Solution>
        <TechnicalExplanation>If SMB signing is not required on domain controllers, it can lead to several security risks and potential problems like Man-in-the-Middle (MitM) or relaying attacks like e.g. the so called RemotePotato0. An often used attack tool is Python Responder, which can be used to compromise a domain by listening for SMB connections, injecting rogue data into the communications and relaying it to a different system.__SMB v1 does not provide a mechanism to enforce integrity and thus is compromised easily. SMB v2 (and subsequent version SMB v3) provides a way to guarantee the integrity of the network communication via a signature of each packet. By establishing a SMB v2 dialog with domain controllers, PingCastle checks the signature capability by looking at the SMB options provided by the server.</TechnicalExplanation>
        <Title>Check if the file share protocol requires its client to sign its network dialog</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that the minimum set of subnet(s) has been configured in the domain</Description>
        <Documentation>&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>NetworkTopography</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>S-DC-SubnetMissing</RiskId>
        <Solution>Locate the IP address which was found as not being part of declared subnet, then add this subnet to the "Active Directory Sites" tool. If you have found IPv6 addresses and it was not expected, you should disable the IPv6 protocol on the network card.</Solution>
        <TechnicalExplanation>When multiple sites are created in a domain, networks should be declared in the domain in order to optimize processes such as DC attribution. In addition, PingCastle can collect the information to be able to build a network map. This rule has been triggered because at least one domain controller has an IP address which was not found in subnet declaration. These IP addresses have been collected by querying the DC FQDN IP address in both IPv6 and IPv4 format.</TechnicalExplanation>
        <Title>Check for completeness of network declaration</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to check if the backups are actually up to date in case they are needed. The alert can be triggered when a domain is backed up using non-recommended methods</Description>
        <Documentation>&lt;a href="https://technet.microsoft.com/en-us/library/jj130668(v=ws.10).aspx"&gt;https://technet.microsoft.com/en-us/library/jj130668(v=ws.10).aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-25385"&gt;[US]STIG V-25385 - Active Directory data must be backed up daily for systems with a Risk Management Framework categorization for Availability of moderate or high. Systems with a categorization of low must be backed up weekly.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1053"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Data Backup&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>Backup</Model>
        <ReportLocation>The detail can be found in &lt;a href="#backup"&gt;Backup&lt;/a&gt;</ReportLocation>
        <RiskId>A-BackupMetadata</RiskId>
        <Solution>Plan AD backups based on Microsoft standards. These standards depend on the Operating System. For example with the wbadmin utility: &lt;i&gt;wbadmin start systemstatebackup -backuptarget:d:&lt;/i&gt;</Solution>
        <TechnicalExplanation>A verification is done on the backups, ensuring that the backup is performed according to Microsoft standards. Indeed, at each backup the DIT Database Partition Backup Signature is updated. If for any reasons, backups are needed to perform a rollback (rebuild a domain) or to track past changes, the backups will actually be up to date. This check is equivalent to a &lt;i&gt;REPADMIN /showbackup *&lt;/i&gt;.</TechnicalExplanation>
        <Title>Check for the last backup date according to Microsoft standard</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that the schema has been updated for the creation of the Protected Users group.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group"&gt;https://docs.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-78131"&gt;[US]STIG V-78131 - Accounts with domain level administrative privileges must be members of the Protected Users group in domains with a domain functional level of Windows 2012 R2 or higher.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/alerte/CERTFR-2017-ALE-012"&gt;[FR]ANSSI CERTFR-2017-ALE-012&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>PassTheCredential</Model>
        <ReportLocation>The schema version is indicated in &lt;a href="#domaininformation"&gt;Domain Information&lt;/a&gt;</ReportLocation>
        <RiskId>A-ProtectedUsers</RiskId>
        <Solution>The Protected Users group is automatically created when the PDC (primary DC) emulator role is transferred to Windows Server 2012 R2 or newer domain controller. The group is then automatically replicated to all other domain controllers.__&lt;b&gt; Warning: Do not add service accounts into this group as this will result in "authentication failure" messages. Use "protected accounts" instead&lt;/b&gt;</Solution>
        <TechnicalExplanation>The Protected Users group is a special group, which is a very effective mitigation solution to counter attacks using credential theft starting with Windows 8.1. Older Operating System must be updated to use this protection, such as the &lt;b&gt;Windows 7 KB2871997&lt;/b&gt; patch.</TechnicalExplanation>
        <Title>Check for presence of the Protected Users group</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to make sure that there is a proper password policy in place for the native local administrator account.</Description>
        <Documentation>&lt;a href="https://www.microsoft.com/en-us/download/details.aspx?id=46899"&gt;https://www.microsoft.com/en-us/download/details.aspx?id=46899&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-36438"&gt;[US]STIG V-36438 - Local administrator accounts on domain systems must not share the same password.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/actualite/CERTFR-2015-ACT-046/#SECTION00020000000000000000"&gt;[FR]ANSSI CERTFR-2015-ACT-046&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1078/003"&gt;[MITRE]T1078.003 Valid Accounts: Local Accounts&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>PassTheCredential</Model>
        <ReportLocation>The detail can be found in &lt;a href="#laps"&gt;LAPS&lt;/a&gt;</ReportLocation>
        <RiskId>A-LAPS-Not-Installed</RiskId>
        <Solution>If you don't have any provisioning process or password solution to manage local administrators, you should install the LAPS solution. If you address the risk through alternative measures, you can disregard this finding. Customers using Netwrix PingCastle Pro or Enterprise versions can add this item as an exception.</Solution>
        <TechnicalExplanation>LAPS (Local Administrator Password Solution) is the advised solution to handle passwords for the native local administrator account on all workstations, as it is a simple way to handle most of the subject.</TechnicalExplanation>
        <Title>Check if the LAPS tool to handle the native local administrator passwords is installed</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to verify if Domain Controller(s) are vulnerable to the MS17-010 vulnerability</Description>
        <Documentation>&lt;a href="https://blogs.technet.microsoft.com/msrc/2017/04/14/protecting-customers-and-evaluating-risk/ "&gt;https://blogs.technet.microsoft.com/msrc/2017/04/14/protecting-customers-and-evaluating-risk/ &lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/misterch0c/shadowbroker/tree/master/windows/exploits "&gt;https://github.com/misterch0c/shadowbroker/tree/master/windows/exploits &lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/alerte/CERTFR-2017-ALE-010"&gt;[FR]ANSSI CERTFR-2017-ALE-010&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>VulnerabilityManagement</Model>
        <ReportLocation>The startup time of domain controllers can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>S-Vuln-MS17_010</RiskId>
        <Solution>To fix the security breach, you should patch the DC as soon as it has been established it was vulnerable. Another good remediation is to disable SMB v1 (see "DC Vulnerability (SMB v1)). You can verify that using the program from github in the links: this program will check remotely the last startup time of the DC and evaluate the risk</Solution>
        <TechnicalExplanation>MS17-010 is a critical vulnerability that was published on March, 14th 2017. It can be used to compromise an entire domain via DC compromise. This exploit has been revealed by the Shadow brokers (EternalBlue, EternalRomance, EternalSinergy) and it uses the SMB v1 vulnerability</TechnicalExplanation>
        <Title>DC vulnerability (MS17-010) </Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that all accounts require Kerberos pre-authentication</Description>
        <Documentation>&lt;a href="http://www.harmj0y.net/blog/activedirectory/roasting-as-reps/"&gt;http://www.harmj0y.net/blog/activedirectory/roasting-as-reps/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_kerberos_properties_preauth"&gt;[FR]ANSSI - Kerberos pre-authentication disabled (vuln2_kerberos_properties_preauth)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558/004"&gt;[MITRE]T1558.004 Steal or Forge Kerberos Tickets: AS-REP Roasting&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-NoPreAuth</RiskId>
        <Solution>Edit the property of the involved accounts and select the Account tab. Uncheck "Do not require Kerberos preauthentication". For computers, which don't have the Account tab, you have to manually edit the attribute useraccountcontrol. Subtract 4194304 the value of the attribute.</Solution>
        <TechnicalExplanation>Without Kerberos pre-authentication, an attacker can request Kerberos data from the domain controller and use this data to crack the account password. You can find which accounts don't require Kerberos pre-authentication with the PowerShell command: &lt;i&gt;Get-ADObject -LDAPFilter "(userAccountControl:1.2.840.113556.1.4.803:=4194304)"&lt;/i&gt;</TechnicalExplanation>
        <Title>Check if all accounts require Kerberos pre-authentication</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to verify if Domain Controller(s) are vulnerable to the SMB v1 vulnerability</Description>
        <Documentation>&lt;a href="https://github.com/lgandx/Responder-Windows"&gt;https://github.com/lgandx/Responder-Windows&lt;/a&gt;&lt;br&gt;__&lt;a href="https://blogs.technet.microsoft.com/josebda/2015/04/21/the-deprecation-of-smb1-you-should-be-planning-to-get-rid-of-this-old-smb-dialect"&gt;https://blogs.technet.microsoft.com/josebda/2015/04/21/the-deprecation-of-smb1-you-should-be-planning-to-get-rid-of-this-old-smb-dialect&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/windows-server/storage/file-server/troubleshoot/detect-enable-and-disable-smbv1-v2-v3"&gt;https://docs.microsoft.com/windows-server/storage/file-server/troubleshoot/detect-enable-and-disable-smbv1-v2-v3&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/actualite/CERTFR-2017-ACT-019/#SECTION00010000000000000000"&gt;[FR]ANSSI CERTFR-2017-ACT-019&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/actualite/CERTFR-2016-ACT-039/#SECTION00010000000000000000"&gt;[FR]ANSSI CERTFR-2016-ACT-039&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557/001"&gt;[MITRE]T1557.001 Man-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>OldAuthenticationProtocols</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>S-SMB-v1</RiskId>
        <Solution>It is highly recommended by Microsoft to disable SMB v1 whenever it is possible on both client and server-side. &lt;b&gt;Do note that if you are still not following best practices regarding the usage of deprecated OS (Windows 2000, 2003, XP, CE), regarding Network printer using SMBv1 scan2shares functionalities, or regarding software accessing Windows share with a custom implementation relying on SMB v1, you should consider fixing these issues before disabling SMB v1, as it will generate additional errors&lt;/b&gt;.</Solution>
        <TechnicalExplanation>The SMB downgrade attack is used to obtain credentials or executing commands on behalf of a user by using SMB v1 as protocol. Indeed, because SMB v1 supports old authentication protocol, the integrity can be bypassed</TechnicalExplanation>
        <Title>DC vulnerability (SMB v1)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to verify if Domain Controller(s) are vulnerable to the MS14-068 vulnerability</Description>
        <Documentation>&lt;a href="https://technet.microsoft.com/en-us/library/security/ms14-068.aspx "&gt;https://technet.microsoft.com/en-us/library/security/ms14-068.aspx &lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/alerte/CERTFR-2014-ALE-011"&gt;[FR]ANSSI CERTFR-2014-ALE-011&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>VulnerabilityManagement</Model>
        <ReportLocation>The startup time of domain controllers can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>S-Vuln-MS14-068</RiskId>
        <Solution>To fix the security breach, you should patch the DC as soon as it has been established it was vulnerable. You can verify that using a program in the links: this program will check remotely the last startup time of the DC and evaluate the risk</Solution>
        <TechnicalExplanation>MS14-068 is a critical vulnerability that was published on November, 18th 2014. It can be used to very quickly compromise an entire domain, which is why having DC still vulnerable to this publicly known vulnerability represents a high security risk.</TechnicalExplanation>
        <Title>DC vulnerability (MS14-068) </Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to identify if there are local groups such as local administrators, terminal server access, where Authenticated Users or Everyone is being granted access by a GPO</Description>
        <Documentation>&lt;a href="http://social.technet.microsoft.com/wiki/contents/articles/20402.active-directory-group-policy-restricted-groups.aspx"&gt;http://social.technet.microsoft.com/wiki/contents/articles/20402.active-directory-group-policy-restricted-groups.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>LocalGroupVulnerability</Model>
        <RiskId>A-MembershipEveryone</RiskId>
        <Solution>In order to correct the issue, you should edit the GPO and change the local group assignation. Another solution is to change the group to a more targeted one containing a limited set of users.</Solution>
        <TechnicalExplanation>It is possible that a GPO adds local membership using a GPO.__    In this case the rule triggers if one is found with "Everyone" or "Authenticated Users" or "Domain Users", ... as members.__    It basically means that the local Group has no restriction on belongs to it. This represents a security risk as Local Group are supposed to have more accesses or rights.__    The GPO configuration is located in Computer Configuration / Policies / Windows Settings / Security Settings / Restricted Group__    __    This rule checks also the membership set in Computer Configuration / Preferences / Control Panel Settings / Local Users and group.</TechnicalExplanation>
        <Title>Check if a GPO assigns everyone to a local group</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to perform a review of which accounts have ownership rights on a domain controller and can then modify their permissions</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_owner"&gt;[FR]ANSSI - Incorrect object owners (vuln3_owner)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>ACLCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>P-DCOwner</RiskId>
        <Solution>To solve this security issue, you should change the ownership of the domain controller to match the "Domain Administrators" group.__To control the ownership of domain controller objects, you can use the following PowerShell command: __&lt;i&gt;Get-ADComputer -server my.domain.to.check -LDAPFilter "(&amp;(objectCategory=computer)(|(primarygroupid=521)(primarygroupid=516)))" -properties name, ntsecuritydescriptor | select name,{$_.ntsecuritydescriptor.Owner}&lt;/i&gt;.__To change it you can edit the owner of an object using &lt;a href="https://docs.microsoft.com/en-us/sysinternals/downloads/adexplorer"&gt;adexplorer.exe&lt;/a&gt;. First, locate the DC object then right click to select properties. Open the security tab and press the advanced button. You then have a new dialog with an owner tab. Select the owner and change it for the domain administrators group. Youâ€™re done (no reboot needed).</Solution>
        <TechnicalExplanation>By default, the "Domain Administrators" group or the "Enterprise Administrators" group are set as owners for "Domain Controllers". Nonetheless, in some cases (for instance when the server has been promoted from an existing server), the owner can be a non-admin person which joined the server to the domain. If this person has still rights over this account, it can be used to take ownership over the whole domain. A chain of compromising events can be designed to take control of the domain by including this account.</TechnicalExplanation>
        <Title>At least one domain controller is not owned correctly</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Trusts</Category>
        <Description>The purpose is to ensure that every account having an SID History is part of an active migration.</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.3.1.5"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R15 [paragraph.3.3.1.5]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_sidhistory_present"&gt;[FR]ANSSI - Accounts or groups with SID history set (vuln3_sidhistory_present)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1134/005"&gt;[MITRE]T1134.005 Access Token Manipulation: SID-History Injection&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>SIDHistory</Model>
        <ReportLocation>The SIDHistory detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt; and a quick summary in &lt;a href="#sidhistory"&gt;SID History&lt;/a&gt;</ReportLocation>
        <RiskId>T-SIDHistoryUnknownDomain</RiskId>
        <Solution>Each security descriptor of the domain (including file shares for example) should be reviewed to be rewritten with the new SID of the account. Then the SID History attribute should be removed. __    __    Please note that once the SID History has been removed, it cannot be added back again without doing a real migration. Possibly hacking tools such as mimikatz could be used to undo a deletion with for example the lsadump::dcshadow attack.__  __To remove the SIDHistory from a user account, run:__&lt;i&gt;Get-ADUser USERNAME -properties sidhistory | foreach {Set-ADUser $_ -remove @{sidhistory=$_.sidhistory.value}}&lt;/i&gt;__For a group, run:__&lt;i&gt;Get-ADGroup GROUPNAME -properties sidhistory | foreach {Set-ADGroup $_ -remove @{sidhistory=$_.sidhistory.value}}&lt;/i&gt;__For all users in a OU:__&lt;i&gt;Get-ADUser -SearchBase "OU=Accounts,DC=mydomain,DC=com" -Filter {sidhistory -like '*'} -properties sidhistory | foreach {Set-ADUser $_ -remove @{sidhistory=$_.sidhistory.value}}&lt;/i&gt;__    </Solution>
        <TechnicalExplanation>When accounts are migrated from one domain to another, the attribute SID History can be appended to the new account to keep track of its former account. The origin can be tracked by removing the last digit of the SID to guess the SID of the origin domain. If the SID of the origin domain cannot be resolved, that means that the domain has been removed and as consequence that the SID History is not needed. This SID History information can be used to give additional rights and thus alter the real security rights.</TechnicalExplanation>
        <Title>Check if the account has been migrated from a domain which doesn't exist anymore</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Trusts</Category>
        <Description>The purpose is to ensure that accounts are not linked for more privileged accounts in the same domain</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.3.1.5"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R15 [paragraph.3.3.1.5]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_sidhistory_present"&gt;[FR]ANSSI - Accounts or groups with SID history set (vuln3_sidhistory_present)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1134/005"&gt;[MITRE]T1134.005 Access Token Manipulation: SID-History Injection&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>SIDHistory</Model>
        <ReportLocation>The SIDHistory detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt; and a quick summary in &lt;a href="#sidhistory"&gt;SID History&lt;/a&gt;</ReportLocation>
        <RiskId>T-SIDHistorySameDomain</RiskId>
        <Solution>It is not possible to have this occurrence except if a user from domain A has been migrated to domain B and then migrated again to domain A. This should be strongly investigated as it may be linked to a compromise of the domain.__    __To remove the SIDHistory from a user account, run:__&lt;i&gt;Get-ADUser USERNAME -properties sidhistory | foreach {Set-ADUser $_ -remove @{sidhistory=$_.sidhistory.value}}&lt;/i&gt;__For a group, run:__&lt;i&gt;Get-ADGroup GROUPNAME -properties sidhistory | foreach {Set-ADGroup $_ -remove @{sidhistory=$_.sidhistory.value}}&lt;/i&gt;__For all users in a OU:__&lt;i&gt;Get-ADUser -SearchBase "OU=Accounts,DC=mydomain,DC=com" -Filter {sidhistory -like '*'} -properties sidhistory | foreach {Set-ADUser $_ -remove @{sidhistory=$_.sidhistory.value}}&lt;/i&gt;__    </Solution>
        <TechnicalExplanation>SID History is an attribute used in migration to link with a former account. It is not possible to have an account linked with an account belonging to the same domain. This can be analyzed by comparing the domain part of the SID History with the domain SID.</TechnicalExplanation>
        <Title>Check for local backdoor stored in SID History</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that basic users cannot register extra computers in the domain</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/troubleshoot/windows-server/identity/default-workstation-numbers-join-domain"&gt;https://docs.microsoft.com/troubleshoot/windows-server/identity/default-workstation-numbers-join-domain&lt;/a&gt;&lt;br&gt;__&lt;a href="http://prajwaldesai.com/allow-domain-user-to-add-computer-to-domain/"&gt;http://prajwaldesai.com/allow-domain-user-to-add-computer-to-domain/&lt;/a&gt;&lt;br&gt;__&lt;a href="http://blog.backslasher.net/preventing-users-from-adding-computers-to-a-domain.html"&gt;http://blog.backslasher.net/preventing-users-from-adding-computers-to-a-domain.html&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1018"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - User Account Management&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_user_accounts_machineaccountquota"&gt;[FR]ANSSI - Unrestricted domain join (vuln4_user_accounts_machineaccountquota)&lt;/a&gt;&lt;span class="badge grade-4"&gt;4&lt;/span&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>Provisioning</Model>
        <RiskId>S-ADRegistration</RiskId>
        <Solution>To solve the issue, limit the number of extra computers that can be registered by a basic user.  It can be reduced by modifying the value of &lt;i&gt;ms-DS-MachineAccountQuota&lt;/i&gt; to zero (0). Another solution can be to remove the "Authenticated Users" group in the domain controllers policy altogether. Do note, that if you need to set delegation to an account, so it can add computers to the domain, it can be done through 2 methods: Delegation in the OU or by assigning the &lt;i&gt;SeMachineAccountPrivilege&lt;/i&gt; to a special group</Solution>
        <TechnicalExplanation>By default, a basic user can register up to 10 computers within the domain. This default configuration represents a security issue as basic users shouldn't be able to create such accounts and this task should be handled by administrators.__    __    If the value of the attribute ms-DS-MachineAccountQuota is not set (the program see this as "Infinite"), there is no limit to computer addition.__    __    Note: this program checks also the GPO for SeMachineAccountPrivilege assignment. This assignment can be used to restrict the impact of the key ms-DS-MachineAccountQuota.</TechnicalExplanation>
        <Title>Check the process of registration of computers to the domain</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that no Root Certificates use the deprecated SHA-1 hashing algorithm</Description>
        <Documentation>&lt;a href="https://tools.ietf.org/html/rfc6194"&gt;https://tools.ietf.org/html/rfc6194&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14820"&gt;[US]STIG V-14820 - PKI certificates (server and clients) must be issued by the DoD PKI or an approved External Certificate Authority (ECA).&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln3_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-SHA1RootCert</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>The SHA1 hashing algorithm is not considered as safe. There are design flaws inherent to the algorithm that allow an attacker to generate a hash collision in less than a brute-force time</TechnicalExplanation>
        <Title>Check for Root Certificates using unsafe hashing algorithm (SHA1)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that no Root Certificates use the deprecated SHA-0 hashing algorithm</Description>
        <Documentation>&lt;a href="https://tools.ietf.org/html/rfc6194"&gt;https://tools.ietf.org/html/rfc6194&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14820"&gt;[US]STIG V-14820 - PKI certificates (server and clients) must be issued by the DoD PKI or an approved External Certificate Authority (ECA).&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln3_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-SHA0RootCert</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>The SHA0 hashing algorithm is not considered as safe. There are design flaws inherent to the algorithm that allow an attacker to generate a hash collision in less than a brute-force time</TechnicalExplanation>
        <Title>Check for Root Certificates using unsafe hashing algorithm (SHA0)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that no Root Certificates use the deprecated MD5 hashing algorithm</Description>
        <Documentation>&lt;a href="https://www.kb.cert.org/vuls/id/836068"&gt;https://www.kb.cert.org/vuls/id/836068&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14820"&gt;[US]STIG V-14820 - PKI certificates (server and clients) must be issued by the DoD PKI or an approved External Certificate Authority (ECA).&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln3_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-MD5RootCert</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>The MD5 hashing algorithm is not considered safe. There are design flaws inherent to the algorithm that allow an attacker to generate a hash collision in less than a brute-force time. Nevertheless, the root certificate algorithm has no direct impact on the security, but it can be used indirectly to force the use of this algorithm in the issued certificate</TechnicalExplanation>
        <Title>Check for Root Certificates using unsafe hashing algorithm (MD5)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that no Root Certificates use the deprecated MD4 hashing algorithm</Description>
        <Documentation>&lt;a href="https://tools.ietf.org/html/rfc6150"&gt;https://tools.ietf.org/html/rfc6150&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14820"&gt;[US]STIG V-14820 - PKI certificates (server and clients) must be issued by the DoD PKI or an approved External Certificate Authority (ECA).&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln3_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-MD4RootCert</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>The MD4 hashing algorithm is not considered safe. There are design flaws inherent to the algorithm that allow an attacker to generate a hash collision in less than a brute-force time. Nevertheless, the root certificate algorithm has no direct impact on the security, but it can be used indirectly to force the use of this algorithm in the issued certificate</TechnicalExplanation>
        <Title>Check for Root Certificates using unsafe hashing algorithm (MD4)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that no Root Certificates use the deprecated MD2 hashing algorithm</Description>
        <Documentation>&lt;a href="https://www.ssi.gouv.fr/archive/fr/sciences/fichiers/lcr/mu04c.pdf"&gt;https://www.ssi.gouv.fr/archive/fr/sciences/fichiers/lcr/mu04c.pdf&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14820"&gt;[US]STIG V-14820 - PKI certificates (server and clients) must be issued by the DoD PKI or an approved External Certificate Authority (ECA).&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln3_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-MD2RootCert</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>The MD2 hashing algorithm is not considered safe. There are design flaws inherent to the algorithm that allow an attacker to generate a hash collision in less than a brute-force time. Nevertheless, the root certificate algorithm has no direct impact on the security, but it can be used indirectly to force the use of this algorithm in the issued certificate</TechnicalExplanation>
        <Title>Check for Root Certificates using unsafe hashing algorithm (MD2)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that there is no use of a certificate using a weak RSA key</Description>
        <Documentation>&lt;a href="https://www.iad.gov/iad/library/ia-guidance/ia-solutions-for-classified/algorithm-guidance/commercial-national-security-algorithm-suite-factsheet.cfm"&gt;https://www.iad.gov/iad/library/ia-guidance/ia-solutions-for-classified/algorithm-guidance/commercial-national-security-algorithm-suite-factsheet.cfm&lt;/a&gt;&lt;br&gt;__&lt;a href="    https://www.ssi.gouv.fr/guide/cryptographie-les-regles-du-rgs/"&gt;    https://www.ssi.gouv.fr/guide/cryptographie-les-regles-du-rgs/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14820"&gt;[US]STIG V-14820 - PKI certificates (server and clients) must be issued by the DoD PKI or an approved External Certificate Authority (ECA).&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln1_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-WeakRSARootCert</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>A RSA key certificate with a modulus under 1024 bits is considered unsafe</TechnicalExplanation>
        <Title>Check for certificates using a weak signing algorithm (RSA under 1024 bits)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that there is no use of the deprecated SHA0 hashing algorithm in Intermediate Certificate</Description>
        <Documentation>&lt;a href="https://tools.ietf.org/html/rfc6194"&gt;https://tools.ietf.org/html/rfc6194&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14820"&gt;[US]STIG V-14820 - PKI certificates (server and clients) must be issued by the DoD PKI or an approved External Certificate Authority (ECA).&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln3_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-SHA0IntermediateCert</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>The SHA0 hashing algorithm is not considered as safe. There are design flaws inherent to the algorithm that allow an attacker to generate a hash collision in less than a brute-force time</TechnicalExplanation>
        <Title>Check for Intermediate Certificates using unsafe hashing algorithm (SHA0)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that there is no use of the deprecated MD2 hashing algorithm in Intermediate Certificate</Description>
        <Documentation>&lt;a href="https://www.ssi.gouv.fr/archive/fr/sciences/fichiers/lcr/mu04c.pdf"&gt;https://www.ssi.gouv.fr/archive/fr/sciences/fichiers/lcr/mu04c.pdf&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14820"&gt;[US]STIG V-14820 - PKI certificates (server and clients) must be issued by the DoD PKI or an approved External Certificate Authority (ECA).&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln3_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-MD2IntermediateCert</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>The MD2 hashing algorithm is not considered safe. There are design flaws inherent to the algorithm that allow an attacker to generate a hash collision in less than a brute-force time</TechnicalExplanation>
        <Title>Check for Intermediate Certificates using unsafe hashing algorithm (MD2)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that there is no use of the deprecated MD4 hashing algorithm in Intermediate Certificate</Description>
        <Documentation>&lt;a href="https://tools.ietf.org/html/rfc6150"&gt;https://tools.ietf.org/html/rfc6150&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14820"&gt;[US]STIG V-14820 - PKI certificates (server and clients) must be issued by the DoD PKI or an approved External Certificate Authority (ECA).&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln3_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-MD4IntermediateCert</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>The MD4 hashing algorithm is not considered safe. There are design flaws inherent to the algorithm that allow an attacker to generate a hash collision in less than a brute-force time</TechnicalExplanation>
        <Title>Check for Intermediate Certificates using unsafe hashing algorithm (MD4)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Trusts</Category>
        <Description>The purpose is to ensure that the SID History creation is not enabled</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.3.1.5"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R15 [paragraph.3.3.1.5]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>SIDHistory</Model>
        <RiskId>S-Domain$$$</RiskId>
        <Solution>If a migration is in progress, declare it in PingCastle so this rule won't be triggered. Else, remove this auditing group. You can locate it by using the LDAP query (sAMAccountName=*$$$)</Solution>
        <TechnicalExplanation>To migrate accounts to another domain, the attribute SID History should be added to the new account. Despite the fact that numerous hacking tools such as mimikatz allows the creation of the SID History attribute, its official creation requires the presence of a special auditing group named DOMAIN-$$$, for example TEST-$$$ for the TEST domain.</TechnicalExplanation>
        <Title>Check if a migration is in progress</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Trusts</Category>
        <Description>The purpose is to ensure that a compromised domain cannot use scripts located in it to compromise other domains</Description>
        <Documentation>&lt;a href="https://attack.mitre.org/techniques/T1210"&gt;[MITRE]T1210 Exploitation of Remote Services&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>TrustImpermeability</Model>
        <ReportLocation>The detail can be found in &lt;a href="#gpologin"&gt;GPO Login script&lt;/a&gt; and in &lt;a href="#logonscripts"&gt;Logon Scripts&lt;/a&gt;</ReportLocation>
        <RiskId>T-ScriptOutOfDomain</RiskId>
        <Solution>Copy the login script to a share located inside the domain and not in trusted domains.</Solution>
        <TechnicalExplanation>Login scripts can be stored in any file share available in the network and that includes trusted domains shares. If a login script is located in a compromise domain, it can be used to compromise other domains.</TechnicalExplanation>
        <Title>Check if login scripts may be located in a trusted domain</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to check if access without any account, aka NULL Sessions, is possible within the Active Directory. A NULL Session is a session opened anonymously to access the AD, often used by attackers to perform a recon operation on the AD, to identify weaknesses</Description>
        <Documentation>&lt;a href="https://www.sans.org/reading-room/whitepapers/windows/null-sessions-nt-2000-286"&gt;https://www.sans.org/reading-room/whitepapers/windows/null-sessions-nt-2000-286&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14798"&gt;[US]STIG V-14798 - Directory data (outside the root DSE) of a non-public directory must be configured to prevent anonymous access.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/003"&gt;[MITRE]T1110.003 Brute Force: Password Spraying&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>Reconnaissance</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt; and  &lt;a href="#nullsession"&gt;Null Session&lt;/a&gt;</ReportLocation>
        <RiskId>A-NullSession</RiskId>
        <Solution>Locate other PingCastle rules such as A-PreWin2000Anonymous or A-DsHeuristicsAnonymous which triggered and apply the solutions. You can use the PingCastle scanner mode to do a manual check and prove the extraction of the data.</Solution>
        <TechnicalExplanation>Unlike other rules, which check for known cause of anonymous access, this rule tries to enumerate accounts from the domain without any account. The program uses two methods: MS-SAMR with a NULL connection and MS-LSAT, which forces SID resolution with a well known SID.__NULL sessions are deactivated by default since Windows Server 2003 and Windows XP. For compatibility reasons a setting enabling them may be still active years after.__It is possible to verify the results provided by the PingCastle solution by using a Kali distribution. You should run [rpcclient -U " target_ip_address] and press enter at the password prompt to finally type [enumdomusers].</TechnicalExplanation>
        <Title>Retrieve data from the domain without any account</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to identify domains which allow access without any account because of a Pre-Windows 2000 compatibility</Description>
        <Documentation>&lt;a href="https://msdn.microsoft.com/en-us/library/cc223672.aspx"&gt;https://msdn.microsoft.com/en-us/library/cc223672.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-8547"&gt;[US]STIG V-8547 - The Anonymous Logon and Everyone groups must not be members of the Pre-Windows 2000 Compatible Access group.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_compatible_2000_anonymous"&gt;[FR]ANSSI - The "Pre - Windows 2000 Compatible Access" group includes "Anonymous" (vuln2_compatible_2000_anonymous)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/003"&gt;[MITRE]T1110.003 Brute Force: Password Spraying&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>Reconnaissance</Model>
        <RiskId>A-PreWin2000Anonymous</RiskId>
        <Solution>Remove the "Everyone" and "Anonymous" from the PreWin2000 group while making sure that the group "Authenticated Users" is present, then reboot each DC.__    Note: removing the group "Authenticated Users" (and not keep it like advised here) is an advanced recommendation quoted in the rule A-PreWin2000AuthenticatedUsers</Solution>
        <TechnicalExplanation>When a Windows Server 2003 DC is promoted, a pre-Windows 2000 compatibility setting can be enabled through the wizard. If it is enabled, the wizard will add "Everyone" and "Anonymous" to the pre-Windows 2000 compatible access group, and by doing so, it will authorize the domain to be queried without an account (null session)__It is possible to verify the results provided by the PingCastle solution by using a Kali distribution. You should run [rpcclient -U " target_ip_address] and press enter at the password prompt to finally type [enumdomusers].</TechnicalExplanation>
        <Title>Check for Windows 2000 compatibility which allows access to the domain without any account</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that there is no use of the deprecated SHA1 hashing algorithm in Intermediate Certificate</Description>
        <Documentation>&lt;a href="https://tools.ietf.org/html/rfc6194"&gt;https://tools.ietf.org/html/rfc6194&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14820"&gt;[US]STIG V-14820 - PKI certificates (server and clients) must be issued by the DoD PKI or an approved External Certificate Authority (ECA).&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln3_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-SHA1IntermediateCert</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>The SHA1 hashing algorithm is not considered as safe. There are design flaws inherent to the algorithm that allow an attacker to generate a hash collision in less than a brute-force time</TechnicalExplanation>
        <Title>Check for Intermediate Certificates using unsafe hashing algorithm (SHA1)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that there is no use of the deprecated MD5 hashing algorithm in Intermediate Certificate</Description>
        <Documentation>&lt;a href="https://www.kb.cert.org/vuls/id/836068"&gt;https://www.kb.cert.org/vuls/id/836068&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14820"&gt;[US]STIG V-14820 - PKI certificates (server and clients) must be issued by the DoD PKI or an approved External Certificate Authority (ECA).&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_certificates_vuln"&gt;[FR]ANSSI - Weak or vulnerable certificates (vuln3_certificates_vuln)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1600/001"&gt;[MITRE]T1600.001 Weaken Encryption: Reduce Key Space&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>CertificateTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#certificates"&gt;Certificates&lt;/a&gt;</ReportLocation>
        <RiskId>A-MD5IntermediateCert</RiskId>
        <Solution>To solve the matter, the certificate should be removed from the GPO and if needed, certificates depending on it should be reissued.</Solution>
        <TechnicalExplanation>The MD5 hashing algorithm is not considered safe. There are design flaws inherent to the algorithm that allow an attacker to generate a hash collision in less than a brute-force time</TechnicalExplanation>
        <Title>Check for Intermediate Certificates using unsafe hashing algorithm (MD5)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to give information regarding a best practice for the Service Account password policy. Indeed, having a 20+ characters password for this account greatly helps reducing the risk of Kerberoasting attacks (offline cracking of the TGS tickets)__Note: PSO (Password Settings Objects) will be visible only if the user, which collected the information, has the permission to view it.</Description>
        <Documentation>&lt;a href="https://www.microsoft.com/en-us/research/publication/password-guidance/"&gt;https://www.microsoft.com/en-us/research/publication/password-guidance/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1201"&gt;[MITRE]T1201 Password Policy Discovery&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>WeakPassword</Model>
        <ReportLocation>The detail can be found in &lt;a href="#passwordpolicies"&gt;Password Policies&lt;/a&gt;</ReportLocation>
        <RiskId>A-NoServicePolicy</RiskId>
        <Solution> The recommended way to handle service accounts is to use "Managed service accounts" introduced since Windows Server 2008 R2 (search for "msDS-ManagedServiceAccount").__To solve the anomaly, you should implement a PSO or GPO password guarantying a 20+ length password.</Solution>
        <TechnicalExplanation>The rule is purely informative, as it gives insights regarding a best practice. It verifies if there is a GPO or PSO enforcing a 20+ characters password for the Service Accounts. </TechnicalExplanation>
        <Title>Check the Password Policy for Service Accounts (Information)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to identify if accounts without password are allowed to be accessed from the network. This represents a high risk, as an account without a password is essentially an account that cannot be assigned to anyone. </Description>
        <Documentation>&lt;a href="https://technet.microsoft.com/en-us/library/jj852174.aspx"&gt;https://technet.microsoft.com/en-us/library/jj852174.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/003"&gt;[MITRE]T1110.003 Brute Force: Password Spraying&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>WeakPassword</Model>
        <ReportLocation>The detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>A-LimitBlankPasswordUse</RiskId>
        <Solution>Locate the policy having the setting "Limit local account use of blank passwords to console logon only" disabled and enabled the setting.</Solution>
        <TechnicalExplanation>This rule verifies if there is a GPO with the setting "Limit local account use of blank passwords to console logon only" disabled.</TechnicalExplanation>
        <Title>Check for GPO allowing accounts without password to be accessed from the network</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to identify domains having a GPO which allows access to the domain without any account </Description>
        <Documentation>&lt;a href="https://technet.microsoft.com/en-us/library/cc963223.aspx"&gt;https://technet.microsoft.com/en-us/library/cc963223.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://technet.microsoft.com/en-us/library/jj852184.aspx"&gt;https://technet.microsoft.com/en-us/library/jj852184.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-14798"&gt;[US]STIG V-14798 - Directory data (outside the root DSE) of a non-public directory must be configured to prevent anonymous access.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/003"&gt;[MITRE]T1110.003 Brute Force: Password Spraying&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>Reconnaissance</Model>
        <ReportLocation>The detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>A-AnonymousAuthorizedGPO</RiskId>
        <Solution>In order to remove the anonymous access, we advise to identify the GPO indicated by the program and change the setting restrictanonymous and restrictanonymoussam</Solution>
        <TechnicalExplanation>It is possible that domains are set to authorize connection without any account, which represents a security breach. It allows potential attackers to enumerate all the users and computers belonging to a domain, in order to identify very efficiently future weak targets.__It is possible to verify the results provided by the PingCastle solution by using a Kali Linux distribution. You should run [rpcclient -U " target_ip_address] and press enter at the password prompt to finally type [enumdomusers].</TechnicalExplanation>
        <Title>Check for GPO granting access to the domain without any account</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The authentication protocol NTLM v1 can use the LM password hash algorithm which is very weak if enabled by a GPO.</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.6.2.1"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R37 [paragraph.3.6.2.1]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/windows_2008_member_server/2018-03-07/finding/V-3379"&gt;[US]STIG V-3379 - The system is configured to store the LAN Manager hash of the password in the SAM.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/002"&gt;[MITRE]T1110.002 Brute Force: Password Cracking&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>NetworkSniffing</Model>
        <ReportLocation>The detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>A-LMHashAuthorized</RiskId>
        <Solution>A GPO explicitly disabled the default security policy LmCompatibilityLevel or NoLMHash. Using the information provided, identify the setting modified in the GPO and fix it.__All security settings should be modified in the Domain GPO Editor and are located in Computer Configuration / Policies / Windows Settings / Security Settings / Local Policies / Security Options__For NoLMHash the setting is located in: Network security: Do not store LAN Manager hash value on next password change__For LmCompatibilityLevel the setting is located in: Network security: LAN Manager authentication level</Solution>
        <TechnicalExplanation>LM hash, or LAN Manager hash is a hash algorithm developed by Microsoft since Windows 3.1. Due to a flawed design, hashes retrieved from the network can be reverted to the clear text password in a matter of seconds.</TechnicalExplanation>
        <Title>Check for GPO enabling the unsafe algorithm LM hash</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to verify if the password policy of the domain enforces users to have at least 8 characters in their password</Description>
        <Documentation>&lt;a href="https://www.microsoft.com/en-us/research/publication/password-guidance/"&gt;https://www.microsoft.com/en-us/research/publication/password-guidance/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_privileged_members_password"&gt;[FR]ANSSI - Privileged group members with weak password policy (vuln2_privileged_members_password)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1201"&gt;[MITRE]T1201 Password Policy Discovery&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>WeakPassword</Model>
        <ReportLocation>The detail can be found in &lt;a href="#passwordpolicies"&gt;Password policies&lt;/a&gt;</ReportLocation>
        <RiskId>A-MinPwdLen</RiskId>
        <Solution>To solve the issue, the best way is to either remove the GPO enabling short password, or to modify it in order to increase the password length to at least 8 characters</Solution>
        <TechnicalExplanation>A check is performed to identify if the GPO regarding password policy allows less than 8 characters password. Short passwords represent a high risk because they can fairly easily be brute-forced or password sprayed. Most CERT and agencies advise for at least 8 characters (and often this number goes up to 12)</TechnicalExplanation>
        <Title>Check for short password length in password policy</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to verify if a GPO alters the password policy of the domain to enable reversible passwords</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/store-passwords-using-reversible-encryption"&gt;https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/store-passwords-using-reversible-encryption&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_reversible_password"&gt;[FR]ANSSI - Accounts with passwords stored using reversible encryption (vuln3_reversible_password)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/002"&gt;[MITRE]T1110.002 Brute Force: Password Cracking&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>PasswordRetrieval</Model>
        <ReportLocation>The detail can be found in &lt;a href="#lsasettings"&gt;Security settings&lt;/a&gt;</ReportLocation>
        <RiskId>A-ReversiblePwd</RiskId>
        <Solution>In order to remove the reversible passwords, we advise to identify the GPO indicated by the program and change the setting "Store passwords using reversible encryption"</Solution>
        <TechnicalExplanation>The policy "Store passwords using reversible encryption" is enabled. In this case, it means that the password is actually stored in clear text in the &lt;i&gt;supplementalCredential&lt;/i&gt; attribute of the account and that it can be retrieved using a DCSync attack.</TechnicalExplanation>
        <Title>Check for GPO which enables reversible passwords</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to make sure the requirement of Smart Cards doesn't degrade password rotation</Description>
        <Documentation>&lt;a href="https://blogs.technet.microsoft.com/positivesecurity/2017/05/17/smartcard-and-pass-the-hash/"&gt;https://blogs.technet.microsoft.com/positivesecurity/2017/05/17/smartcard-and-pass-the-hash/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/nsacyber/Pass-the-Hash-Guidance"&gt;https://github.com/nsacyber/Pass-the-Hash-Guidance&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-72821"&gt;[US]STIG V-72821 - All accounts, privileged and unprivileged, that require smart cards must have the underlying NT hash rotated at least every 60 days.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.6.2.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R38 [paragraph.3.6.2.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/002"&gt;[MITRE]T1110.002 Brute Force: Password Cracking&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>PassTheCredential</Model>
        <ReportLocation>The detail can be found in &lt;a href="#smartcardmandatorywithnopasswordchange"&gt;Smart Card and Password&lt;/a&gt;</ReportLocation>
        <RiskId>A-SmartCardRequired</RiskId>
        <Solution>There are a few solutions to fix this issue, the most obvious being to change the user password on a regular basis. __    The fastest way is to check if the domain has the attribute &lt;i&gt;msDS-ExpirePasswordsOnSmartCardOnlyAccounts&lt;/i&gt;, which is available for Windows Server 2016 and later versions and handles periodically hash change. __    Be sure also that functional level is at least Windows Server 2016 the GPO "Enable rolling of expiring NTLM secrets during sign on, for users who are required to use Microsoft Passport or smart card for interactive sign on"  is not disabled.__    Another possibility, instead of changing the password, is to disable the flag "this account requires a smart card" then re-enable it, which will trigger an internal password hash change.__    You can also used the script provided by the DoD named Invoke-SmartcardHashRefresh (see link below)</Solution>
        <TechnicalExplanation>Using smart cards to protected sensitive accounts is a good thing. Nevertheless, when the "Smart Card required" flag is set, the password of the account is not changed anymore by default. The rule is triggered 90 days after the last change of the attribute unicodePwd. This value is collected using the replication metadata of the attribute 589914</TechnicalExplanation>
        <Title>Check for accounts using smart card with unchanged password for a long time</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to alert when a password is present in a GPO. If a password is in a GPO, the password should be considered compromised and reset.</Description>
        <Documentation>&lt;a href="https://msdn.microsoft.com/en-us/library/cc422924.aspx"&gt;https://msdn.microsoft.com/en-us/library/cc422924.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/actualite/CERTFR-2015-ACT-046/#SECTION00020000000000000000"&gt;[FR]ANSSI CERTFR-2015-ACT-046&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1552/006"&gt;[MITRE]T1552.006 Unsecured Credentials: Group Policy Preferences&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>PasswordRetrieval</Model>
        <ReportLocation>The detail can be found in the &lt;a href="#gpoobfuscatedpassword"&gt;Obfuscated Passwords&lt;/a&gt;</ReportLocation>
        <RiskId>A-PwdGPO</RiskId>
        <Solution>To solve this issue, you should manually change the password to a new one. If this password is shared on many systems, each system should have a different password. If the GPO was used to define the native local administrator account, it is recommended to install a password solution manager such as LAPS.</Solution>
        <TechnicalExplanation>PingCastle attempts to identify passwords stored in GPOs. If PingCastle was able to retrieve a password, attackers can also obtain it and so the account should be considered compromised. Note that Microsoft published the AES key used to encrypt passwords in GPOs, which is why even an encrypted password is insecure.</TechnicalExplanation>
        <Title>Find Password GPO</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to ensure that there are no rogue admin accounts in the Active Directory</Description>
        <Documentation>&lt;a href="https://msdn.microsoft.com/en-us/library/ms675212(v=vs.85).aspx"&gt;https://msdn.microsoft.com/en-us/library/ms675212(v=vs.85).aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.6.3.1"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R40 [paragraph.3.6.3.1]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_privileged_members_no_admincount"&gt;[FR]ANSSI - Privileged groups members having an adminCount attribute which is null or 0 (vuln2_privileged_members_no_admincount)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>TemporaryAdmins</Model>
        <ReportLocation>The detail can be found in the &lt;a href="#admincountequalsone"&gt;AdminSDHolder User List&lt;/a&gt;</ReportLocation>
        <RiskId>A-AdminSDHolder</RiskId>
        <Solution>These accounts should be reviewed, especially in regards with their past activities and have the admincount attribute removed. In order to identify which accounts are detected by this rule, we advise to run a PowerShell command that will show you all users having this flag set: &lt;i&gt;get-adobject -ldapfilter "(admincount=1)"&lt;/i&gt;__    Do not forget to look at the section AdminSDHolder below.</Solution>
        <TechnicalExplanation>A check is performed on non-admin accounts in order to identify if they have an attribute &lt;i&gt;admincount&lt;/i&gt; set. If they have this attribute, it means that this account, which is not supposed to be admin, has been granted administrator rights in the past. This typically happens when an administrator gives temporary rights to a normal account, off process.</TechnicalExplanation>
        <Title>Check for suspicious account(s) used in administrator activities</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to alert when the password for the krbtgt account can be used to compromise the whole domain. This password can be used to sign every Kerberos ticket. Monitoring it closely often mitigates the risk of golden ticket attacks greatly.</Description>
        <Documentation>&lt;a href="https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/faqs-from-the-field-on-krbtgt-reset/ba-p/2367838"&gt;https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/faqs-from-the-field-on-krbtgt-reset/ba-p/2367838&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/microsoft/New-KrbtgtKeys.ps1"&gt;https://github.com/microsoft/New-KrbtgtKeys.ps1&lt;/a&gt;&lt;br&gt;__&lt;a href="https://github.com/PSSecTools/Krbtgt"&gt;https://github.com/PSSecTools/Krbtgt&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/actualite/CERTFR-2014-ACT-032/#SECTION00030000000000000000"&gt;[FR]ANSSI CERTFR-2014-ACT-032&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_krbtgt"&gt;[FR]ANSSI - Krbtgt account password unchanged for more than a year (vuln2_krbtgt)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558/001"&gt;[MITRE]T1558.001 Steal or Forge Kerberos Tickets: Golden Ticket&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>GoldenTicket</Model>
        <ReportLocation>The detail can be found in &lt;a href="#krbtgt"&gt;Krbtgt&lt;/a&gt;</ReportLocation>
        <RiskId>A-Krbtgt</RiskId>
        <Solution>The password of the krbtgt account should be changed twice to invalidate the golden ticket attack.__&lt;b&gt;Beware: two changes of the krbtgt password not replicated to domain controllers can break these domain controllers&lt;/b&gt; You should wait at least 10 hours between each krbtgt password change (this is the duration of a ticket life).____There are several possibilities to change the krbtgt password.__First, a &lt;a href="https://github.com/microsoft/New-KrbtgtKeys.ps1/blob/master/New-KrbtgtKeys.ps1"&gt;Microsoft script&lt;/a&gt; can be run in order to guarantee the correct replication of these secrets.__Second, a more manual way is to essentially reset the password manually once, then to wait 3 days (this is a replication safety delay), then to reset it again. This is the safest way as it ensures the password is no longer usable by the Golden ticket attack.__   </Solution>
        <TechnicalExplanation>Kerberos is an authentication protocol. It is using a secret, stored as the password of the krbtgt account, to sign its tickets. If the hash of the password of the krbtgt account is retrieved, it can be used to generate authentication tickets at will.__To mitigate this attack, it is recommended to change the krbtgt password between 40 days and 6 months. If this is not the case, every backup done until the last password change of the krbtgt account can be used to emit Golden tickets, compromising the entire domain.__Retrieval of this secret is one of the highest priority in an attack, as this password is rarely changed and offer a long term backdoor.__Also this attack can be performed using the former password of the krbtgt account. That's why the krbtgt password should be changed twice to invalidate its leak.</TechnicalExplanation>
        <Title>Mitigate golden ticket attack via a regular change of the krbtgt password</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to verify the presence of dangerous rights when a part of the domain is delegated to a third party</Description>
        <Documentation>&lt;a href="https://technet.microsoft.com/en-us/library/ff405676.aspx"&gt;https://technet.microsoft.com/en-us/library/ff405676.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsubsection.3.3.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R18 [subsubsection.3.3.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ACLCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admindelegation"&gt;Delegations&lt;/a&gt;</ReportLocation>
        <RiskId>P-DangerousExtendedRight</RiskId>
        <Solution>Unless there is a strong justification of their presence, these delegations should be removed. In addition, if the origin of this delegation cannot be found, their creation should be investigated as it could be related to a compromise of the domain</Solution>
        <TechnicalExplanation>The right "REANIMATE_TOMBSTONE" used to undelete objects, "UNEXPIRE_PASSWORD" used to undo the expiration of a password, or "SID_HISTORY" used to create an alternate identity is considered dangerous. Indeed, this right can be used to trigger a backdoor.</TechnicalExplanation>
        <Title>Check for Dangerous rights found in OU delegation</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to verify that there is no delegation granted to "Everyone" or to "Authenticated Users"</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsubsection.3.3.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R18 [subsubsection.3.3.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-2370"&gt;[US]STIG V-2370 - The access control permissions for the directory service site group policy must be configured to use the required access permissions.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1187"&gt;[MITRE]T1187 Forced Authentication&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>DelegationCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admindelegation"&gt;Delegations&lt;/a&gt;</ReportLocation>
        <RiskId>P-DelegationEveryone</RiskId>
        <Solution>Review the delegation to remove this permission and if needed, set a more targeted group as recipient of the delegation.</Solution>
        <TechnicalExplanation>To delegate control to a OU, access checks can be modified. In case of a misconfiguration, access can be granted to the group "Everyone" or "Authenticated Users".</TechnicalExplanation>
        <Title>A Delegation is granted to Everyone</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to verify that each delegation is linked to an account which exists</Description>
        <Documentation>&lt;a href="https://www.stigviewer.com/stig/active_directory_service_2003/2011-05-20/finding/V-2370"&gt;[US]STIG V-2370 - The access control permissions for the directory service site group policy must be configured to use the required access permissions.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1187"&gt;[MITRE]T1187 Forced Authentication&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>DelegationCheck</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admindelegation"&gt;Delegations&lt;/a&gt;</ReportLocation>
        <RiskId>P-UnkownDelegation</RiskId>
        <Solution>To reduce the risk, the easiest way is essentially to remove the delegation</Solution>
        <TechnicalExplanation>In the case where a delegation has been created, where the account can't be translated to a NT account, it means that the delegation is actually from another domain or that the user has been deleted. </TechnicalExplanation>
        <Title>Check delegations for the recipient's existence</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that no account can make unexpected modifications to the schema</Description>
        <Documentation>&lt;a href="https://www.stigviewer.com/stig/active_directory_forest/2016-12-19/finding/V-72835"&gt;[US]STIG V-72835 - Membership to the Schema Admins group must be limited&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsection.3.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R13 [subsection.3.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>IrreversibleChange</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admingroups"&gt;Admin Groups&lt;/a&gt;</ReportLocation>
        <RiskId>P-SchemaAdmin</RiskId>
        <Solution>Remove the accounts or groups belonging to the "schema administrators" group.</Solution>
        <TechnicalExplanation>The group "Schema Admins" is used to give permissions to alter the schema. Once a modification is performed on the schema such as new objects, it cannot be undone. This can result in a rebuild of the domain. The best practice is to have this group empty and to add an administrator when a schema update is required, then remove this group membership.</TechnicalExplanation>
        <Title>Avoid unexpected schema modifications which could result in domain rebuild</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to check for accounts with non-expiring passwords in the "Domain Administrator" group</Description>
        <Documentation>&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-36432"&gt;[US]STIG V-36432 - Membership to the Domain Admins group must be restricted to accounts used only to manage the Active Directory domain and domain controllers.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsection.2.5"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R11 [subsection.2.5]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_dont_expire_priv"&gt;[FR]ANSSI - Privileged accounts with never-expiring passwords (vuln1_dont_expire_priv)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1003/004"&gt;[MITRE]T1003.004 OS Credential Dumping: LSA Secrets&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>PrivilegeControl</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admingroups"&gt;Admin Groups&lt;/a&gt;</ReportLocation>
        <RiskId>P-ServiceDomainAdmin</RiskId>
        <Solution>Accounts with never expiring passwords are mostly service accounts. __    To mitigate the security risk, it is strongly advised to lower the privileges of the "Service Accounts", meaning that they should be removed from the "Domain Administrator" group, while ensuring that the password of each and every "Service Account" is longer than 20 characters</Solution>
        <TechnicalExplanation>PingCastle is checking accounts with never expiring password, that are mostly used as service accounts.__    "Service Accounts" can imply a high security risk as their password are stored in clear text in the LSA database, which can then be easily exploited using Mimikatz or Cain&amp;Abel for instance. In addition, their passwords don't change and can be used in Kerberoast attacks.</TechnicalExplanation>
        <Title>Check if Service Accounts (aka accounts with never expiring password) are domain administrators</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that all Administrator Accounts have the configuration flag "this account is sensitive and cannot be delegated" (or are members of the built-in group "Protected Users" when your domain functional level is at least Windows Server 2012 R2).</Description>
        <Documentation>&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-36435"&gt;[US]STIG V-36435 - Delegation of privileged accounts must be prohibited.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>AccountTakeOver</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admingroups"&gt;Admin Groups&lt;/a&gt;</ReportLocation>
        <RiskId>P-Delegated</RiskId>
        <Solution>To correct the situation, you should make sure that all your Administrator Accounts have the check-box "This account is sensitive and cannot be delegated" active or add your Administrator Accounts to the built-in group "Protected Users" if your domain functional level is at least Windows Server 2012 R2 (some functionalities may not work properly afterwards, you should check the &lt;a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/manage/how-to-configure-protected-accounts"&gt;official documentation&lt;/a&gt;).___If you want to enable the check-box "This account is sensitive and cannot be delegated" but this is not possible because the box is not present (typically for GMSA accounts), you can add the flag manually by adding the number 1048576 to the attribute useraccountcontrol of the account.___Please note that there is a section below in this report named "Admin Groups" which gives more information.</Solution>
        <TechnicalExplanation>Without the flag "This account is sensitive and cannot be delegated" any account can be impersonated by some service account. It is a best practice to enforce this flag on administrators accounts.</TechnicalExplanation>
        <Title>At least one administrator account can be delegated</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to ensure that all Administrator Accounts in the AD are necessary and used</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsection.3.6"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R36 [subsection.3.6]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>AdminControl</Model>
        <RiskId>P-Inactive</RiskId>
        <Solution>To correct the situation, you should make sure that all your Administrator Account(s) are "Active", meaning that you should remove Administrator rights if an account is set as not "Active"</Solution>
        <TechnicalExplanation>Accounts within the AD have attributes indicating the creation date of the account and the last login of this account. Accounts which haven't have a login since 6 months or created more than 6 months ago without any login are considered inactive. If an Administrator Account is set as inactive, the reason for having Administrator rights should be strongly justified.</TechnicalExplanation>
        <Title>Check for inactive administrator accounts</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to verify if the number of administrator accounts is not disproportionate. Very few users should have domain admin accounts.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/implementing-least-privilege-administrative-models"&gt;https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/implementing-least-privilege-administrative-models&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsection.3.5"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R26 [subsection.3.5]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsubsection.3.5.7"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R30 [subsubsection.3.5.7]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_privileged_members"&gt;[FR]ANSSI - Large privileged group member count (vuln1_privileged_members)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>AdminControl</Model>
        <ReportLocation>The detail can be found in &lt;a href="#admingroups"&gt;Admin Groups&lt;/a&gt;</ReportLocation>
        <RiskId>P-AdminNum</RiskId>
        <Solution>It is strongly advised to perform a review of which users have domain administrator rights, and to ensure that these rights are actually needed. Indeed, the end goal is to remove as much domain administrator as possible, as very few users actually need these high-level rights.__    The rule is triggered if the number of cumulated privileged members is more than 50 accounts or if it represents more than 10 percent of the user accounts.__  This rule is enabled only if the domain has more than 100 active users.</Solution>
        <TechnicalExplanation>Every domain administrator represents a possible security breach, this is why it is strongly advised to have as few domain administrator accounts as possible</TechnicalExplanation>
        <Title>Check for number of Administrator accounts above the baseline</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>PrivilegedAccounts</Category>
        <Description>The purpose is to verify if the Native Administrator account is used.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/implementing-least-privilege-administrative-models"&gt;https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/implementing-least-privilege-administrative-models&lt;/a&gt;&lt;br&gt;__&lt;a href="https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/how-lastlogontimestamp-is-updated-with-kerberos-s4u2self/ba-p/257135"&gt;https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/how-lastlogontimestamp-is-updated-with-kerberos-s4u2self/ba-p/257135&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>AdminControl</Model>
        <RiskId>P-AdminLogin</RiskId>
        <Solution>To mitigate security risks effectively, it is advisable to reserve the Native Administrator account solely for emergency situations, with daily tasks being carried out using separate accounts. It is strongly recommended not to employ this account routinely, opting instead for individualized accounts for administrators and dedicated accounts for services. It's worth noting that any anomalies related to this practice will be automatically addressed and resolved within 35 days following the last login by a native administrator.____To monitor the most recent use of the administrator account, we recommend extracting the LastLogon attribute of the administrator account from ALL domain controllers. This task can be accomplished using tools such as ADSIEdit or ADExplorer. Subsequently, for each domain controller, extract the event ID 4624 corresponding to the LastLogon date. This will enable you to pinpoint the computer and process responsible for the logon event.____It's worth mentioning that prior to version 3.2 of PingCastle, this information was obtained through the LastLogonTimestamp attribute, which could have been altered by the Kerberos S4u2Self mechanism. While this approach offered the advantage of gathering data from domain controllers that were otherwise inaccessible via the network, it often resulted in a high number of false positives.  __    </Solution>
        <TechnicalExplanation>The Native Administrator account serves as the primary administrative account and often shares its password with the Directory Services Restore Mode password. This shared password presents a potential security vulnerability as it can be exploited to gain control of the domain, even if the account itself is disabled. This vulnerability is particularly notable in the context of a DCSync attack.____Previously, the last login date was obtained by querying the LastLogonTimestamp LDAP attribute from the Active Directory. However, there was an exception in place, allowing for a 35-day window to prevent this rule from being triggered during domain creation. Since the release of PingCastle version 3.2, the last login date is acquired by connecting to each domain controller and querying the LastLogon attribute.</TechnicalExplanation>
        <Title>Check for Native administrator usage</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Anomalies</Category>
        <Description>The purpose is to identify domains having a forest setting which allows access to the domain without any account </Description>
        <Documentation>&lt;a href="https://msdn.microsoft.com/en-us/library/cc223560.aspx"&gt;https://msdn.microsoft.com/en-us/library/cc223560.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://support.microsoft.com/en-us/help/326690/anonymous-ldap-operations-to-active-directory-are-disabled-on-windows"&gt;https://support.microsoft.com/en-us/help/326690/anonymous-ldap-operations-to-active-directory-are-disabled-on-windows&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_forest/2016-12-19/finding/V-8555"&gt;[US]STIG V-8555 - Anonymous Access to AD forest data above the rootDSE level must be disabled. &lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_dsheuristics_bad"&gt;[FR]ANSSI - Dangerous dsHeuristics settings (vuln2_dsheuristics_bad)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/003"&gt;[MITRE]T1110.003 Brute Force: Password Spraying&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>Reconnaissance</Model>
        <RiskId>A-DsHeuristicsAnonymous</RiskId>
        <Solution>The easiest and fastest way to correct this issue is to &lt;b&gt;replace the seventh (7th) character of the DsHeuristics attribute&lt;/b&gt;. If it is a 2, replace by 0 to fix the issue.</Solution>
        <TechnicalExplanation>The way an Active Directory behaves can be controlled via the attribute &lt;i&gt;DsHeuristics&lt;/i&gt; of &lt;i&gt;CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration&lt;/i&gt;. A parameter stored in its attribute and whose value is &lt;i&gt;fLDAPBlockAnonOps&lt;/i&gt; can be set to allow access without any account on the &lt;b&gt;whole forest level&lt;/b&gt;.__It is possible to verify the results provided by the PingCastle solution by using a Kali Linux distribution. You should run &lt;i&gt;rpcclient -U " target_ip_address&lt;/i&gt; and press enter at the password prompt to finally type &lt;i&gt;enumdomusers&lt;/i&gt;.</TechnicalExplanation>
        <Title>Check for access without any account via a forest wide setting</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Trusts</Category>
        <Description>The purpose is to verify that every trust has a remote domain which is active.</Description>
        <Documentation>&lt;a href="https://msdn.microsoft.com/fr-fr/library/ms680921(v=vs.85).aspx"&gt;https://msdn.microsoft.com/fr-fr/library/ms680921(v=vs.85).aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_trusts_accounts"&gt;[FR]ANSSI - Trust account passwords unchanged for more than a year (vuln2_trusts_accounts)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557"&gt;[MITRE]T1557 Man-in-the-Middle&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>TrustInactive</Model>
        <ReportLocation>The detail can be found in &lt;a href="#discovereddomains"&gt;Trusts section&lt;/a&gt;</ReportLocation>
        <RiskId>T-Inactive</RiskId>
        <Solution>Check for network connectivity issues from the remote domain or if the remote domain still exists. If it doesn't exist anymore, the trust should be removed. Otherwise, the secret used by the trust can be used to issue fake Kerberos tickets and be used as a backdoor.</Solution>
        <TechnicalExplanation>When a trust is active, it is using a shared secret to communicate to a domain. This secret is hold in a special account whose name is the remote domain name. This password is changed every month and as consequence the whenChanged attribute of this account is changed. When there is no modification of the whenChanged attribute, it can be guessed that the secret has not been changed and that there was either a problem with the remote domain or that the remote domain does not exist anymore.</TechnicalExplanation>
        <Title>Check for inactive trusts</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Trusts</Category>
        <Description>The purpose is to ensure that there is no NT4 compatible trust</Description>
        <Documentation>&lt;a href="https://msdn.microsoft.com/en-us/library/cc223771.aspx"&gt;https://msdn.microsoft.com/en-us/library/cc223771.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1026"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Privileged Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>OldTrustProtocol</Model>
        <ReportLocation>The detail can be found in &lt;a href="#discovereddomains"&gt;Trusts section&lt;/a&gt;</ReportLocation>
        <RiskId>T-Downlevel</RiskId>
        <Solution>Unless the remote party of the trust is a NT4 domain, this trust shouldn't exist. It should be recreated.</Solution>
        <TechnicalExplanation>A Downlevel trust is a special kind of trust compatible with NT4. The kind of trust can be displayed in the "Active Directory Domains and Trusts" tool.</TechnicalExplanation>
        <Title>Check for trusts compatible with NT4</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows Server 2003 as Domain Controller within the domain</Description>
        <Documentation>&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-8551"&gt;[US]STIG V-8551 - The domain functional level must be at a Windows Server version still supported by Microsoft.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsection.3.1"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R12 [subsection.3.1]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_warning_dc_obsolete"&gt;[FR]ANSSI - DC/RODC with an obsolete operating system (vuln1_warning_dc_obsolete)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The operating system of domain controllers can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>S-DC-2003</RiskId>
        <Solution>To resolve this security risk, the only way is to decommission DC running Windows Server 2003 OS, in order to use new versions that are more secured and that are still being patched regarding new security threats</Solution>
        <TechnicalExplanation>The OS Windows Server 2003 as a DC is vulnerable to many publicly known exploits such as MS14-068 and it is very complicated to patch it at this date. A domain running this OS version should be considered compromised</TechnicalExplanation>
        <Title>Obsolete Domain Controller (Windows Server 2003)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows 2000 as Domain Controller within the domain</Description>
        <Documentation>&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-8551"&gt;[US]STIG V-8551 - The domain functional level must be at a Windows Server version still supported by Microsoft.&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsection.3.1"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R12 [subsection.3.1]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_warning_dc_obsolete"&gt;[FR]ANSSI - DC/RODC with an obsolete operating system (vuln1_warning_dc_obsolete)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The operating system of domain controllers can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>S-DC-2000</RiskId>
        <Solution>To resolve this security risk, the only way is to decommission DC running Windows 2000 OS, in order to use new versions that are more secured and that are still being patched regarding new security threats</Solution>
        <TechnicalExplanation>The OS Windows 2000 as a DC is vulnerable to many publicly known exploits such as MS17-010 or MS14-068 and it can no longer be patched. A domain running this OS version should be considered compromised</TechnicalExplanation>
        <Title>Obsolete Domain Controller (Windows 2000)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows Server 2003 for the workstations within the domain</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/information/CERTFR-2005-INF-003/#SECTION00032400000000000000"&gt;[FR]ANSSI CERTFR-2005-INF-003&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The detail can be found in &lt;a href="#operatingsystems"&gt;Operating Systems&lt;/a&gt;</ReportLocation>
        <RiskId>S-OS-2003</RiskId>
        <Solution>In order to solve this security issue, you should upgrade all the workstations to a more recent version of Windows, starting from Windows 10.   __    &lt;i&gt;&lt;strong&gt;Use PingCastle.exe and select export on the main menu. Then choose to export computers. PingCastle will produce a list of all your computers with the OS version in a csv file. You can then use Excel to filter them.&lt;/strong&gt;&lt;/i&gt;__    Do note that you can get the full details regarding the OS used with the following PowerShell command: &lt;i&gt;Get-ADComputer -Filter {(Enabled -eq $true) -and (OperatingSystem -Like "*Server 2003*")} -Property Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion | format-table Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion -Wrap -Auto&lt;/i&gt;</Solution>
        <TechnicalExplanation>The Windows Server 2003 OS is no longer supported, as it is vulnerable to many publicly known exploits: Administrator's credentials can be captured, security protocols are weak, etc.</TechnicalExplanation>
        <Title>Obsolete OS (Windows Server 2003)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows 2000 for the workstations within the domain</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/information/CERTFR-2005-INF-003/#SECTION00032400000000000000"&gt;[FR]ANSSI CERTFR-2005-INF-003&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The detail can be found in &lt;a href="#operatingsystems"&gt;Operating Systems&lt;/a&gt;</ReportLocation>
        <RiskId>S-OS-2000</RiskId>
        <Solution>In order to solve this security issue, you should upgrade all the workstations to a more recent version of Windows, starting from Windows 10. __    &lt;i&gt;&lt;strong&gt;Use PingCastle.exe and select export on the main menu. Then choose to export computers. PingCastle will produce a list of all your computers with the OS version in a csv file. You can then use Excel to filter them.&lt;/strong&gt;&lt;/i&gt;__    Do note that you can get the full details regarding the OS used with the following PowerShell command: &lt;i&gt;Get-ADComputer -Filter {(Enabled -eq $true) -and (OperatingSystem -Like "*Server 2000*")} -Property Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion | format-table Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion -Wrap -Auto&lt;/i&gt;</Solution>
        <TechnicalExplanation>The Windows 2000 OS is no longer supported, as it is vulnerable to many publicly known exploits: Administrator's credentials can be captured, security protocols are weak, etc.</TechnicalExplanation>
        <Title>Obsolete OS (Windows 2000)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows XP for the workstations within the domain</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/information/CERTFR-2005-INF-003/#SECTION00032400000000000000"&gt;[FR]ANSSI CERTFR-2005-INF-003&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The detail can be found in &lt;a href="#operatingsystems"&gt;Operating Systems&lt;/a&gt;</ReportLocation>
        <RiskId>S-OS-XP</RiskId>
        <Solution>In order to solve this security issue, you should upgrade all the workstations to a more recent version of Windows, starting from Windows 10. __    &lt;i&gt;&lt;strong&gt;Use PingCastle.exe and select export on the main menu. Then choose to export computers. PingCastle will produce a list of all your computers with the OS version in a csv file. You can then use Excel to filter them.&lt;/strong&gt;&lt;/i&gt;__    Do note that you can get the full details regarding the OS used with the following PowerShell command: &lt;i&gt;Get-ADComputer -Filter {(Enabled -eq $true) -and (OperatingSystem -Like "*Windows XP*")} -Property Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion | format-table Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion -Wrap -Auto&lt;/i&gt;</Solution>
        <TechnicalExplanation>The Windows XP OS is no longer supported, as it is vulnerable to many publicly known exploits: Administrator's credentials can be captured, security protocols are weak, etc.</TechnicalExplanation>
        <Title>Obsolete OS (Windows XP)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there is no use of the obsolete and vulnerable OS Windows NT for the workstations within the domain</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/information/CERTFR-2005-INF-003/#SECTION00032400000000000000"&gt;[FR]ANSSI CERTFR-2005-INF-003&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>ObsoleteOS</Model>
        <ReportLocation>The detail can be found in &lt;a href="#operatingsystems"&gt;Operating Systems&lt;/a&gt;</ReportLocation>
        <RiskId>S-OS-NT</RiskId>
        <Solution>In order to solve this security issue, you should upgrade all the workstations to a more recent version of Windows, starting from Windows 10. __    &lt;i&gt;&lt;strong&gt;Use PingCastle.exe and select export on the main menu. Then choose to export computers. PingCastle will produce a list of all your computers with the OS version in a csv file. You can then use Excel to filter them.&lt;/strong&gt;&lt;/i&gt;__    Do note that you can get the full details regarding the OS used with the following PowerShell command: &lt;i&gt;Get-ADComputer -Filter {(Enabled -eq $true) -and (OperatingSystem -Like "* NT *")} -Property Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion | format-table Name,OperatingSystem,OperatingSystemServicePack,OperatingSystemVersion -Wrap -Auto&lt;/i&gt;</Solution>
        <TechnicalExplanation>The Windows NT OS is no longer supported, as it is vulnerable to many publicly known exploits: Administrator's credentials can be captured, security protocols are weak, etc.__</TechnicalExplanation>
        <Title>Obsolete OS (Windows NT)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that all the Domain Controllers are updated regularly. This is done by checking if a DC has been rebooted in the past 6 months. If not, it means it has not been patched as well in these 6 months</Description>
        <Documentation>&lt;a href="https://attack.mitre.org/mitigations/M1051"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Update Software&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>VulnerabilityManagement</Model>
        <ReportLocation>The detail can be found in &lt;a href="#domaincontrollersection"&gt;Domain controllers&lt;/a&gt;</ReportLocation>
        <RiskId>S-DC-NotUpdated</RiskId>
        <Solution>Frequently updating the DC should be part of the AD policies, as there should be a dedicated time-slot for the servers to reboot and apply security patches</Solution>
        <TechnicalExplanation>Domain Controller needs to be updated regularly because threats to the AD evolve all the time, so assets in the AD should evolve accordingly. The date of last update is computed by getting the &lt;i&gt;StatisticsStartTime&lt;/i&gt; from &lt;i&gt;[net statistics workstation]&lt;/i&gt;. If not available, the PingCastle solution will use the &lt;i&gt;lastLogonTimestamp&lt;/i&gt; attribute which is refreshed based on the LastLogon attribute. Do note that there is a maximum delay for refresh: 14 days.</TechnicalExplanation>
        <Title>Domain controller update</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>Trusts</Category>
        <Description>The purpose is to check if all trusts are protected using the functionality named SID Filtering</Description>
        <Documentation>&lt;a href="https://msdn.microsoft.com/en-us/library/cc237940.aspx"&gt;https://msdn.microsoft.com/en-us/library/cc237940.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.stigviewer.com/stig/active_directory_domain/2017-12-15/finding/V-8538"&gt;[US]STIG V-8538 - Security identifiers (SIDs) must be configured to use only authentication data of directly trusted external or forest trust. &lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.3.1.6"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R16 [paragraph.3.3.1.6]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_trusts_forest_sidhistory"&gt;[FR]ANSSI - Outbound forest trust relationships with sID History enabled (vuln1_trusts_forest_sidhistory)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_trusts_domain_notfiltered"&gt;[FR]ANSSI - Unfiltered outbound domain trust relationship (vuln1_trusts_domain_notfiltered)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1134/005"&gt;[MITRE]T1134.005 Access Token Manipulation: SID-History Injection&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>SIDFiltering</Model>
        <ReportLocation>The detail can be found in &lt;a href="#discovereddomains"&gt;Trusts section&lt;/a&gt;</ReportLocation>
        <RiskId>T-SIDFiltering</RiskId>
        <Solution>A trust without SID Filtering means either that a migration is in progress or that the domain can be compromised instantly via the trust.__The solution is to complete existing migration ASAP and enable the SID Filtering feature.____If the trust is a domain trust, you should use netdom /quarantine and set it to yes.__If the trust is a forest trust, you should use netdom /enablesidhistory and set it to no.__Do not apply /quarantine on a forest trust: you will break the transitivity of the trust.</Solution>
        <TechnicalExplanation>SID Filtering is a mechanism used to block account presenting a SID History property. SID History is used to link an existing account to another account and can be used to propagate a compromise through trusts. SID Filtering for domain-to-domain trust is called a quarantine and is disabled by default. SID Filtering to a forest is enabled by default and disabling it is called "enabling SID History".____The algorithm to compute the SID Filtering is:__get the attribute trustDirection and TrustAttributes of the trust object.__if the direction is 0 or 1 or if the trust is intra forest (trustattributes &amp; 32 != 0) then SID Filtering is not applicable.__Then, if the trust is a forest trust (trusattributes &amp; 8 != 0) then__check if /enablesidhistory has been enabled - trustattributes &amp; 64 != 0.__If enabled: SID Filtering is deactivated.__Else if not a forest trust (trustattributes &amp; 8 == 0) then check for the quarantined attribute (trustattributes &amp; 4 != 0).__If the quarantine flag is set, SID Filtering is enabled.____You can use the PowerShell command to get its status:__&lt;i&gt;[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().GetSidFilteringStatus('my.domain.to.test.local')&lt;/i&gt;__</TechnicalExplanation>
        <Title>Check for Trusts whose security is not maximum</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to check if there are duplicate accounts within the domain. A duplicate account is essentially a duplicate of two objects having the same attributes.</Description>
        <Documentation>&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>Replication</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-Duplicate</RiskId>
        <Solution>Duplicate accounts being present often means there are process failures, and they should be identified and removed. To identify all duplicate accounts, you can use the following PowerShell commands: &lt;i&gt;get-adobject -ldapfilter "(cn=*cnf:*)"&lt;/i&gt; ; &lt;i&gt;get-adobject -ldapfilter "(sAMAccountName=$duplicate)"&lt;/i&gt;</Solution>
        <TechnicalExplanation>To identify a duplicate account, a check is performed on the "DN" and the "sAMAccountName". When a DC detects a conflict, there is a replacement performed on the second object.</TechnicalExplanation>
        <Title>Duplicate account check</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to verify if there are accounts currently running with a reversible password</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_reversible_password"&gt;[FR]ANSSI - Accounts with passwords stored using reversible encryption (vuln3_reversible_password)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/002"&gt;[MITRE]T1110.002 Brute Force: Password Cracking&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-C-Reversible</RiskId>
        <Solution>To remove this risk, there should be no account(s) with reversible encryption for the password. You should remove them by removing the flag "Store password using reversible encryption" on all accounts, so that the cleartext password is removed at the next password change. You can get a list of all the possibly compromised accounts running the following PowerShell command: &lt;i&gt;get-adobject -ldapfilter "(userAccountControl:1.2.840.113556.1.4.803:=128)" -properties useraccountcontrol&lt;/i&gt;</Solution>
        <TechnicalExplanation>It is possible that domains have accounts with an encryption that can be reversed. In this case, it means that the password is actually stored in clear text in the &lt;i&gt;supplementalCredential&lt;/i&gt; attribute of the account and that it can be retrieved using a DCSync attack</TechnicalExplanation>
        <Title>Check for reversible passwords used for computer accounts</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to verify if there are user accounts currently running with a reversible password</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_reversible_password"&gt;[FR]ANSSI - Accounts with passwords stored using reversible encryption (vuln3_reversible_password)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1110/002"&gt;[MITRE]T1110.002 Brute Force: Password Cracking&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-Reversible</RiskId>
        <Solution>To remove this risk, there should be no account(s) with reversible encryption. You should remove them by removing the flag "Store password using reversible encryption" on all accounts, so that the cleartext password is removed at the next password change. You can get a list of all the possibly compromised accounts running the following PowerShell command: &lt;i&gt;get-adobject -ldapfilter "(userAccountControl:1.2.840.113556.1.4.803:=128)" -properties useraccountcontrol&lt;/i&gt;</Solution>
        <TechnicalExplanation>It is possible that domains have accounts with an encryption that can be reversed. In this case, it means that the password is actually stored in clear text in the &lt;i&gt;supplementalCredential&lt;/i&gt; attribute of the account and that it can be retrieved using a DCSync attack</TechnicalExplanation>
        <Title>Check for reversible password used for user accounts</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that every account requires a password</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/troubleshoot/windows-server/identity/useraccountcontrol-manipulate-account-properties"&gt;https://docs.microsoft.com/troubleshoot/windows-server/identity/useraccountcontrol-manipulate-account-properties&lt;/a&gt;&lt;br&gt;__&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#subsection.3.6"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R36 [subsection.3.6]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-PwdNotRequired</RiskId>
        <Solution>The best solution to solve the problem is to change the "useraccountcontrol" attribute of all the accounts that have it and that are not used in trusts. If the flag is removed while there is no password set, you will have an error. You can use this to detect accounts without any passwords. Do note that you can manually check all the accounts that need to be worked on using the following PowerShell command: &lt;i&gt;get-adobject -ldapfilter "(&amp;(objectCategory=person)(objectClass=user)(userAccountControl:1.2.840.113556.1.4.803:=32))" -properties useraccountcontrol&lt;/i&gt;</Solution>
        <TechnicalExplanation>An account can be set without a password if it has the flag "PASSWD_NOTREQD" set as "True" in the "useraccountcontrol" attribute. This represents a high security risk as the account is not protected at all without a password</TechnicalExplanation>
        <Title>Check that every account requires a password</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to verify that no weak encryption algorithm such as DES is used for accounts.</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/archive/blogs/openspecification/msds-supportedencryptiontypes-episode-1-computer-accounts"&gt;https://docs.microsoft.com/en-us/archive/blogs/openspecification/msds-supportedencryptiontypes-episode-1-computer-accounts&lt;/a&gt;&lt;br&gt;__&lt;a href="https://learn.microsoft.com/en-us/services-hub/unified/health/remediation-steps-ad/remove-the-highly-insecure-des-encryption-from-user-accounts"&gt;https://learn.microsoft.com/en-us/services-hub/unified/health/remediation-steps-ad/remove-the-highly-insecure-des-encryption-from-user-accounts&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_kerberos_properties_deskey"&gt;[FR]ANSSI - Use of Kerberos with weak encryption (vuln2_kerberos_properties_deskey)&lt;/a&gt;&lt;span class="badge grade-2"&gt;2&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1558/004"&gt;[MITRE]T1558.004 Steal or Forge Kerberos Tickets: AS-REP Roasting&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>OldAuthenticationProtocols</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-DesEnabled</RiskId>
        <Solution>It is recommended to disable DES as an encryption algorithm in the user configuration dialog or in the "msDSSupportedEncryptionTypes" attribute at LDAP level. It has to be disabled in the property of an account by unchecking the box "Use Kerberos DES encryption for this account". You can also detect which accounts support Kerberos DES encryption by running: &lt;i&gt;Get-ADObject -Filter {UserAccountControl -band 0x200000 -or msDs-supportedEncryptionTypes -band 3}&lt;/i&gt;.</Solution>
        <TechnicalExplanation>DES is a very weak algorithm and once assigned to an account, it can be used in Kerberos ticket requests, even though it is easily cracked. If the attacker cracks the Kerberos ticket, they can steal the token and compromise the user account.</TechnicalExplanation>
        <Title>Check the use of Kerberos with weak encryption (DES algorithm)</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to check for unusual value in the primarygroupid attribute used to store group membership</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_primary_group_id_nochange"&gt;[FR]ANSSI - Accounts with modified PrimaryGroupID (vuln3_primary_group_id_nochange)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-C-PrimaryGroup</RiskId>
        <Solution>Unless strongly justified, change the primary group id to its default: 513 or 514 for users, 516 or 521 for domain controllers, 514 or 515 for computers. The primary group can be edited in a friendly manner by editing the account with the "Active Directory Users and Computers" and after selecting the "Member Of" tab, "set primary group".</Solution>
        <TechnicalExplanation>In Active Directory, group membership is stored on the "members" attribute and on the "primarygroupid" attribute.__    The default primary group value is "Domain Users" for the users, "Domain Computers" for the computers and "Domain Controllers" for the domain controllers.__    The primarygroupid contains the RID (last digits of a SID) of the group targeted. It can be used to store hidden membership as this attribute is not often analyzed.__    This rule can also be triggered if one domain controller is not in the default container (named "Domain Controllers" and located at the root), which is not a recommended practice.__  </TechnicalExplanation>
        <Title>Check for hidden group membership for computer accounts</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to check for unusual values in the primarygroupid attribute used to store group memberships</Description>
        <Documentation>&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_primary_group_id_nochange"&gt;[FR]ANSSI - Accounts with modified PrimaryGroupID (vuln3_primary_group_id_nochange)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-PrimaryGroup</RiskId>
        <Solution>Unless strongly justified, change the primary group id to its default: 513 or 514 for users, 516 or 521 for domain controllers, 514 or 515 for computers. The primary group can be edited in a friendly manner by editing the account with the "Active Directory Users and Computers" and after selecting the "Member Of" tab, "set primary group".__    You can use the following script to list Users with a primary group id different from domain users:__    &lt;i&gt;$DomainUsersSid = New-Object System.Security.Principal.SecurityIdentifier ([System.Security.Principal.WellKnownSidType]::AccountDomainUsersSid,(Get-ADDomain).DomainSID)&lt;br&gt;__      Get-ADUser -Filter * -Properties PrimaryGroup | Where-Object { $_.PrimaryGroup -ne (Get-ADGroup -Filter {SID -eq $DomainUsersSid} ).DistinguishedName } | Select-Object UserPrincipalName,PrimaryGroup&lt;/i&gt;</Solution>
        <TechnicalExplanation>In Active Directory, group membership is stored on the "members" attribute and on the "primarygroupid" attribute. The default primary group value is "Domain Users" for the users, "Domain Computers" for the computers and "Domain Controllers" for the domain controllers. The primarygroupid contains the RID (last digits of a SID) of the group targeted. It can be used to store hidden membership as this attribute is not often analyzed.</TechnicalExplanation>
        <Title>Check for hidden group membership for user accounts</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there are as few inactive computers as possible within the domain.</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.6.6.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R45 [paragraph.3.6.6.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_password_change_inactive_servers"&gt;[FR]ANSSI - Inactive servers (vuln3_password_change_inactive_servers)&lt;/a&gt;&lt;span class="badge grade-3"&gt;3&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1018"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - User Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>InactiveUserOrComputer</Model>
        <RiskId>S-C-Inactive</RiskId>
        <Solution>To mitigate the risk, you should monitor the number of inactive accounts and reduce it as much as possible. A list of all inactive accounts is obtainable through the command: &lt;i&gt;Search-ADAccount –AccountInActive –ComputersOnly –TimeSpan 180:00:00:00 –ResultPageSize 2000 –ResultSetSize $null | ?{$_.Enabled –eq $True} | Select-Object Name, SamAccountName, DistinguishedName&lt;/i&gt;.</Solution>
        <TechnicalExplanation>Inactive computers often stay in the network because of weaknesses in the decommissioning process. These stale computer accounts can be used as backdoors and therefore represents a possible security breach. </TechnicalExplanation>
        <Title>Inactive computer check</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that there are as few inactive accounts as possible within the domain. Stale user accounts are a significant security issue, as former employees and external attackers could use those accounts to attack the organization.</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.6.6.2"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R45 [paragraph.3.6.6.2]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://www.cert.ssi.gouv.fr/uploads/ad_checklist.html#vuln_user_accounts_dormant"&gt;[FR]ANSSI - Dormant accounts (vuln1_user_accounts_dormant)&lt;/a&gt;&lt;span class="badge grade-1"&gt;1&lt;/span&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1018"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - User Account Management&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>InactiveUserOrComputer</Model>
        <ReportLocation>The detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt;</ReportLocation>
        <RiskId>S-Inactive</RiskId>
        <Solution>To mitigate the risk, you should monitor the number of inactive accounts and reduce it as much as possible. A list of all inactive accounts is obtainable through the command: &lt;i&gt;Search-ADAccount –AccountInActive –UsersOnly –TimeSpan 180:00:00:00 –ResultPageSize 2000 –ResultSetSize $null | ?{$_.Enabled –eq $True} | Select-Object Name, SamAccountName, DistinguishedName&lt;/i&gt;.</Solution>
        <TechnicalExplanation>Inactive accounts often stay in the network because of weaknesses in the decommissioning process. These stale computer accounts can be used as backdoors and therefore represents a possible security breach. </TechnicalExplanation>
        <Title>Inactive account check</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Active Directory</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose is to ensure that a migration has been completed correctly and that the SIDHistory attribute has been cleared out from user and computer accounts. This attribute is indeed set when migrating a user or a computer from one domain to another</Description>
        <Documentation>&lt;a href="https://cyber.gouv.fr/sites/default/files/IMG/pdf/NP_ActiveDirectory_NoteTech.pdf#paragraph.3.3.1.5"&gt;[FR]ANSSI - Recommandations de sécurité relatives à Active Directory - R15 [paragraph.3.3.1.5]&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/mitigations/M1015"&gt;[MITRE]Mitre Att&amp;ck - Mitigation - Active Directory Configuration&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1134/005"&gt;[MITRE]T1134.005 Access Token Manipulation: SID-History Injection&lt;/a&gt;</Documentation>
        <MaturityLevel>3</MaturityLevel>
        <Model>ObjectConfig</Model>
        <ReportLocation>The SIDHistory detail can be found in &lt;a href="#useraccountanalysis"&gt;User information&lt;/a&gt; and &lt;a href="#computeraccountanalysis"&gt;Computer information&lt;/a&gt; and a quick summary in &lt;a href="#sidhistory"&gt;SID History&lt;/a&gt;</ReportLocation>
        <RiskId>S-SIDHistory</RiskId>
        <Solution>To solve the security issue, you should remove all the SIDHistory attributes. To do so, you can list the objects having a SIDHistory attribute using the command: &lt;i&gt;get-ADObject -ldapfilter "(sidhistory=*)" -properties sidhistory&lt;/i&gt;. __Each security descriptor of the domain, including file shares for example, should be reviewed to be rewritten with the new SID of the account. Then, the attribute can be removed of these accounts using the migration tool or a PowerShell snippet &lt;i&gt;Remove-SIDHistory&lt;/i&gt; once the migration is completed.____Please note that once the SID History has been removed, it cannot be added back again without doing a real migration. Possibly hacking tools such as mimikatz could be used to undo a deletion with for example the lsadump::dcshadow attack.____To remove the SIDHistory from a user account, run:__&lt;i&gt;Get-ADUser USERNAME -properties sidhistory | foreach {Set-ADUser $_ -remove @{sidhistory=$_.sidhistory.value}}&lt;/i&gt;__For a group, run:__&lt;i&gt;Get-ADGroup GROUPNAME -properties sidhistory | foreach {Set-ADGroup $_ -remove @{sidhistory=$_.sidhistory.value}}&lt;/i&gt;__For all users in a OU:__&lt;i&gt;Get-ADUser -SearchBase "OU=Accounts,DC=mydomain,DC=com" -Filter {sidhistory -like '*'} -properties sidhistory | foreach {Set-ADUser $_ -remove @{sidhistory=$_.sidhistory.value}}&lt;/i&gt;__</Solution>
        <TechnicalExplanation>The SIDHistory attribute is useful when doing a migration because it allows to keep the reference to the former account. On the other hand, once the migration is over, it is mandatory that this attribute is removed to evaluate the permissions in regards with the new account and not the former one.</TechnicalExplanation>
        <Title>SIDHistory check</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Azure AD</Type>
        <Category>Trusts</Category>
        <Description>The purpose of this rule is to check that ADConnect has no know vulnerabilities</Description>
        <Documentation>&lt;a href="https://dirteam.com/sander/2021/08/10/two-new-azure-ad-connect-versions-were-released-to-prevent-mitm-attacks-towards-domain-controllers-cve-2021-36949/"&gt;https://dirteam.com/sander/2021/08/10/two-new-azure-ad-connect-versions-were-released-to-prevent-mitm-attacks-towards-domain-controllers-cve-2021-36949/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36949"&gt;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36949&lt;/a&gt;&lt;br&gt;__&lt;a href="https://attack.mitre.org/techniques/T1557"&gt;[MITRE]T1557 Man-in-the-Middle&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>TrustAzure</Model>
        <ReportLocation />
        <RiskId>ADConnectVersion</RiskId>
        <Solution>You need to update ADConnect.__    </Solution>
        <TechnicalExplanation>Azure AD Connect v1.6.11.3 is is security update release of Azure AD Connect v1.x. This release addresses the vulnerability as documented in CVE-2021-36949.__  Azure AD Connect v2.0.8.0 is a security update release of Azure AD Connect v2.x. This release addresses the vulnerability as documented in CVE-2021-36949.</TechnicalExplanation>
        <Title>Check if ADConnect is known to be vulnerable</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Azure AD</Type>
        <Category>Trusts</Category>
        <Description>The purpose of this rule is to check that ADConnect is not running version 1</Description>
        <Documentation>&lt;a href="https://azure.microsoft.com/en-us/updates/action-required-upgrade-to-the-latest-version-of-azure-ad-connect-before-31-august-2022/"&gt;https://azure.microsoft.com/en-us/updates/action-required-upgrade-to-the-latest-version-of-azure-ad-connect-before-31-august-2022/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-upgrade-previous-version"&gt;https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-upgrade-previous-version&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>TrustAzure</Model>
        <ReportLocation />
        <RiskId>ADConnectVersion1</RiskId>
        <Solution>You need to update ADConnect.__    </Solution>
        <TechnicalExplanation>Azure AD Connect v1.X.X.X is obsolete starting August, 31th 2022. It is recommended to use version 2.X.X.X.</TechnicalExplanation>
        <Title>Check if ADConnect is on the branch 1.X.X.X</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Azure AD</Type>
        <Category>Anomalies</Category>
        <Description>The purpose of this rule is to ensure that the Guest user does not have the same access level as a normal user</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions#member-and-guest-users"&gt;https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions#member-and-guest-users&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-5-automate-entitlement-management"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-5-automate-entitlement-management&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-2-define-enterprise-segmentation-strategy"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-2-define-enterprise-segmentation-strategy&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-6-define-identity-and-privileged-access-strategy"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-6-define-identity-and-privileged-access-strategy&lt;/a&gt;</Documentation>
        <MaturityLevel>1</MaturityLevel>
        <Model>WeakPassword</Model>
        <ReportLocation />
        <RiskId>GuestUserAccessRestriction1</RiskId>
        <Solution>Open the Azure Console__Go to Azure Active Directory__Go to External Identities__Go to External collaboration settings__Under "Guest user access", change the value to "Guest users have limited access to properties and memberships of directory objects" (default value)__    </Solution>
        <TechnicalExplanation>By default guests users are restricted from exploring the directory.__The current policy value allows guests to list all objects in the directory and their properties as a normal user</TechnicalExplanation>
        <Title>Check if guests have the same access level than normal users</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Azure AD</Type>
        <Category>Anomalies</Category>
        <Description>The purpose of this rule is to ensure that the guest user has the most possible restricted access</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions#member-and-guest-users"&gt;https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions#member-and-guest-users&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-5-automate-entitlement-management"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-5-automate-entitlement-management&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-2-define-enterprise-segmentation-strategy"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-2-define-enterprise-segmentation-strategy&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-6-define-identity-and-privileged-access-strategy"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-6-define-identity-and-privileged-access-strategy&lt;/a&gt;</Documentation>
        <MaturityLevel>4</MaturityLevel>
        <Model>WeakPassword</Model>
        <ReportLocation />
        <RiskId>GuestUserAccessRestriction2</RiskId>
        <Solution>Open the Azure Console__Go to Azure Active Directory__Go to External Identities__Go to External collaboration settings__Under "Guest user access", change the value to "Guest user access is restricted to properties and memberships of their own directory objects" (most restrictive)__    </Solution>
        <TechnicalExplanation>By default guests users are restricted from exploring the directory.__But giving an existing account it is possible to explore the most of the directory.__The technique, available in the export section of PingCastle, consists of enumerating groups from a given users, then to enumerate the members of these groups and to continue recursively.__To prohibit this technique, restrict this exploration to the groups where the guest belongs.</TechnicalExplanation>
        <Title>Check if guests have the most restricted access level</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Azure AD</Type>
        <Category>Anomalies</Category>
        <Description>The purpose of this rule is to ensure that no user can consent to app that access company data</Description>
        <Documentation>&lt;a href="https://nicksnettravels.builttoroam.com/post/2017/01/24/Admin-Consent-for-Permissions-in-Azure-Active-Directory.aspx"&gt;https://nicksnettravels.builttoroam.com/post/2017/01/24/Admin-Consent-for-Permissions-in-Azure-Active-Directory.aspx&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/configure-user-consent#configure-user-consent-to-applications"&gt;https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/configure-user-consent#configure-user-consent-to-applications&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-1-protect-and-limit-highly-privileged-users"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-1-protect-and-limit-highly-privileged-users&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-2-restrict-administrative-access-to-business-critical-systems"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-2-restrict-administrative-access-to-business-critical-systems&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-2-define-enterprise-segmentation-strategy"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-2-define-enterprise-segmentation-strategy&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-6-define-identity-and-privileged-access-strategy"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-6-define-identity-and-privileged-access-strategy&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>Reconnaissance</Model>
        <ReportLocation />
        <RiskId>UserConsentCompanyData</RiskId>
        <Solution>The recommendation is to require admin consent to grant consent to external applications.__  __Open the Azure Console__Go to Azure Active Directory__Go to Users__Go to User settings__Click on Manage how end users launch and view their applications__Under the Enterprise applications heading.__Set Users can consent to apps accessing company data on their behalf to No__    </Solution>
        <TechnicalExplanation>By default any users can grant some permissions to applications.__  A malicious application,typically sent to the user as a phishing link, can be granted rights such as reading all AzureAD data by any users.</TechnicalExplanation>
        <Title>Check if users can consent to any app</Title>
    </ExportedRule>
    <ExportedRule>
        <Type>Azure AD</Type>
        <Category>StaleObjects</Category>
        <Description>The purpose of this rule is to ensure that no user can register third-party applications</Description>
        <Documentation>&lt;a href="https://docs.microsoft.com/en-us/azure/active-directory/roles/delegate-app-roles#restrict-who-can-create-applications"&gt;https://docs.microsoft.com/en-us/azure/active-directory/roles/delegate-app-roles#restrict-who-can-create-applications&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-how-applications-are-added#who-has-permission-to-add-applications-to-my-azure-ad-instance"&gt;https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-how-applications-are-added#who-has-permission-to-add-applications-to-my-azure-ad-instance&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-1-define-asset-management-and-data-protection-strategy"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-1-define-asset-management-and-data-protection-strategy&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-1-protect-and-limit-highly-privileged-users"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-1-protect-and-limit-highly-privileged-users&lt;/a&gt;&lt;br&gt;__&lt;a href="https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-2-restrict-administrative-access-to-business-critical-systems"&gt;https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-2-restrict-administrative-access-to-business-critical-systems&lt;/a&gt;&lt;br&gt;__&lt;a href="https://blogs.msdn.microsoft.com/exchangedev/2014/06/05/managing-user-consent-for-applications-using-office-365-apis/"&gt;https://blogs.msdn.microsoft.com/exchangedev/2014/06/05/managing-user-consent-for-applications-using-office-365-apis/&lt;/a&gt;&lt;br&gt;__&lt;a href="https://nicksnettravels.builttoroam.com/post/2017/01/24/Admin-Consent-for-Permissions-in-Azure-Active-Directory.aspx"&gt;https://nicksnettravels.builttoroam.com/post/2017/01/24/Admin-Consent-for-Permissions-in-Azure-Active-Directory.aspx&lt;/a&gt;</Documentation>
        <MaturityLevel>2</MaturityLevel>
        <Model>Provisioning</Model>
        <ReportLocation />
        <RiskId>UserRegisterApplications</RiskId>
        <Solution>The recommendation is to require admins to register new applications__  __Open the Azure Console__Go to Azure Active Directory__Go to Users__Go to User settings__Set "Users can register applications" to "No"__    </Solution>
        <TechnicalExplanation>By default any users can register an application.__  This application can be accessible without being reviewed.</TechnicalExplanation>
        <Title>Check if users can consent to any app</Title>
    </ExportedRule>
</ArrayOfExportedRule>